<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.3.450" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />


<title>Webscraping</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<link href="index_files/libs/countdown-0.4.0/countdown.css" rel="stylesheet" />
<script src="index_files/libs/countdown-0.4.0/countdown.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css" />
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <div id="quarto-toc-target"></div>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Webscraping</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tabular-data-summaries" id="toc-tabular-data-summaries"><span class="header-section-number">1</span> Tabular Data Summaries</a></li>
  <li><a href="#visualization-and-conditional-distributions" id="toc-visualization-and-conditional-distributions"><span class="header-section-number">2</span> Visualization and Conditional Distributions</a></li>
  <li><a href="#visualizing-and-summarizing-quantitative-variables" id="toc-visualizing-and-summarizing-quantitative-variables"><span class="header-section-number">3</span> Visualizing and Summarizing Quantitative Variables</a></li>
  <li><a href="#multivariate-summaries" id="toc-multivariate-summaries"><span class="header-section-number">4</span> Multivariate Summaries</a></li>
  <li><a href="#distances" id="toc-distances"><span class="header-section-number">5</span> Distances</a></li>
  <li><a href="#dummy-variables-and-column-tranformers" id="toc-dummy-variables-and-column-tranformers"><span class="header-section-number">6</span> Dummy Variables and Column Tranformers</a></li>
  <li><a href="#text-data-and-tf-idf" id="toc-text-data-and-tf-idf"><span class="header-section-number">7</span> Text Data and TF-IDF</a></li>
  <li><a href="#k-nearest-neighbors" id="toc-k-nearest-neighbors"><span class="header-section-number">8</span> K Nearest Neighbors</a></li>
  <li><a href="#modeling-and-machine-learning" id="toc-modeling-and-machine-learning"><span class="header-section-number">9</span> Modeling and Machine Learning</a></li>
  <li><a href="#regression-and-cross-validation" id="toc-regression-and-cross-validation"><span class="header-section-number">10</span> Regression and Cross-Validation</a></li>
  <li><a href="#classification-with-knn" id="toc-classification-with-knn"><span class="header-section-number">11</span> Classification with KNN</a></li>
  <li><a href="#clustering-with-k-means" id="toc-clustering-with-k-means"><span class="header-section-number">13</span> Clustering with K-Means</a></li>
  <li><a href="#merging-data" id="toc-merging-data"><span class="header-section-number">14</span> Merging Data</a></li>
  <li><a href="#hierarchical-data-and-apis" id="toc-hierarchical-data-and-apis"><span class="header-section-number">15</span> Hierarchical Data and APIs</a></li>
  <li><a href="#webscraping" id="toc-webscraping"><span class="header-section-number">16</span> Webscraping</a></li>
  </ul>
</nav>
<section id="tabular-data-summaries" class="level1 lectitle" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Tabular Data Summaries</h1>
<p><a href="slides-01-tabular-data-summaries.html">Slides</a></p>
</section>
<section id="data-on-disk" class="level3" data-number="1.0.1">
<h3 data-number="1.0.1"><span class="header-section-number">1.0.1</span> Data “on disk”</h3>
</section>
<section id="data-is-stored-in-plain-text-files" class="level3" data-number="1.0.2">
<h3 data-number="1.0.2"><span class="header-section-number">1.0.2</span> Data is stored in plain text files</h3>
<pre><code>name,pclass,survived,sex,age,sibsp,parch,ticket,fare,cabin,embarked,boat,body,home.dest
&quot;Allen, Miss. Elisabeth Walton&quot;,1,1,female,29,0,0,24160,211.3375,B5,S,2,,&quot;St Louis, MO&quot;
&quot;Allison, Master. Hudson Trevor&quot;,1,1,male,0.9167,1,2,113781,151.5500,C22 C26,S,11,,&quot;Montreal, PQ / Chesterville, ON&quot;
&quot;Allison, Miss. Helen Loraine&quot;,1,0,female,2,1,2,113781,151.5500,C22 C26,S,,,&quot;Montreal, PQ / Chesterville, ON&quot;
&quot;Allison, Mr. Hudson Joshua Creighton&quot;,1,0,male,30,1,2,113781,151.5500,C22 C26,S,,135,&quot;Montreal, PQ / Chesterville, ON&quot;
&quot;Allison, Mrs. Hudson J C (Bessie Waldo Daniels)&quot;,1,0,female,25,1,2,113781,151.5500,C22 C26,S,,,&quot;Montreal, PQ / Chesterville, ON&quot;
&quot;Anderson, Mr. Harry&quot;,1,1,male,48,0,0,19952,26.5500,E12,S,3,,&quot;New York, NY&quot;
&quot;Andrews, Miss. Kornelia Theodosia&quot;,1,1,female,63,1,0,13502,77.9583,D7,S,10,,&quot;Hudson, NY&quot;
&quot;Andrews, Mr. Thomas Jr&quot;,1,0,male,39,0,0,112050,0.0000,A36,S,,,&quot;Belfast, NI&quot;
&quot;Appleton, Mrs. Edward Dale (Charlotte Lamson)&quot;,1,1,female,53,2,0,11769,51.4792,C101,S,D,,&quot;Bayside, Queens, NY&quot;
&quot;Artagaveytia, Mr. Ramon&quot;,1,0,male,71,0,0,PC 17609,49.5042,,C,,22,&quot;Montevideo, Uruguay&quot;
&quot;Astor, Col. John Jacob&quot;,1,0,male,47,1,0,PC 17757,227.5250,C62 C64,C,,124,&quot;New York, NY&quot;</code></pre>
<ul>
<li><p>This is called a <strong>csv</strong> (<em>comma-separated</em>) file.</p></li>
<li><p>You might see it as <code>something.csv</code> or <code>something.txt</code></p></li>
<li><p><code>.txt</code> files might have different separators</p></li>
</ul>
</section>
<section id="reading-data" class="level3" data-number="1.0.3">
<h3 data-number="1.0.3"><span class="header-section-number">1.0.3</span> Reading data</h3>
<p>We <em>read the data</em> into a program like <code>python</code> by specifying:</p>
<ul>
<li><p>what <strong>type</strong> of file it is</p></li>
<li><p><strong>where</strong> the csv file is located (the <strong>“path”</strong>)</p></li>
<li><p>if the file has a <strong>header</strong></p></li>
<li><p>… and other information in special cases!</p></li>
</ul>
</section>
<section id="example-using-pandas-data-frame" class="level3" data-number="1.0.4">
<h3 data-number="1.0.4"><span class="header-section-number">1.0.4</span> Example using <code>pandas</code> data frame:</h3>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/titanic.csv&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                              name  ...                        home.dest
0                    Allen, Miss. Elisabeth Walton  ...                     St Louis, MO
1                   Allison, Master. Hudson Trevor  ...  Montreal, PQ / Chesterville, ON
2                     Allison, Miss. Helen Loraine  ...  Montreal, PQ / Chesterville, ON
3             Allison, Mr. Hudson Joshua Creighton  ...  Montreal, PQ / Chesterville, ON
4  Allison, Mrs. Hudson J C (Bessie Waldo Daniels)  ...  Montreal, PQ / Chesterville, ON

[5 rows x 14 columns]</code></pre>
</div>
</div>
</section>
<section id="check-in" class="level3" data-number="1.0.5">
<h3 data-number="1.0.5"><span class="header-section-number">1.0.5</span> Check in:</h3>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/titanic.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon no-icon'></i>
</div>
<div class="callout-body-container">
<ul>
<li><p>What if this file lived on a computer instead of online?</p></li>
<li><p>Why didn’t we have to specify that this dataset has a header?</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="looking-at-rows" class="level3" data-number="1.0.6">
<h3 data-number="1.0.6"><span class="header-section-number">1.0.6</span> Looking at rows</h3>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">1</span>, :]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name          Allison, Master. Hudson Trevor
pclass                                     1
survived                                   1
sex                                     male
age                                   0.9167
sibsp                                      1
parch                                      2
ticket                                113781
fare                                  151.55
cabin                                C22 C26
embarked                                   S
boat                                      11
body                                     NaN
home.dest    Montreal, PQ / Chesterville, ON
Name: 1, dtype: object</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">1</span>, :]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name          Allison, Master. Hudson Trevor
pclass                                     1
survived                                   1
sex                                     male
age                                   0.9167
sibsp                                      1
parch                                      2
ticket                                113781
fare                                  151.55
cabin                                C22 C26
embarked                                   S
boat                                      11
body                                     NaN
home.dest    Montreal, PQ / Chesterville, ON
Name: 1, dtype: object</code></pre>
</div>
</div>
</section>
<section id="looking-at-rows-1" class="level3" data-number="1.0.7">
<h3 data-number="1.0.7"><span class="header-section-number">1.0.7</span> Looking at rows</h3>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon no-icon'></i>
</div>
<div class="callout-body-container">
<ul>
<li><p>What is the difference between <code>.loc</code> and <code>.iloc</code>?</p></li>
<li><p>What <strong>type</strong> of object is returned?</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="loc-iloc-and-index" class="level3" data-number="1.0.8">
<h3 data-number="1.0.8"><span class="header-section-number">1.0.8</span> loc, iloc, and index</h3>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.set_index(<span class="st">&#39;name&#39;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df2.loc[<span class="dv">1</span>, :]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>KeyError: 1</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df2.iloc[<span class="dv">1</span>, :]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass                                     1
survived                                   1
sex                                     male
age                                   0.9167
sibsp                                      1
parch                                      2
ticket                                113781
fare                                  151.55
cabin                                C22 C26
embarked                                   S
boat                                      11
body                                     NaN
home.dest    Montreal, PQ / Chesterville, ON
Name: Allison, Master. Hudson Trevor, dtype: object</code></pre>
</div>
</div>
</section>
<section id="loc-iloc-and-index-1" class="level3" data-number="1.0.9">
<h3 data-number="1.0.9"><span class="header-section-number">1.0.9</span> loc, iloc, and index</h3>
<p>Think of <code>iloc</code> as <strong>integer location</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df2.loc[<span class="st">&quot;Allison, Master. Hudson Trevor&quot;</span>, :]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass                                     1
survived                                   1
sex                                     male
age                                   0.9167
sibsp                                      1
parch                                      2
ticket                                113781
fare                                  151.55
cabin                                C22 C26
embarked                                   S
boat                                      11
body                                     NaN
home.dest    Montreal, PQ / Chesterville, ON
Name: Allison, Master. Hudson Trevor, dtype: object</code></pre>
</div>
</div>
</section>
<section id="looking-at-columns" class="level3" data-number="1.0.10">
<h3 data-number="1.0.10"><span class="header-section-number">1.0.10</span> Looking at columns</h3>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index([&#39;name&#39;, &#39;pclass&#39;, &#39;survived&#39;, &#39;sex&#39;, &#39;age&#39;, &#39;sibsp&#39;, &#39;parch&#39;, &#39;ticket&#39;,
       &#39;fare&#39;, &#39;cabin&#39;, &#39;embarked&#39;, &#39;boat&#39;, &#39;body&#39;, &#39;home.dest&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;home.dest&#39;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0                          St Louis, MO
1       Montreal, PQ / Chesterville, ON
2       Montreal, PQ / Chesterville, ON
3       Montreal, PQ / Chesterville, ON
4       Montreal, PQ / Chesterville, ON
                     ...               
1304                                NaN
1305                                NaN
1306                                NaN
1307                                NaN
1308                                NaN
Name: home.dest, Length: 1309, dtype: object</code></pre>
</div>
</div>
</section>
<section id="caution-object-types" class="level3" data-number="1.0.11">
<h3 data-number="1.0.11"><span class="header-section-number">1.0.11</span> Caution: Object types</h3>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df.loc[<span class="dv">1</span>, :])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class &#39;pandas.core.series.Series&#39;&gt;</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df[<span class="st">&#39;name&#39;</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class &#39;pandas.core.series.Series&#39;&gt;</code></pre>
</div>
</div>
</section>
<section id="summarizing-a-data-frame" class="level2" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span> Summarizing a data frame</h2>
<section id="questions-to-ask" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1"><span class="header-section-number">1.1.1</span> Questions to ask</h3>
<ul>
<li><p>Which variables (columns) are <strong>categorical</strong>?</p></li>
<li><p>Which variables are <strong>quantitative</strong>?</p></li>
<li><p>Which variables are <strong>labels</strong> (e.g. names or ID numbers)?</p></li>
<li><p>Which variables are <strong>text</strong>?</p></li>
</ul>
</section>
<section id="a-quick-look-at-the-data" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2"><span class="header-section-number">1.1.2</span> A quick look at the data</h3>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            pclass     survived  ...         fare        body
count  1309.000000  1309.000000  ...  1308.000000  121.000000
mean      2.294882     0.381971  ...    33.295479  160.809917
std       0.837836     0.486055  ...    51.758668   97.696922
min       1.000000     0.000000  ...     0.000000    1.000000
25%       2.000000     0.000000  ...     7.895800   72.000000
50%       3.000000     0.000000  ...    14.454200  155.000000
75%       3.000000     1.000000  ...    31.275000  256.000000
max       3.000000     1.000000  ...   512.329200  328.000000

[8 rows x 7 columns]</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon no-icon'></i>
</div>
<div class="callout-body-container">
<ul>
<li><p>What percent of <em>Titanic</em> passengers survived?</p></li>
<li><p>What was the average (mean) fare paid for a ticket?</p></li>
<li><p>What percent of <em>Titanic</em> passengers were in First Class?</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="variable-types" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3"><span class="header-section-number">1.1.3</span> Variable types</h3>
<ul>
<li><p>The variable <code>pclass</code> was <strong>categorical</strong>, but python assumed it was <em>quantitative</em>.</p></li>
<li><p>It’s our job to check and fix data!</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;pclass&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="summary-of-categorical-variable" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4"><span class="header-section-number">1.1.4</span> Summary of categorical variable</h3>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass
3    709
1    323
2    277
Name: count, dtype: int64</code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>].value_counts(normalize <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass
3    0.541635
1    0.246753
2    0.211612
Name: proportion, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="visualization-and-conditional-distributions" class="level1 lectitle" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Visualization and Conditional Distributions</h1>
<p><a href="slides-02-conditional_distributions.html">Slides</a></p>
</section>
<section id="the-story-so-far" class="level2" data-number="2.1">
<h2 data-number="2.1"><span class="header-section-number">2.1</span> The story so far</h2>
<section id="getting-and-prepping-data" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1"><span class="header-section-number">2.1.1</span> Getting and prepping data</h3>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/titanic.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;pclass&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;survived&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;survived&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="thinking-about-variable-types" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2"><span class="header-section-number">2.1.2</span> Thinking about variable types</h3>
<div class="cell">
<div class="cell-output-display">
<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 3%" />
<col style="width: 3%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 3%" />
<col style="width: 3%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">pclass</th>
<th style="text-align: left;">survived</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">sibsp</th>
<th style="text-align: right;">parch</th>
<th style="text-align: left;">ticket</th>
<th style="text-align: right;">fare</th>
<th style="text-align: left;">cabin</th>
<th style="text-align: left;">embarked</th>
<th style="text-align: left;">boat</th>
<th style="text-align: right;">body</th>
<th style="text-align: left;">home.dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Allen, Miss. Elisabeth Walton</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">29.0000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">24160</td>
<td style="text-align: right;">211.3375</td>
<td style="text-align: left;">B5</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: left;">St Louis, MO</td>
</tr>
<tr class="even">
<td style="text-align: left;">Allison, Master. Hudson Trevor</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">0.9167</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">113781</td>
<td style="text-align: right;">151.5500</td>
<td style="text-align: left;">C22 C26</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">11</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: left;">Montreal, PQ / Chesterville, ON</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Allison, Miss. Helen Loraine</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">2.0000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">113781</td>
<td style="text-align: right;">151.5500</td>
<td style="text-align: left;">C22 C26</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: left;">Montreal, PQ / Chesterville, ON</td>
</tr>
<tr class="even">
<td style="text-align: left;">Allison, Mr. Hudson Joshua Creighton</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">30.0000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">113781</td>
<td style="text-align: right;">151.5500</td>
<td style="text-align: left;">C22 C26</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">Montreal, PQ / Chesterville, ON</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Allison, Mrs. Hudson J C (Bessie Waldo Daniels)</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">25.0000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">113781</td>
<td style="text-align: right;">151.5500</td>
<td style="text-align: left;">C22 C26</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: left;">Montreal, PQ / Chesterville, ON</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anderson, Mr. Harry</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">48.0000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">19952</td>
<td style="text-align: right;">26.5500</td>
<td style="text-align: left;">E12</td>
<td style="text-align: left;">S</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: left;">New York, NY</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="accessing-rows-and-columns" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3"><span class="header-section-number">2.1.3</span> Accessing rows and columns</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">5</span>,]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name         Anderson, Mr. Harry
pclass                         1
survived                       1
sex                         male
age                         48.0
sibsp                          0
parch                          0
ticket                     19952
fare                       26.55
cabin                        E12
embarked                       S
boat                           3
body                         NaN
home.dest           New York, NY
Name: 5, dtype: object</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;name&quot;</span>].head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0                      Allen, Miss. Elisabeth Walton
1                     Allison, Master. Hudson Trevor
2                       Allison, Miss. Helen Loraine
3               Allison, Mr. Hudson Joshua Creighton
4    Allison, Mrs. Hudson J C (Bessie Waldo Daniels)
Name: name, dtype: object</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="quick-summary-of-quantitative-variables" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4"><span class="header-section-number">2.1.4</span> Quick summary of quantitative variables</h3>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               age        sibsp        parch         fare        body
count  1046.000000  1309.000000  1309.000000  1308.000000  121.000000
mean     29.881135     0.498854     0.385027    33.295479  160.809917
std      14.413500     1.041658     0.865560    51.758668   97.696922
min       0.166700     0.000000     0.000000     0.000000    1.000000
25%      21.000000     0.000000     0.000000     7.895800   72.000000
50%      28.000000     0.000000     0.000000    14.454200  155.000000
75%      39.000000     1.000000     0.000000    31.275000  256.000000
max      80.000000     8.000000     9.000000   512.329200  328.000000</code></pre>
</div>
</div>
</section>
<section id="summarizing-categorical-variables" class="level3" data-number="2.1.5">
<h3 data-number="2.1.5"><span class="header-section-number">2.1.5</span> Summarizing categorical variables</h3>
<p>The list of percents for each category is called the <strong>distribution</strong> of the variable.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass
3    709
1    323
2    277
Name: count, dtype: int64</code></pre>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>].value_counts(normalize <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass
3    0.541635
1    0.246753
2    0.211612
Name: proportion, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="visualizing-categorical-variables" class="level2" data-number="2.2">
<h2 data-number="2.2"><span class="header-section-number">2.2</span> Visualizing categorical variables</h2>
<section id="the-grammar-of-graphics" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1"><span class="header-section-number">2.2.1</span> The Grammar of Graphics</h3>
<p>The <em>grammar of graphics</em> is a framework for creating data visualizations.</p>
<p>A visualization consists of:</p>
<ul>
<li><p>The <strong>aesthetic</strong>: Which <em>variables</em> are dictating which <em>plot elements</em>.</p></li>
<li><p>The <strong>geometry</strong>: What <em>shape</em> of plot you are making.</p></li>
<li><p>The <strong>theme</strong>: Other choices about the appearance.</p></li>
</ul>
</section>
<section id="example" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2"><span class="header-section-number">2.2.2</span> Example</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>The <strong>aesthetic</strong> is <strong>species</strong> on the x-axis, <strong>bill_length_mm</strong> on the y-axis, colored by <strong>species</strong>.</p>
<p>The <strong>geometry</strong> is a <strong>boxplot</strong>.</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> palmerpenguins <span class="im">import</span> load_penguins</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_point, aes, geom_boxplot</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> load_penguins()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>(ggplot(penguins, aes(x <span class="op">=</span> <span class="st">&quot;species&quot;</span>, y <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;species&quot;</span>))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_boxplot()</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_boxplot : Removed 2 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div>
</div>
</section>
<section id="plotnine" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3"><span class="header-section-number">2.2.3</span> plotnine</h3>
<p>The <code>plotnine</code> library implements the <em>grammar of graphics</em> in Python.</p>
<p>Code for the previous example:</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(ggplot(penguins, aes(x <span class="op">=</span> <span class="st">&quot;species&quot;</span>, y <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;species&quot;</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_boxplot()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<ul>
<li><p>The <code>aes()</code> function is the place to specify aesthetics.</p></li>
<li><p><code>x</code>, <code>y</code>, and <code>fill</code> are three possible aesthetics that can be specified, that map variables in our data set to plot elements.</p></li>
<li><p>A variety of <code>geom_*</code> functions allow for different plotting shapes (e.g. boxplot, histogram, etc.)</p></li>
</ul>
<section id="themes" class="level4" data-number="2.2.3.1">
<h4 data-number="2.2.3.1"><span class="header-section-number">2.2.3.1</span> Themes</h4>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb47"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(ggplot(penguins, aes(x <span class="op">=</span> <span class="st">&quot;species&quot;</span>, y <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;species&quot;</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_boxplot()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_boxplot : Removed 2 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> theme_classic</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>(ggplot(penguins, aes(x <span class="op">=</span> <span class="st">&quot;species&quot;</span>, y <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;species&quot;</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_boxplot()</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_boxplot : Removed 2 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-26-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="check-in-1" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4"><span class="header-section-number">2.2.4</span> Check-In</h3>
<p>What are the <em>aesthetics</em> and <em>geometry</em> in the cartoon plot below?</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="images/xkcd.png" class="img-fluid" /></p>
<figcaption>An xkcd comic of time spent going up the down escalator</figcaption>
</figure>
</div>
</section>
<section id="bar-plots" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5"><span class="header-section-number">2.2.5</span> Bar Plots</h3>
<p>To visualize the <strong>distribution</strong> of a categorical variable, we should use a <strong>bar plot</strong>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb51"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-27-7.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="percents" class="level3" data-number="2.2.6">
<h3 data-number="2.2.6"><span class="header-section-number">2.2.6</span> Percents</h3>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pclass_dist <span class="op">=</span> df[<span class="st">&#39;pclass&#39;</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).to_frame().reset_index()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>pclass_dist</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pclass  proportion
0      3    0.541635
1      1    0.246753
2      2    0.211612</code></pre>
</div>
</div>
</section>
<section id="percents-1" class="level3" data-number="2.2.7">
<h3 data-number="2.2.7"><span class="header-section-number">2.2.7</span> Percents</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb55"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>(ggplot(pclass_dist, aes(x <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>, y <span class="op">=</span> <span class="st">&quot;proportion&quot;</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_col()   <span class="co">### notice this change to a column plot!</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-29-9.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="visualizing-two-categorical-variables" class="level2" data-number="2.3">
<h2 data-number="2.3"><span class="header-section-number">2.3</span> Visualizing two categorical variables</h2>
<section id="option-1-stacked-bar-plot" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1"><span class="header-section-number">2.3.1</span> Option 1: Stacked Bar Plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb57"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;sex&quot;</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar()</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-30-11.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="option-1-stacked-bar-plot-1" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2"><span class="header-section-number">2.3.2</span> Option 1: Stacked Bar Plot</h3>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon no-icon'></i>
</div>
<div class="callout-body-container">
<p>What are some pros and cons of the stacked barplot?</p>
</div>
</div>
</div>
<ul>
<li><p>Pros:</p></li>
<li><p>We can still see the total counts in each class</p></li>
<li><p>We can easily compare the <code>male</code> counts in each class, since those bars are on the bottom.</p></li>
<li><p>Cons:</p></li>
<li><p>It is hard to compare the <code>female</code> counts, since those bars are stacked on top.</p></li>
<li><p>It is hard to estimate the <em>distributions</em>.</p></li>
</ul>
</section>
<section id="option-2-side-by-side-barplot" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3"><span class="header-section-number">2.3.3</span> Option 2: Side-by-side barplot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb59"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;sex&quot;</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar(position <span class="op">=</span> <span class="st">&quot;dodge&quot;</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-31-13.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="option-2-side-by-side-barplot-1" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4"><span class="header-section-number">2.3.4</span> Option 2: Side-by-side barplot</h3>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon no-icon'></i>
</div>
<div class="callout-body-container">
<p>What are some pros and cons of the side-by-side barplot?</p>
</div>
</div>
</div>
<ul>
<li><p>Pros:</p></li>
<li><p>We can easily compare the <code>female</code> counts in each class</p></li>
<li><p>We can easily compare the <code>male</code> counts in each class</p></li>
<li><p>We can easily see counts of each within each class</p></li>
<li><p>Cons:</p></li>
<li><p>It is hard to see <em>total</em> counts in each class.</p></li>
<li><p>It is hard to estimate the <em>distributions</em>.</p></li>
</ul>
</section>
<section id="option-3-stacked-percentage-barplot" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5"><span class="header-section-number">2.3.5</span> Option 3: Stacked percentage barplot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb61"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;sex&quot;</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar(position <span class="op">=</span> <span class="st">&quot;fill&quot;</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-32-15.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="option-3-stacked-percentage-barplot-1" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6"><span class="header-section-number">2.3.6</span> Option 3: Stacked percentage barplot</h3>
<ul>
<li><p>Cons:</p></li>
<li><p>We can no longer see <strong>any</strong> counts!</p></li>
<li><p>Pros:</p></li>
<li><p>This is the <strong>best</strong> way to compare sex balance across classes!</p></li>
<li><p>This is the option I use the most, because it can answer “Are you more likely to find ______ in ______ ?” type questions.</p></li>
</ul>
</section>
</section>
<section id="activity" class="level2 smaller" data-number="2.4">
<h2 class="smaller" data-number="2.4"><span class="header-section-number">2.4</span> Activity</h2>
<p>Choose one of the plots from lecture so far and “upgrade” it.</p>
<div class="columns">
<div class="column" style="width:60%;">
<p>You can do this by:</p>
<ul>
<li><p>Finding and using a different <code>theme</code></p></li>
<li><p>Using <code>+ labs(...)</code> to change the axis labels and title</p></li>
<li><p>Trying different variables</p></li>
<li><p>Trying a different <em>geometry</em></p></li>
<li><p>Using <code>+ scale_fill_manual(...)</code> to change the colors being used</p></li>
</ul>
</div><div class="column" style="width:40%;">
<p>Hints:</p>
<ul>
<li><p>You will need to use documentation of <code>plotnine</code> and online resources!</p></li>
<li><p>Check out <a href="https://www.data-to-viz.com/" class="uri">https://www.data-to-viz.com/</a> for ideas and example code.</p></li>
<li><p>Ask GenAI questions like, “What do I add to a plotnine bar plot to change the colors?” <em>(But of course, make sure you understand the code you use!)</em></p></li>
</ul>
</div>
</div>
</section>
<section id="joint-distributions" class="level2" data-number="2.5">
<h2 data-number="2.5"><span class="header-section-number">2.5</span> Joint distributions</h2>
<section id="two-categorical-variables" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1"><span class="header-section-number">2.5.1</span> Two categorical variables</h3>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;pclass&quot;</span>, <span class="st">&quot;sex&quot;</span>]].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass  sex   
3       male      493
        female    216
1       male      179
2       male      171
1       female    144
2       female    106
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="two-way-table" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2"><span class="header-section-number">2.5.2</span> Two-way Table</h3>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;pclass&quot;</span>, <span class="st">&quot;sex&quot;</span>]].value_counts().unstack()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sex     female  male
pclass              
1          144   179
2          106   171
3          216   493</code></pre>
</div>
</div>
<ul>
<li>This is sometimes called a <em>cross-tab</em> or <em>cross-tabulation</em>.</li>
</ul>
</section>
<section id="two-way-table---percents" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3"><span class="header-section-number">2.5.3</span> Two-way Table - Percents</h3>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;pclass&quot;</span>, <span class="st">&quot;sex&quot;</span>]].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sex       female      male
pclass                    
1       0.110008  0.136746
2       0.080978  0.130634
3       0.165011  0.376623</code></pre>
</div>
</div>
<ul>
<li>This should add up to 1, aka, 100%!</li>
</ul>
</section>
<section id="switching-variables" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4"><span class="header-section-number">2.5.4</span> Switching variables</h3>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;pclass&quot;</span>]].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass         1         2         3
sex                                 
female  0.110008  0.080978  0.165011
male    0.136746  0.130634  0.376623</code></pre>
</div>
</div>
</section>
<section id="interpretation" class="level3" data-number="2.5.5">
<h3 data-number="2.5.5"><span class="header-section-number">2.5.5</span> Interpretation</h3>
<p>We call this the <strong>joint distribution</strong> of the two variables.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>sex       female      male
pclass                    
1       0.110008  0.136746
2       0.080978  0.130634
3       0.165011  0.376623</code></pre>
</div>
</div>
<blockquote>
<p>Of all the passengers on the Titanic, 11% were females riding in first class.</p>
</blockquote>
<ul>
<li>NOT “11% of all females on Titanic…”</li>
<li>NOT “11% of all first class passengers…”</li>
</ul>
</section>
</section>
<section id="conditional-distributions" class="level2" data-number="2.6">
<h2 data-number="2.6"><span class="header-section-number">2.6</span> Conditional distributions</h2>
<section id="conditional-distribution-from-counts" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1"><span class="header-section-number">2.6.1</span> Conditional distribution from counts</h3>
<p>We know that:</p>
<ul>
<li><p>466 passengers were <strong>female</strong></p></li>
<li><p>144 passengers were <strong>females in first class</strong></p></li>
</ul>
<p>So:</p>
<ul>
<li>144/466 = 31% <strong>of female passengers</strong> rode in first class</li>
</ul>
<p>Here we <strong>conditioned on</strong> the passenger being female, and then looked at the <strong>conditional distribution</strong> of <code>pclass</code>.</p>
</section>
<section id="conditional-distribution-from-counts-1" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2"><span class="header-section-number">2.6.2</span> Conditional distribution from counts</h3>
<p>We know that:</p>
<ul>
<li><p>35.5% of all passengers were <strong>female</strong></p></li>
<li><p>11% of all passengers were <strong>females in first class</strong></p></li>
</ul>
<p>So:</p>
<ul>
<li>0.11/0.355 = 31% <strong>of female passengers</strong> rode in first class</li>
</ul>
<p>Here we <strong>conditioned on</strong> the passenger being female, and then looked at the <strong>conditional distribution</strong> of <code>pclass</code>.</p>
</section>
<section id="swapping-variables" class="level3" data-number="2.6.3">
<h3 data-number="2.6.3"><span class="header-section-number">2.6.3</span> Swapping variables</h3>
<p>We know that:</p>
<ul>
<li><p>323 passengers <strong>rode in first class</strong></p></li>
<li><p>144 passengers were <strong>females in first class</strong></p></li>
</ul>
<p>So:</p>
<ul>
<li>144/323 = 44.6% <strong>of first class passengers</strong> were female</li>
</ul>
<p>Here we <strong>conditioned on</strong> the passenger being in first class, and then looked at the <strong>conditional distribution</strong> of <code>sex</code>.</p>
</section>
<section id="which-one-to-condition-on" class="level3" data-number="2.6.4">
<h3 data-number="2.6.4"><span class="header-section-number">2.6.4</span> Which one to condition on?</h3>
<ul>
<li><p>This depends on the <strong>research question</strong> you are trying to answer.</p></li>
<li><p>“What class did most female passengers ride in?”</p></li>
<li><p>-&gt; Of all <em>female passengers</em>, what is the conditional distribution of <em>class</em>?</p></li>
<li><p>“What was the gender breakdown of first class?”</p></li>
<li><p>-&gt; Of all <em>first class passengers</em>, what is the conditional distribution of <em>sex</em>?</p></li>
</ul>
</section>
<section id="calculating-in-python" class="level3" data-number="2.6.5">
<h3 data-number="2.6.5"><span class="header-section-number">2.6.5</span> Calculating in python</h3>
<p>When we study two variables, we call the individual one-variable distributions the <strong>marginal distribution</strong> of that variable.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>marginal_class <span class="op">=</span> df[<span class="st">&#39;pclass&#39;</span>].value_counts(normalize <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>marginal_class</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass
3    0.541635
1    0.246753
2    0.211612
Name: proportion, dtype: float64</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>marginal_sex <span class="op">=</span> df[<span class="st">&#39;sex&#39;</span>].value_counts(normalize <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>marginal_sex</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sex
male      0.644003
female    0.355997
Name: proportion, dtype: float64</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="calculating-in-python-1" class="level3" data-number="2.6.6">
<h3 data-number="2.6.6"><span class="header-section-number">2.6.6</span> Calculating in python</h3>
<p>We need to divide the <strong>joint distribution</strong> (e.g. “11% of passengers were first class female”) by the <strong>marginal distribution</strong> of the variable we want to <strong>condition on</strong> (e.g. 35.5% of passengers were female).</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>joint_class_sex <span class="op">=</span> df[[<span class="st">&quot;pclass&quot;</span>, <span class="st">&quot;sex&quot;</span>]].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack()</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>joint_class_sex.divide(marginal_sex)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sex       female      male
pclass                    
1       0.309013  0.212337
2       0.227468  0.202847
3       0.463519  0.584816</code></pre>
</div>
</div>
</section>
<section id="conditional-on-sex" class="level3" data-number="2.6.7">
<h3 data-number="2.6.7"><span class="header-section-number">2.6.7</span> Conditional on sex</h3>
<p>Check: Should the <strong>rows</strong> or <strong>columns</strong> add up to 100%? Why?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>sex       female      male
pclass                    
1       0.309013  0.212337
2       0.227468  0.202847
3       0.463519  0.584816</code></pre>
</div>
</div>
</section>
<section id="check-in-on-the-board" class="level3" data-number="2.6.8">
<h3 data-number="2.6.8"><span class="header-section-number">2.6.8</span> Check-In (on the board)</h3>
<p>How does <code>.divide()</code> work?</p>
</section>
<section id="conditional-on-class" class="level3" data-number="2.6.9">
<h3 data-number="2.6.9"><span class="header-section-number">2.6.9</span> Conditional on class</h3>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>joint_class_sex <span class="op">=</span> df[[<span class="st">&quot;sex&quot;</span>,<span class="st">&quot;pclass&quot;</span>]].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>joint_class_sex.divide(marginal_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass        1         2         3
sex                                
female  0.44582  0.382671  0.304654
male    0.55418  0.617329  0.695346</code></pre>
</div>
</div>
</section>
<section id="what-if-you-get-it-backwards" class="level3" data-number="2.6.10">
<h3 data-number="2.6.10"><span class="header-section-number">2.6.10</span> What if you get it backwards?</h3>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>joint_class_sex <span class="op">=</span> df[[<span class="st">&quot;pclass&quot;</span>,<span class="st">&quot;sex&quot;</span>]].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack()</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>joint_class_sex.divide(marginal_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1   2   3  female  male
pclass                          
1      NaN NaN NaN     NaN   NaN
2      NaN NaN NaN     NaN   NaN
3      NaN NaN NaN     NaN   NaN</code></pre>
</div>
</div>
</section>
<section id="visualization" class="level3" data-number="2.6.11">
<h3 data-number="2.6.11"><span class="header-section-number">2.6.11</span> Visualization</h3>
<p>Which plot better answers the question, “Did women tend to ride in first class more than men?”</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb83"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;sex&quot;</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar(position <span class="op">=</span> <span class="st">&quot;fill&quot;</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-44-17.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb85"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;sex&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar(position <span class="op">=</span> <span class="st">&quot;fill&quot;</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-45-19.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="takeaways" class="level2" data-number="2.7">
<h2 data-number="2.7"><span class="header-section-number">2.7</span> Takeaways</h2>
<section id="takeaways-1" class="level3 smaller" data-number="2.7.1">
<h3 class="smaller" data-number="2.7.1"><span class="header-section-number">2.7.1</span> Takeaways</h3>
<ul>
<li><p>We use <code>plotnine</code> and the <strong>grammar of graphics</strong> to make visuals.</p></li>
<li><p>For two categorical variables, we might use a <strong>stacked bar plot</strong>, a <strong>side-by-side bar plot</strong>, or a <strong>stacked percentage bar plot</strong> - depending on what we are trying to show.</p></li>
<li><p>The <strong>joint distribution</strong> of two variables gives the percents in each subcategory.</p></li>
<li><p>The <strong>marginal distribution</strong> of a variable is its individual distribution.</p></li>
<li><p>The <strong>conditional distribution</strong> of a variable is its distribution among <em>only one category</em> of a different variable.</p></li>
<li><p>We calculate the <strong>conditional distribution</strong> by dividing the <strong>joint</strong> by the <strong>marginal</strong>.</p></li>
</ul>
</section>
</section>
<section id="visualizing-and-summarizing-quantitative-variables" class="level1 lectitle" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Visualizing and Summarizing Quantitative Variables</h1>
<p><a href="slides-03-quantitative_variables.html">Slides</a></p>
</section>
<section id="the-story-so-far-1" class="level2" data-number="3.1">
<h2 data-number="3.1"><span class="header-section-number">3.1</span> The story so far</h2>
<section id="getting-prepping-and-summarizing-data" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1"><span class="header-section-number">3.1.1</span> Getting, prepping, and summarizing data</h3>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/titanic.csv&quot;</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;pclass&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;pclass&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;survived&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;survived&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="marginal-distributions" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2"><span class="header-section-number">3.1.2</span> Marginal Distributions</h3>
<p>If I choose a passenger <strong>at random</strong>, what is the <strong>probability</strong> they rode in 1st class?</p>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>marginal_class <span class="op">=</span> df[<span class="st">&#39;pclass&#39;</span>].value_counts(normalize <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>marginal_class</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pclass
3    0.541635
1    0.246753
2    0.211612
Name: proportion, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="joint-distributions-1" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3"><span class="header-section-number">3.1.3</span> Joint Distributions</h3>
<p>If I choose a passenger <strong>at random</strong>, what is the <strong>probability</strong> they are a woman who rode in first class?</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>joint_class_sex <span class="op">=</span> df[[<span class="st">&quot;pclass&quot;</span>, <span class="st">&quot;sex&quot;</span>]].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack()</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>joint_class_sex</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sex       female      male
pclass                    
1       0.110008  0.136746
2       0.080978  0.130634
3       0.165011  0.376623</code></pre>
</div>
</div>
</section>
<section id="conditional-distributions-1" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4"><span class="header-section-number">3.1.4</span> Conditional Distributions</h3>
<p>If I choose a <strong>woman</strong> at random, what is the probability they rode in first class?</p>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>marginal_sex <span class="op">=</span> df[<span class="st">&#39;sex&#39;</span>].value_counts(normalize <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>joint_class_sex.divide(marginal_sex)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sex       female      male
pclass                    
1       0.309013  0.212337
2       0.227468  0.202847
3       0.463519  0.584816</code></pre>
</div>
</div>
</section>
<section id="visualizing-with-the-grammar-of-graphics" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5"><span class="header-section-number">3.1.5</span> Visualizing with the Grammar of Graphics</h3>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;sex&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;pclass&quot;</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar(position <span class="op">=</span> <span class="st">&quot;fill&quot;</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="quantitative-variables" class="level2" data-number="3.2">
<h2 data-number="3.2"><span class="header-section-number">3.2</span> Quantitative Variables</h2>
<p>We have analyzed a quantitative variable already. Where?</p>
<p>In the Colombia COVID data!</p>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df_CO <span class="op">=</span> pd.read_csv(<span class="st">&quot;http://dlsun.github.io/pods/data/covid/colombia_2020-05-28.csv&quot;</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>df_CO</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Departamento  Edad  ... Fecha de diagnóstico Fecha recuperado
0            Bogotá D.C.    19  ...           2020-03-06       2020-03-13
1        Valle del Cauca    34  ...           2020-03-09       2020-03-19
2              Antioquia    50  ...           2020-03-09       2020-03-15
3              Antioquia    55  ...           2020-03-11       2020-03-26
4              Antioquia    25  ...           2020-03-11       2020-03-23
...                  ...   ...  ...                  ...              ...
25361  Buenaventura D.E.    48  ...           2020-05-28              NaN
25362    Valle del Cauca    55  ...           2020-05-28              NaN
25363  Buenaventura D.E.    39  ...           2020-05-28              NaN
25364    Valle del Cauca    13  ...           2020-05-28              NaN
25365            Córdoba     0  ...           2020-05-28              NaN

[25366 rows x 10 columns]</code></pre>
</div>
</div>
</section>
<section id="visualizing-one-quantitative-variable" class="level2" data-number="3.3">
<h2 data-number="3.3"><span class="header-section-number">3.3</span> Visualizing One Quantitative Variable</h2>
<section id="option-convert-it-to-categorical" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1"><span class="header-section-number">3.3.1</span> Option: Convert it to categorical</h3>
<p>To visualize the age variable, we did the following:</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df_CO[<span class="st">&quot;age&quot;</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    df_CO[<span class="st">&quot;Edad&quot;</span>],</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">120</span>],</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">&quot;0-9&quot;</span>, <span class="st">&quot;10-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-39&quot;</span>, <span class="st">&quot;40-49&quot;</span>, <span class="st">&quot;50-59&quot;</span>, <span class="st">&quot;60-69&quot;</span>, <span class="st">&quot;70-79&quot;</span>, <span class="st">&quot;80+&quot;</span>],</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    right<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
</div>
</section>
<section id="option-convert-it-to-categorical-1" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2"><span class="header-section-number">3.3.2</span> Option: Convert it to categorical</h3>
<p>Then, we could treat <code>age</code> as categorical and make a <strong>barplot</strong>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb99"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;age&quot;</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_bar()</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-55-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="better-option-histogram" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3"><span class="header-section-number">3.3.3</span> Better option: Histogram</h3>
<p>A <strong>histogram</strong> uses <em>equal sized bins</em> to summarize a <em>quantitative variable</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram()</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/stats/stat_bin.py:109: PlotnineWarning: &#39;stat_bin()&#39; using &#39;bins = 59&#39;. Pick better value with &#39;binwidth&#39;.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-56-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="histogram" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4"><span class="header-section-number">3.3.4</span> Histogram</h3>
<p>A histogram <strong>must</strong> use a <strong>quantitative variable</strong> to look right:</p>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;age&quot;</span>))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram()</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/stats/stat_bin.py:109: PlotnineWarning: &#39;stat_bin()&#39; using &#39;bins = 40&#39;. Pick better value with &#39;binwidth&#39;.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-57-7.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="histogram-1" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5"><span class="header-section-number">3.3.5</span> Histogram</h3>
<p>To tweak your histogram, you can change the <strong>number of bins</strong>:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb105"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-58-9.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb107"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-59-11.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div>
</div>
</section>
<section id="percents-instead-of-counts" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6"><span class="header-section-number">3.3.6</span> Percents instead of counts</h3>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>, y <span class="op">=</span> <span class="st">&#39;..density..&#39;</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-60-13.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="distributions" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7"><span class="header-section-number">3.3.7</span> Distributions</h3>
<ul>
<li><p>Recall the distribution of a categorical variable: What are the <strong>possible values</strong> and <strong>how common</strong> is each?</p></li>
<li><p>The <strong>distribution</strong> of a quantitative variable is similar: The total <em>area</em> in the histogram is 1.0 (or 100%).</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb111"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>, y <span class="op">=</span> <span class="st">&#39;..density..&#39;</span>))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-61-15.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="densities" class="level3" data-number="3.3.8">
<h3 data-number="3.3.8"><span class="header-section-number">3.3.8</span> Densities</h3>
<ul>
<li><p>In this example, we have a limited set of possible values for <code>age</code>: 0, 1, 2, …., 100. We call this <strong>discrete</strong>.</p></li>
<li><p>What if had a <strong>quantitative variable</strong> with <strong>infinite values</strong>?</p></li>
<li><p>For example: Price of a ticket on Titanic.</p></li>
<li><p>We call this <strong>continuous</strong>.</p></li>
<li><p>In this case, it is not possible to list all <strong>possible values</strong> and <strong>how likely each one is</strong>.</p>
<ul>
<li>One person paid $2.35</li>
<li>Two people paid $12.50</li>
<li>One person paid $34.98</li>
<li>…..?</li>
</ul></li>
<li><p>Instead, we talk about <strong>ranges</strong> of values.</p></li>
</ul>
</section>
<section id="densities-1" class="level3" data-number="3.3.9">
<h3 data-number="3.3.9"><span class="header-section-number">3.3.9</span> Densities</h3>
<p>About what percent of people in this dataset are below 18?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb113"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>, y <span class="op">=</span> <span class="st">&#39;..density..&#39;</span>))</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-62-17.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="densities-2" class="level3" data-number="3.3.10">
<h3 data-number="3.3.10"><span class="header-section-number">3.3.10</span> Densities</h3>
<p>About what percent of people in this dataset are below 18?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb115"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_CO, aes(x <span class="op">=</span> <span class="st">&quot;Edad&quot;</span>))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density()</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic()</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-63-19.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="summarizing-one-quantitative-variable" class="level2" data-number="3.4">
<h2 data-number="3.4"><span class="header-section-number">3.4</span> Summarizing One Quantitative Variable</h2>
<section id="summarizing-a-quantitative-variable" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1"><span class="header-section-number">3.4.1</span> Summarizing a Quantitative Variable</h3>
<p>If you had to summarize this variable with <strong>one single number</strong>, how would you pick?</p>
<div class="cell">
<div class="sourceCode" id="cb117"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df_CO[<span class="st">&#39;Edad&#39;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0        19
1        34
2        50
3        55
4        25
         ..
25361    48
25362    55
25363    39
25364    13
25365     0
Name: Edad, Length: 25366, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="summaries-of-center-mean" class="level2" data-number="3.5">
<h2 data-number="3.5"><span class="header-section-number">3.5</span> Summaries of Center: Mean</h2>
<section id="mean" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1"><span class="header-section-number">3.5.1</span> Mean</h3>
<ul>
<li><p>One summary of the center of a quantitative variable is the <strong>mean</strong>.</p></li>
<li><p>When you hear “The average age is…” or the “The average income is…”, this probably refers to the mean.</p></li>
<li><p>Suppose we have five people, ages: <code>4, 84, 12, 27, 7</code></p></li>
<li><p>The <strong>mean age</strong> is: <span class="math display">\[(4 + 84 + 12 + 27 + 7)/5 = 134/5 = 26.8\]</span></p></li>
</ul>
</section>
<section id="notation-interlude" class="level3 smaller" data-number="3.5.2">
<h3 class="smaller" data-number="3.5.2"><span class="header-section-number">3.5.2</span> Notation interlude</h3>
<ul>
<li><p>To refer to our data without having to list all the numbers, we use <span class="math inline">\(x_1, x_2, ..., x_n\)</span></p></li>
<li><p>In the previous example, <span class="math inline">\(x_1 = 4, x_2 = 84, x_3 = 12, x_4 = 27, x_5 = 7\)</span>. So, <span class="math inline">\(n = 5\)</span>.</p></li>
<li><p>To add up all the numbers, we use the <strong>summation notation</strong>: <span class="math display">\[ \sum_{i = 1}^n x_i = 134\]</span></p></li>
<li><p>Therefore, the <strong>mean</strong> is: <span class="math display">\[\bar{x} = \frac{1}{n} \sum_{i = 1}^n x_i\]</span></p></li>
</ul>
</section>
<section id="means-in-python" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3"><span class="header-section-number">3.5.3</span> Means in python</h3>
<p>Long version: find the <strong>sum</strong> and the <strong>number of observations</strong></p>
<div class="cell">
<div class="sourceCode" id="cb119"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>sum_age <span class="op">=</span> df_CO[<span class="st">&quot;Edad&quot;</span>].<span class="bu">sum</span>()</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(df_CO)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>sum_age<span class="op">/</span>n</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>39.04742568792872</code></pre>
</div>
</div>
<p>Short version: use the built-in function!</p>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>df_CO[<span class="st">&quot;Edad&quot;</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>39.04742568792872</code></pre>
</div>
</div>
</section>
<section id="activity-1" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4"><span class="header-section-number">3.5.4</span> Activity</h3>
<p>The mean is only <strong>one option</strong> for summarizing the center of a quantitative variable. It isn’t perfec!</p>
<p>Let’s investigate this.</p>
<ul>
<li><p>Plot the density of ticket prices on titanic</p></li>
<li><p>Calculate the <em>mean</em> price</p></li>
<li><p>See how many people paid <em>more than mean price</em></p></li>
</ul>
</section>
<section id="what-happened" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5"><span class="header-section-number">3.5.5</span> What happened</h3>
<ul>
<li><p>Our <code>fare</code> data was <strong>skewed right</strong>: Most values were small, but a few values were very large.</p></li>
<li><p>These large values “pull” the mean up; just how the value <code>84</code> pulled the average age up in our previous example.</p></li>
<li><p>So, why do we <em>like</em> the mean?</p></li>
</ul>
</section>
<section id="squared-error" class="level3 smaller" data-number="3.5.6">
<h3 class="smaller" data-number="3.5.6"><span class="header-section-number">3.5.6</span> Squared Error</h3>
<ul>
<li><p>Recall: Ages 4, 84, 12, 27, 7.</p></li>
<li><p>Imagine that we had to “guess” the age of the next person.</p></li>
<li><p>If we guess 26.8, then our “squared error” for these five people is:</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb123"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>ages <span class="op">=</span> np.array([<span class="dv">4</span>, <span class="dv">84</span>, <span class="dv">12</span>, <span class="dv">27</span>, <span class="dv">7</span>])</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>sq_error <span class="op">=</span> (ages <span class="op">-</span> <span class="fl">26.8</span>)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>sq_error.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ 519.8, 3271.8,  219. ,    0. ,  392. ])</code></pre>
</div>
</div>
<ul>
<li>If we guess 20, then our “squared error” for these five people is:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb125"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>sq_error <span class="op">=</span> (ages <span class="op">-</span> <span class="dv">20</span>)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>sq_error.<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ 256, 4096,   64,   49,  169])</code></pre>
</div>
</div>
</section>
<section id="minimizing-squared-error" class="level3" data-number="3.5.7">
<h3 data-number="3.5.7"><span class="header-section-number">3.5.7</span> Minimizing squared error</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb127"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>cs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">60</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>sum_squared_distances <span class="op">=</span> []</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> cs:</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  sum_squared_distances.append(((df_CO[<span class="st">&quot;Edad&quot;</span>] <span class="op">-</span> c) <span class="op">**</span> <span class="dv">2</span>).<span class="bu">sum</span>())</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>res_df <span class="op">=</span> pd.DataFrame({<span class="st">&quot;center&quot;</span>: cs, <span class="st">&quot;sq_error&quot;</span>:sum_squared_distances})</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>(ggplot(res_df, aes(x <span class="op">=</span> <span class="st">&#39;center&#39;</span>, y <span class="op">=</span> <span class="st">&#39;sq_error&#39;</span>))</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_line())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-69-21.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="summaries-of-center-median" class="level2" data-number="3.6">
<h2 data-number="3.6"><span class="header-section-number">3.6</span> Summaries of Center: Median</h2>
<section id="median" class="level3 smaller" data-number="3.6.1">
<h3 class="smaller" data-number="3.6.1"><span class="header-section-number">3.6.1</span> Median</h3>
<p>Another summary of center is the <strong>median</strong>, which is the “middle” of the <em>sorted</em> values.</p>
<p>To calculate the median of a quantitative variable with values <span class="math inline">\(x_1, x_2, x_3, ..., x_n\)</span>, we do the following steps:</p>
<ol type="1">
<li><p>Sort the values from smallest to largest: <span class="math display">\[x_{(1)}, x_{(2)}, x_{(3)}, ..., x_{(n)}.\]</span></p></li>
<li><p>The “middle” value depends on whether we have an odd or an even number of observations.</p>
<ul>
<li><p>If <span class="math inline">\(n\)</span> is odd, then the middle value is <span class="math inline">\(x_{(\frac{n+1}{2})}\)</span>.</p></li>
<li><p>If <span class="math inline">\(n\)</span> is even, then there are two middle values, <span class="math inline">\(x_{(\frac{n}{2})}\)</span> and <span class="math inline">\(x_{(\frac{n}{2} + 1)}\)</span>. It is conventional to report the mean of the two values (but you can actually pick any value between them).</p></li>
</ul></li>
</ol>
</section>
<section id="median-1" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2"><span class="header-section-number">3.6.2</span> Median</h3>
<p>Ages: 4, 84, 12, 7, 27. What is the <strong>median</strong>?</p>
<p>Median age in the Columbia data:</p>
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df_CO[<span class="st">&quot;Edad&quot;</span>].median()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>37.0</code></pre>
</div>
</div>
</section>
</section>
<section id="summaries-of-spread-variance" class="level2" data-number="3.7">
<h2 data-number="3.7"><span class="header-section-number">3.7</span> Summaries of Spread: Variance</h2>
<section id="variance" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1"><span class="header-section-number">3.7.1</span> Variance</h3>
<ul>
<li><p>One measure of spread is the <strong>variance</strong>.</p></li>
<li><p>The variance of a variable whose values are <span class="math inline">\(x_1, x_2, x_3, ..., x_n\)</span> is calculated using the formula <span class="math display">\[\textrm{var(X)} = \frac{\sum_{i=1}^n (x_i - \bar{x})^2}{n - 1}\]</span></p></li>
<li><p>Does this look familiar? It’s the <strong>sum of squared error</strong>! (Divided by <span class="math inline">\(n-1\)</span>, the “degrees of freedom”)</p></li>
</ul>
</section>
<section id="variance-in-python" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2"><span class="header-section-number">3.7.2</span> Variance in python</h3>
<p>We could do this manually:</p>
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>(((df_CO[<span class="st">&quot;Edad&quot;</span>] <span class="op">-</span> df_CO[<span class="st">&quot;Edad&quot;</span>].mean()) <span class="op">**</span> <span class="dv">2</span>).<span class="bu">sum</span>() <span class="op">/</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a> (<span class="bu">len</span>(df_CO) <span class="op">-</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>348.0870469898451</code></pre>
</div>
</div>
<p>…or using a built-in Python function.</p>
<div class="cell">
<div class="sourceCode" id="cb133"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>df_CO[<span class="st">&quot;Edad&quot;</span>].var()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>348.0870469898451</code></pre>
</div>
</div>
<pre><code>348.0870469898451</code></pre>
</section>
</section>
<section id="standard-deviation" class="level2" data-number="3.8">
<h2 data-number="3.8"><span class="header-section-number">3.8</span> Standard Deviation</h2>
<ul>
<li><p>Notice that the variance isn’t very <em>intuitive</em>: what do we mean by “The spread is 348”?</p></li>
<li><p>This is because it is the <strong>squared</strong> error!</p></li>
<li><p>So, to get it in more interpretable language, we take the square root:</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb136"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>np.sqrt(df_CO[<span class="st">&quot;Edad&quot;</span>].var())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>18.65709106452142</code></pre>
</div>
</div>
<p>Or, we use the built-in function!</p>
<div class="cell">
<div class="sourceCode" id="cb138"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>df_CO[<span class="st">&quot;Edad&quot;</span>].std()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>18.65709106452142</code></pre>
</div>
</div>
</section>
<section id="takeaways-2" class="level2" data-number="3.9">
<h2 data-number="3.9"><span class="header-section-number">3.9</span> Takeaways</h2>
<section id="takeaway-messages" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1"><span class="header-section-number">3.9.1</span> Takeaway Messages</h3>
<ul>
<li><p>Visualize quantitative variables with <strong>histograms</strong> or <strong>densities</strong>.</p></li>
<li><p>Summarize the <strong>center</strong> of a quantitative variable with <strong>mean</strong> or <strong>median</strong>.</p></li>
<li><p>Describe the <strong>shape</strong> of a quantitative variable with <strong>skew</strong></p></li>
<li><p>Summarize the <strong>spread</strong> of a quantitative variable with the <strong>variance</strong> or the <strong>standard deviation</strong>.</p></li>
</ul>
</section>
</section>
<section id="multivariate-summaries" class="level1 lectitle" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Multivariate Summaries</h1>
<p><a href="slides-04-group_by.html">Slides</a></p>
</section>
<section id="the-story-so-far-2" class="level2" data-number="4.1">
<h2 data-number="4.1"><span class="header-section-number">4.1</span> The story so far</h2>
<section id="last-week" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1"><span class="header-section-number">4.1.1</span> Last week</h3>
<ul>
<li><p>Reading in data and cleaning/prepping it</p></li>
<li><p>Summarizing <strong>one categorical variable</strong> with a distribution</p></li>
<li><p>Summarizing <strong>two categorical variables</strong> with joint and conditional distributions</p></li>
<li><p>Using <code>plotnine</code> and the <strong>grammar of graphics</strong> to make <strong>bar plots</strong> and <strong>column plots</strong>.</p></li>
</ul>
</section>
<section id="quantitative-variables-1" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2"><span class="header-section-number">4.1.2</span> Quantitative variables</h3>
<ul>
<li><p>Visualizing by <strong>converting to categorical</strong></p></li>
<li><p>Visualizing with <strong>histograms</strong> or <strong>densities</strong></p></li>
<li><p>Estimating <strong>probabilities</strong> from histograms and densities.</p></li>
<li><p>Describing the <strong>skew</strong></p></li>
<li><p>Calculating and explaining the <strong>mean</strong> and the <strong>median</strong>.</p></li>
<li><p>Calculating and explaining the <strong>standard deviation</strong> and <strong>variance</strong>.</p></li>
</ul>
</section>
</section>
<section id="comparing-quantities-across-categories" class="level2" data-number="4.2">
<h2 data-number="4.2"><span class="header-section-number">4.2</span> Comparing quantities across categories</h2>
<section id="new-dataset-airplane-flights" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1"><span class="header-section-number">4.2.1</span> New dataset: airplane flights</h3>
<p>RQ: Which airline carriers are most likely to be delayed?</p>
<p>Let’s look at a data set of all domestic flights that departed from one of the New York City airports (JFK, LaGuardia, and Newark) on November 16, 2013.</p>
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">&quot;https://datasci112.stanford.edu/data/&quot;</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(data_dir <span class="op">+</span> <span class="st">&quot;flights_nyc_20131116.csv&quot;</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    carrier  flight origin dest  dep_delay
0        US    1895    EWR  CLT       -5.0
1        UA    1014    LGA  IAH       -3.0
2        AA    2243    JFK  MIA        2.0
3        UA     303    JFK  SFO       -8.0
4        US     795    LGA  PHL       -8.0
..      ...     ...    ...  ...        ...
573      B6     745    JFK  PSE       -3.0
574      B6     839    JFK  BQN        0.0
575      UA     360    EWR  PBI        NaN
576      US    1946    EWR  CLT        NaN
577      US    2142    LGA  BOS        NaN

[578 rows x 5 columns]</code></pre>
</div>
</div>
</section>
<section id="delays" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2"><span class="header-section-number">4.2.2</span> Delays</h3>
<p>We already know how to <strong>summarize</strong> the flight delays:</p>
<p><em>(Check-in: Interpret these numbers!)</em></p>
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;dep_delay&#39;</span>].median()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-4.0</code></pre>
</div>
<div class="sourceCode" id="cb144"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;dep_delay&#39;</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.0469565217391303</code></pre>
</div>
<div class="sourceCode" id="cb146"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;dep_delay&#39;</span>].std()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>23.52882923523891</code></pre>
</div>
</div>
</section>
<section id="delays-1" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3"><span class="header-section-number">4.2.3</span> Delays</h3>
<p>We already know how to <strong>visualize</strong> the flight delays:</p>
<p><em>(Check-in: How would you describe this distribution?)</em></p>
<div class="cell">
<div class="sourceCode" id="cb148"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;dep_delay&#39;</span>))</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram()</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/stats/stat_bin.py:109: PlotnineWarning: &#39;stat_bin()&#39; using &#39;bins = 152&#39;. Pick better value with &#39;binwidth&#39;.
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_bin : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="delays-by-origin" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4"><span class="header-section-number">4.2.4</span> Delays by origin</h3>
<p>RQ: Do the three origin airports (JFK, LGA, EWR) have different delay patterns?</p>
<p><em>Check-in:</em> What could you change in this code to include the <code>origin</code> variable?</p>
<div class="cell">
<div class="sourceCode" id="cb150"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;dep_delay&#39;</span>))</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram()</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</div>
</section>
<section id="delays-by-origin-1" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5"><span class="header-section-number">4.2.5</span> Delays by origin</h3>
<p>Overlapping <strong>histograms</strong> can be really hard to read…</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb151"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;dep_delay&#39;</span>, fill <span class="op">=</span> <span class="st">&#39;origin&#39;</span>))</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram()</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/stats/stat_bin.py:109: PlotnineWarning: &#39;stat_bin()&#39; using &#39;bins = 152&#39;. Pick better value with &#39;binwidth&#39;.
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_bin : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-81-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="delays-by-origin-2" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6"><span class="header-section-number">4.2.6</span> Delays by origin</h3>
<p>… but overlapping <strong>densities</strong> often look nicer…</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb153"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;dep_delay&#39;</span>, fill <span class="op">=</span> <span class="st">&#39;origin&#39;</span>))</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density()</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_density : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-82-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="delays-by-origin-3" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7"><span class="header-section-number">4.2.7</span> Delays by origin</h3>
<p>… especially if we make them a little see-through!</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb155"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;dep_delay&#39;</span>, fill <span class="op">=</span> <span class="st">&#39;origin&#39;</span>))</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density(alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_density : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-83-7.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="variable-transformations" class="level3" data-number="4.2.8">
<h3 data-number="4.2.8"><span class="header-section-number">4.2.8</span> Variable transformations</h3>
<ul>
<li><p>That last plot was okay, but it was hard to see the details, because the distribution is so <strong>skewed right</strong>.</p></li>
<li><p>Sometimes, for easier visualization, it is worth <strong>transforming</strong> a variable.</p></li>
<li><p>Often we use a <strong>log</strong> transformation.</p></li>
</ul>
</section>
<section id="log-transformation" class="level3 smaller" data-number="4.2.9">
<h3 class="smaller" data-number="4.2.9"><span class="header-section-number">4.2.9</span> Log transformation</h3>
<ul>
<li>Example: Salaries of $10,000 and $100,000 and $10,000,000:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb157"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.DataFrame({<span class="st">&quot;salary&quot;</span>: [<span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">10000000</span>]})</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">&quot;log_salary&quot;</span>] <span class="op">=</span> np.log(dat[<span class="st">&quot;salary&quot;</span>])</span></code></pre></div>
</details>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb158"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>(ggplot(dat, aes(x <span class="op">=</span> <span class="st">&quot;salary&quot;</span>))</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-85-9.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb160"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>(ggplot(dat, aes(x <span class="op">=</span> <span class="st">&quot;log_salary&quot;</span>))</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_histogram(bins <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-86-11.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div>
</div>
</section>
<section id="log-transformations" class="level3" data-number="4.2.10">
<h3 data-number="4.2.10"><span class="header-section-number">4.2.10</span> Log transformations</h3>
<ul>
<li><p>Usually, we use the <strong>natural log</strong>, just for convenience.</p></li>
<li><p>Pros: Skewed data looks <strong>less skewed</strong>, so it is easier to see <strong>patterns</strong></p></li>
<li><p>Cons: The variable is now on a <strong>different scale</strong> so it is not as <strong>interpretable</strong></p></li>
<li><p><strong>Caution!</strong> Log transformations need <em>positive numbers</em>.</p></li>
</ul>
</section>
<section id="delays-by-origin---transformed" class="level3" data-number="4.2.11">
<h3 data-number="4.2.11"><span class="header-section-number">4.2.11</span> Delays by origin - transformed</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb162"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shift delays to be above zero</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;delay_shifted&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;dep_delay&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;dep_delay&#39;</span>].<span class="bu">min</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Log transform</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;log_delay&#39;</span>] <span class="op">=</span> np.log(df[<span class="st">&#39;delay_shifted&#39;</span>])</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;log_delay&#39;</span>, fill <span class="op">=</span> <span class="st">&#39;origin&#39;</span>))</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density(alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_density : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-87-13.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="boxplots" class="level2" data-number="4.3">
<h2 data-number="4.3"><span class="header-section-number">4.3</span> Boxplots</h2>
<section id="another-option-boxplots" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1"><span class="header-section-number">4.3.1</span> Another option: Boxplots</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb164"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(y <span class="op">=</span> <span class="st">&#39;log_delay&#39;</span>, x <span class="op">=</span> <span class="st">&#39;origin&#39;</span>))</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_boxplot()</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_boxplot : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-88-15.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="facetting" class="level2" data-number="4.4">
<h2 data-number="4.4"><span class="header-section-number">4.4</span> Facetting</h2>
<section id="facetting-1" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1"><span class="header-section-number">4.4.1</span> Facetting</h3>
<ul>
<li><p>This plot still was a <em>little</em> hard to read.</p></li>
<li><p>What if we just made <strong>separate plots</strong> for each origin?</p></li>
<li><p>Kind of annoying…</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb166"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>is_jfk <span class="op">=</span> (df[<span class="st">&#39;origin&#39;</span>] <span class="op">==</span> <span class="st">&quot;JFK&quot;</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>df_jfk <span class="op">=</span> df[is_jfk]</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>df_jfk</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    carrier  flight origin dest  dep_delay  delay_shifted  log_delay
2        AA    2243    JFK  MIA        2.0           22.0   3.091042
3        UA     303    JFK  SFO       -8.0           12.0   2.484907
11       EV    5716    JFK  IAD       -4.0           16.0   2.772589
12       B6     583    JFK  MCO       -3.0           17.0   2.833213
14       B6    1403    JFK  SJU       -2.0           18.0   2.890372
..      ...     ...    ...  ...        ...            ...        ...
570      B6     718    JFK  BOS        1.0           21.0   3.044522
571      B6    1816    JFK  SYR       20.0           40.0   3.688879
572      B6    1503    JFK  SJU      -10.0           10.0   2.302585
573      B6     745    JFK  PSE       -3.0           17.0   2.833213
574      B6     839    JFK  BQN        0.0           20.0   2.995732

[208 rows x 7 columns]</code></pre>
</div>
</div>
</section>
<section id="aside-boolean-masking" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2"><span class="header-section-number">4.4.2</span> (Aside: Boolean masking)</h3>
<div class="cell">
<div class="sourceCode" id="cb168"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>is_jfk <span class="op">=</span> (df[<span class="st">&#39;origin&#39;</span>] <span class="op">==</span> <span class="st">&quot;JFK&quot;</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>is_jfk</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0      False
1      False
2       True
3       True
4      False
       ...  
573     True
574     True
575    False
576    False
577    False
Name: origin, Length: 578, dtype: bool</code></pre>
</div>
</div>
</section>
<section id="facetting-2" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3"><span class="header-section-number">4.4.3</span> Facetting</h3>
<p>Fortunately, <code>plotnine</code> (and other plotting packages) has a trick for you!</p>
<div class="cell">
<div class="sourceCode" id="cb170"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&#39;dep_delay&#39;</span>))</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density()</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> facet_wrap(<span class="st">&#39;origin&#39;</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:284: PlotnineWarning: stat_density : Removed 3 rows containing non-finite values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-91-17.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="summaries-by-groups" class="level2" data-number="4.5">
<h2 data-number="4.5"><span class="header-section-number">4.5</span> Summaries by groups</h2>
<section id="split-apply-combine" class="level3 smaller" data-number="4.5.1">
<h3 class="smaller" data-number="4.5.1"><span class="header-section-number">4.5.1</span> Split-apply-combine</h3>
<ul>
<li><p>Our visualizations told us some of the story, but can we use <strong>numeric summaries</strong> as well?</p></li>
<li><p>To do this, we want to calculate the <strong>mean</strong> or <strong>median</strong> delay time for <strong>each</strong> origin airport.</p></li>
<li><p>We call this <strong>split-apply-combine</strong>:</p>
<ul>
<li><strong>split</strong> the dataset up by a categorical variable <code>origin</code></li>
<li><strong>apply</strong> a calculation like <code>mean</code></li>
<li><strong>combine</strong> the results back into one dataset</li>
</ul></li>
<li><p>In <code>pandas</code>, we use the <code>groupby()</code> function to take care of the <em>split</em> and <em>combine</em> steps!</p></li>
</ul>
</section>
<section id="group-by" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2"><span class="header-section-number">4.5.2</span> Group-by</h3>
<div class="cell">
<div class="sourceCode" id="cb172"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&quot;origin&quot;</span>)[<span class="st">&quot;dep_delay&quot;</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>origin
EWR    4.064935
JFK    1.461538
LGA   -0.485294
Name: dep_delay, dtype: float64</code></pre>
</div>
<div class="sourceCode" id="cb174"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&quot;origin&quot;</span>)[<span class="st">&quot;dep_delay&quot;</span>].median()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>origin
EWR   -3.0
JFK   -4.0
LGA   -6.0
Name: dep_delay, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="group-by-1" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3"><span class="header-section-number">4.5.3</span> Group-by</h3>
<p><em>Check-in:</em></p>
<ul>
<li><p>Which code is causing “split by origin”?</p></li>
<li><p>Which code is causing “calculate the mean of delays”?</p></li>
<li><p>Which code is causing the re-combining of the data?</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb176"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&quot;origin&quot;</span>)[<span class="st">&quot;dep_delay&quot;</span>].mean()</span></code></pre></div>
</div>
</section>
</section>
<section id="standardized-values" class="level2" data-number="4.6">
<h2 data-number="4.6"><span class="header-section-number">4.6</span> Standardized values</h2>
<section id="toy-example-exam-scores" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1"><span class="header-section-number">4.6.1</span> Toy example: exam scores</h3>
<p>Hermione’s exam scores are is:</p>
<ul>
<li><p>Potions class: 77/100</p></li>
<li><p>Charms class: 95/100</p></li>
<li><p>Herbology class: 90/100</p></li>
</ul>
<p>In which class did she do best?</p>
</section>
<section id="toy-example-exam-scores-1" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2"><span class="header-section-number">4.6.2</span> Toy example: exam scores</h3>
<p><strong>But wait!</strong></p>
<p>The class <strong>means</strong> are:</p>
<ul>
<li><p>Potions class: 75/100</p></li>
<li><p>Charms class: 85/100</p></li>
<li><p>Herbology class: 85/100</p></li>
</ul>
<p>In which class did she do best?</p>
</section>
<section id="toy-example-exam-scores-2" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3"><span class="header-section-number">4.6.3</span> Toy example: exam scores</h3>
<p><strong>But wait!</strong></p>
<p>The class <strong>standard deviations</strong> are:</p>
<ul>
<li><p>Potions class: 2 points</p></li>
<li><p>Charms class: 5 points</p></li>
<li><p>Herbology class: 1 point</p></li>
</ul>
<p>In which class did she do best?</p>
</section>
<section id="different-variabilities-by-origin" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4"><span class="header-section-number">4.6.4</span> Different variabilities by origin</h3>
<ul>
<li>In addition to having different <strong>centers</strong>, the three origins also have different <strong>spreads</strong>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb177"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">&quot;origin&quot;</span>)[<span class="st">&quot;dep_delay&quot;</span>].std()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>origin
EWR    25.646258
JFK    18.713927
LGA    26.121365
Name: dep_delay, dtype: float64</code></pre>
</div>
</div>
<ul>
<li>That is, values are <strong>less close</strong> to the mean in general for flights from <code>LGA</code> than from <code>JFK</code>.</li>
</ul>
</section>
<section id="standardized-values-1" class="level3" data-number="4.6.5">
<h3 data-number="4.6.5"><span class="header-section-number">4.6.5</span> Standardized values</h3>
<p>Suppose you fly from <code>LGA</code> and your flight is 40 minutes late</p>
<p>Your friend flies from <code>JFK</code> and their flight is 30 minutes late</p>
<p>Who got “unluckier”?</p>
<div class="cell">
<div class="sourceCode" id="cb179"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">40</span> <span class="op">+</span> <span class="fl">0.48</span>)<span class="op">/</span><span class="dv">26</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.5569230769230769</code></pre>
</div>
<div class="sourceCode" id="cb181"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">30</span> <span class="op">-</span> <span class="fl">1.46</span>)<span class="op">/</span><span class="fl">18.7</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.5262032085561497</code></pre>
</div>
</div>
</section>
<section id="standardized-values-2" class="level3" data-number="4.6.6">
<h3 data-number="4.6.6"><span class="header-section-number">4.6.6</span> Standardized values</h3>
<ul>
<li><p>We <strong>standardize</strong> values by subtracting the mean and dividing by the standard deviation.</p></li>
<li><p>This tells us how much better/worse <em>than typical values</em> our target value is.</p></li>
<li><p>This is also called the <strong>z-score</strong>. <span class="math display">\[z_i = \frac{x_i - \bar{x}}{s_x}\]</span></p></li>
</ul>
</section>
<section id="activity-2" class="level3" data-number="4.6.7">
<h3 data-number="4.6.7"><span class="header-section-number">4.6.7</span> Activity</h3>
<p>Research question: What airlines have the most delays?</p>
<ul>
<li><p>Make a <strong>plot</strong> to answer the question.</p></li>
<li><p>Calculate values to answer the question.</p></li>
<li><p>The first row is a flight from EWR to CLT on US Airways. The second row is a flight from LGA to IAH on United Airlines. Which one was a “more extreme” delay?</p></li>
</ul>
</section>
</section>
<section id="relationships-between-quantitative-variables" class="level2" data-number="4.7">
<h2 data-number="4.7"><span class="header-section-number">4.7</span> Relationships between quantitative variables</h2>
<section id="scatter-plots" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1"><span class="header-section-number">4.7.1</span> Scatter plots</h3>
<p>To <strong>visualize</strong> two quantitative variables, we make a <strong>scatter plot</strong> (or <em>point</em> geometry).</p>
<p>RQ: Did <em>older</em> passengers pay a <em>higher</em> fare on the Titanic?</p>
<div class="cell">
<div class="sourceCode" id="cb183"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>df_titanic <span class="op">=</span> pd.read_csv(data_dir <span class="op">+</span> <span class="st">&quot;titanic.csv&quot;</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>(ggplot(df_titanic, aes(x <span class="op">=</span> <span class="st">&#39;age&#39;</span>, y <span class="op">=</span> <span class="st">&#39;fare&#39;</span>))</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 264 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-96-19.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="scatter-plots-1" class="level3" data-number="4.7.2">
<h3 data-number="4.7.2"><span class="header-section-number">4.7.2</span> Scatter plots</h3>
<p>Notice:</p>
<ul>
<li><p>The <strong>explanatory variable</strong> was on the <strong>x-axis</strong>.</p></li>
<li><p>The <strong>response variable</strong> was on the <strong>y-axis</strong>.</p></li>
<li><p>“If you are older, you pay more” not “If you pay more, you get older”.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb185"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_titanic, aes(x <span class="op">=</span> <span class="st">&#39;age&#39;</span>, y <span class="op">=</span> <span class="st">&#39;fare&#39;</span>))</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
</div>
</section>
<section id="scatter-plots-2" class="level3" data-number="4.7.3">
<h3 data-number="4.7.3"><span class="header-section-number">4.7.3</span> Scatter plots</h3>
<p>How could we make this nicer?</p>
<ol type="1">
<li><p>Do a log-transformation of <code>fare</code>, because it is very skewed.</p></li>
<li><p>Add in a third variable, <code>pclass</code>. How might you do this?</p></li>
</ol>
</section>
<section id="scatter-plots-3" class="level3" data-number="4.7.4">
<h3 data-number="4.7.4"><span class="header-section-number">4.7.4</span> Scatter plots</h3>
<p>Challenge: Can you re-create this plot?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/core/arraylike.py:399: RuntimeWarning: divide by zero encountered in log</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 264 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-98-21.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="describing-the-relationship" class="level3" data-number="4.7.5">
<h3 data-number="4.7.5"><span class="header-section-number">4.7.5</span> Describing the relationship</h3>
<p>Let’s look at just third class:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb188"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>is_third<span class="op">=</span> df_titanic[<span class="st">&#39;pclass&#39;</span>] <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>df_third <span class="op">=</span> df_titanic[is_third]</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>(ggplot(df_third, aes(x <span class="op">=</span> <span class="st">&#39;age&#39;</span>, y <span class="op">=</span> <span class="st">&#39;fare&#39;</span>))</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point()</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 209 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-99-23.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="describing-the-relationship-1" class="level3" data-number="4.7.6">
<h3 data-number="4.7.6"><span class="header-section-number">4.7.6</span> Describing the relationship</h3>
<p>This relationship was:</p>
<ul>
<li><p>Not very <strong>strong</strong>: the points don’t follow a clear pattern</p></li>
<li><p>Slightly <strong>negative</strong>: When age was higher, fare was a little lower.</p></li>
<li><p>Not very <strong>linear</strong>: the points don’t form a straight line</p></li>
</ul>
</section>
<section id="correlation" class="level3" data-number="4.7.7">
<h3 data-number="4.7.7"><span class="header-section-number">4.7.7</span> Correlation</h3>
<ul>
<li><p>What if we want a <strong>numerical summary</strong> of the relationship between variables?</p></li>
<li><p>Do “older than average” people pay “higher than average” fares?</p></li>
<li><p>When the <strong>z-score</strong> of age was high, was the <strong>z-score</strong> of fare high?</p></li>
</ul>
</section>
<section id="correlation-1" class="level3" data-number="4.7.8">
<h3 data-number="4.7.8"><span class="header-section-number">4.7.8</span> Correlation</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb190"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>is_third<span class="op">=</span> df_titanic[<span class="st">&#39;pclass&#39;</span>] <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>df_first <span class="op">=</span> df_titanic[is_third]</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>mean_age <span class="op">=</span> df_third[<span class="st">&#39;age&#39;</span>].mean()</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>mean_fare <span class="op">=</span> df_third[<span class="st">&#39;fare&#39;</span>].mean()</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>(ggplot(df_third, aes(x <span class="op">=</span> <span class="st">&#39;age&#39;</span>, y <span class="op">=</span> <span class="st">&#39;fare&#39;</span>))</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point()</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_vline(xintercept <span class="op">=</span> mean_age, color <span class="op">=</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_hline(yintercept <span class="op">=</span> mean_fare, color <span class="op">=</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 209 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-100-25.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="correlation-2" class="level3" data-number="4.7.9">
<h3 data-number="4.7.9"><span class="header-section-number">4.7.9</span> Correlation</h3>
<p>Interpret this result:</p>
<div class="cell">
<div class="sourceCode" id="cb192"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>df_third[[<span class="st">&#39;age&#39;</span>, <span class="st">&#39;fare&#39;</span>]].corr()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           age      fare
age   1.000000 -0.238137
fare -0.238137  1.000000</code></pre>
</div>
</div>
</section>
<section id="correlation-3" class="level3" data-number="4.7.10">
<h3 data-number="4.7.10"><span class="header-section-number">4.7.10</span> Correlation</h3>
<p>Interpret this result:</p>
<div class="cell">
<div class="sourceCode" id="cb194"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>df_third[[<span class="st">&#39;age&#39;</span>, <span class="st">&#39;fare&#39;</span>]].corr()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           age      fare
age   1.000000 -0.238137
fare -0.238137  1.000000</code></pre>
</div>
</div>
<p>Age and fare are <strong>slightly negatively correlated</strong>.</p>
<p><em>Can you think of an explanation for this?</em></p>
</section>
<section id="correlation-is-not-slope-or-relationship" class="level3" data-number="4.7.11">
<h3 data-number="4.7.11"><span class="header-section-number">4.7.11</span> Correlation is not <strong>slope</strong> or <strong>relationship</strong></h3>
<p><img src="./images/correlation2.png" class="img-fluid" /></p>
<p>Just for fun: <a href="https://www.guessthecorrelation.com/">Guess the Correlation Game</a></p>
</section>
</section>
<section id="takeaways-3" class="level2" data-number="4.8">
<h2 data-number="4.8"><span class="header-section-number">4.8</span> Takeaways</h2>
<section id="takeaways-4" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1"><span class="header-section-number">4.8.1</span> Takeaways</h3>
<ul>
<li><p>Plot <strong>quantitative variables</strong> across <strong>groups</strong> with <strong>overlapping density</strong> plots, <strong>boxplots</strong>, or by <strong>facetting</strong>.</p></li>
<li><p>Summarize <strong>quantitative variables</strong> across <strong>groups</strong> by using <code>groupby()</code> and then calculating summary statisics.</p></li>
<li><p>Know what <strong>split-apply-combine</strong> means.</p></li>
<li><p>Plot <strong>relationships between quantitative variables</strong> with a <strong>scatter plot</strong></p></li>
<li><p>Describe the <strong>strength</strong>, <strong>direction</strong>, and <strong>shape</strong> of the relationship.</p></li>
<li><p>Summarize <strong>relationships between quantitative variables</strong> with the <strong>correlation</strong></p></li>
</ul>
</section>
</section>
<section id="distances" class="level1 lectitle" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Distances</h1>
<p><a href="slides-05-distances.html">Slides</a></p>
</section>
<section id="the-story-so-far-3" class="level2" data-number="5.1">
<h2 data-number="5.1"><span class="header-section-number">5.1</span> The story so far</h2>
<section id="summarizing" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1"><span class="header-section-number">5.1.1</span> Summarizing</h3>
<ul>
<li><p><strong>One categorical variable:</strong> marginal distribution</p></li>
<li><p><strong>Two categorical variables:</strong> joint and conditional distributions</p></li>
<li><p><strong>One quantitative variable:</strong> mean, median, variance, standard deviation.</p></li>
<li><p><strong>One quantitative, one categorical:</strong> mean, median, and std dev across groups (<code>groupby()</code>, <em>split-apply-combine</em>)</p></li>
<li><p><strong>Two quantitative variables:</strong> z-scores, correlation</p></li>
</ul>
</section>
<section id="visualizing" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2"><span class="header-section-number">5.1.2</span> Visualizing</h3>
<ul>
<li><p><strong>One categorical variable:</strong> bar plot or column plot</p></li>
<li><p><strong>Two categorical variables:</strong> stacked bar plot, side-by-side bar plot, or stacked percentage bar plot</p></li>
<li><p><strong>One quantitative variable:</strong> histogram, density, or boxplot</p></li>
<li><p><strong>One quantitative, one categorical:</strong> overlapping densities, side-by-side boxplots, or facetting</p></li>
<li><p><strong>Two quantitative variables:</strong> scatter plot</p></li>
</ul>
</section>
</section>
<section id="todays-data-house-prices" class="level2" data-number="5.2">
<h2 data-number="5.2"><span class="header-section-number">5.2</span> Today’s data: House prices</h2>
<section id="ames-house-prices" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1"><span class="header-section-number">5.2.1</span> Ames house prices</h3>
<p><em>(Notice: <code>read_table</code> not <code>read_csv</code>)</em></p>
<div class="cell">
<div class="sourceCode" id="cb196"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_table(<span class="st">&quot;https://datasci112.stanford.edu/data/housing.tsv&quot;</span>)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         PID  Gr Liv Area  Bedroom AbvGr  ...  Sale Type  Sale Condition  SalePrice
0  526301100         1656              3  ...        WD           Normal     215000
1  526350040          896              2  ...        WD           Normal     105000
2  526351010         1329              3  ...        WD           Normal     172000
3  526353030         2110              3  ...        WD           Normal     244000
4  527105010         1629              3  ...        WD           Normal     189900

[5 rows x 81 columns]</code></pre>
</div>
</div>
</section>
<section id="how-does-size-relate-to-number-of-bedrooms" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2"><span class="header-section-number">5.2.2</span> How does size relate to number of bedrooms?</h3>
<p>What plot would you make?</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode" id="cb198"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;Gr Liv Area&quot;</span>, y <span class="op">=</span> <span class="st">&quot;Bedroom AbvGr&quot;</span>)) </span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="how-does-size-relate-to-number-of-bedrooms-1" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3"><span class="header-section-number">5.2.3</span> How does size relate to number of bedrooms?</h3>
<p>What <em>statistic</em> would you calculate?</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode" id="cb200"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;Gr Liv Area&quot;</span>, <span class="st">&quot;Bedroom AbvGr&quot;</span>]].corr()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Gr Liv Area  Bedroom AbvGr
Gr Liv Area       1.000000       0.516808
Bedroom AbvGr     0.516808       1.000000</code></pre>
</div>
</div>
</section>
</section>
<section id="measuring-similarity-with-distance" class="level2" data-number="5.3">
<h2 data-number="5.3"><span class="header-section-number">5.3</span> Measuring similarity with distance</h2>
<section id="similarity" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1"><span class="header-section-number">5.3.1</span> Similarity</h3>
<p>How might we answer the question, “Are these two houses similar?”</p>
<div class="cell">
<div class="sourceCode" id="cb202"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">1707</span>, [<span class="st">&quot;Gr Liv Area&quot;</span>, <span class="st">&quot;Bedroom AbvGr&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gr Liv Area      2956
Bedroom AbvGr       5
Name: 1707, dtype: object</code></pre>
</div>
<div class="sourceCode" id="cb204"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">290</span>, [<span class="st">&quot;Gr Liv Area&quot;</span>, <span class="st">&quot;Bedroom AbvGr&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gr Liv Area      2650
Bedroom AbvGr       6
Name: 290, dtype: object</code></pre>
</div>
</div>
</section>
<section id="distance" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2"><span class="header-section-number">5.3.2</span> Distance</h3>
<p>The <strong>distance</strong> between the <strong>two observations</strong> is:</p>
<p><span class="math display">\[ \sqrt{ (2956 - 2650)^2 + (5 - 6)^2} = 306 \]</span></p>
<p>. . .</p>
<p>… what does this number mean? Not much! But we can use it to <strong>compare</strong> sets of houses and find the <strong>most similar</strong>.</p>
</section>
<section id="distance-1" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3"><span class="header-section-number">5.3.3</span> Distance</h3>
<p>Consider House 1707 and another one:</p>
<div class="cell">
<div class="sourceCode" id="cb206"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">1707</span>, [<span class="st">&quot;Gr Liv Area&quot;</span>, <span class="st">&quot;Bedroom AbvGr&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gr Liv Area      2956
Bedroom AbvGr       5
Name: 1707, dtype: object</code></pre>
</div>
<div class="sourceCode" id="cb208"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">291</span>, [<span class="st">&quot;Gr Liv Area&quot;</span>, <span class="st">&quot;Bedroom AbvGr&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gr Liv Area      1666
Bedroom AbvGr       3
Name: 291, dtype: object</code></pre>
</div>
</div>
<p><span class="math display">\[ \sqrt{ (2956 - 1666)^2 + (5 - 3)^2} = 1290 \]</span> House 1707 is <strong>more similar</strong> to House 290 than to House 291.</p>
</section>
<section id="lecture-activity-part-1" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4"><span class="header-section-number">5.3.4</span> (Lecture Activity Part 1)</h3>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_10278f20" data-update-every="1" tabindex="0" style="bottom:0;left:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
</section>
<section id="scalingstandardizing" class="level2" data-number="5.4">
<h2 data-number="5.4"><span class="header-section-number">5.4</span> Scaling/Standardizing</h2>
<section id="house-160-seems-more-similar" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1"><span class="header-section-number">5.4.1</span> House 160 seems more similar…</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb210"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;Gr Liv Area&quot;</span>, y <span class="op">=</span> <span class="st">&quot;Bedroom AbvGr&quot;</span>)) </span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> <span class="st">&quot;lightgrey&quot;</span>)</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">1707</span>]], color <span class="op">=</span> <span class="st">&quot;red&quot;</span>, size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">160</span>]], color <span class="op">=</span> <span class="st">&quot;blue&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">2336</span>]], color <span class="op">=</span> <span class="st">&quot;green&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic() </span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="even-if-we-zoom-in" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2"><span class="header-section-number">5.4.2</span> … even if we zoom in…</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb212"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;Gr Liv Area&quot;</span>, y <span class="op">=</span> <span class="st">&quot;Bedroom AbvGr&quot;</span>)) </span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> <span class="st">&quot;lightgrey&quot;</span>)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">1707</span>]], color <span class="op">=</span> <span class="st">&quot;red&quot;</span>, size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">160</span>]], color <span class="op">=</span> <span class="st">&quot;blue&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">2336</span>]], color <span class="op">=</span> <span class="st">&quot;green&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic() </span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> scale_x_continuous(limits<span class="op">=</span>(<span class="dv">2500</span>, <span class="dv">3500</span>))</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 2810 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-113-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="but-not-if-we-put-the-axes-on-the-same-scale" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3"><span class="header-section-number">5.4.3</span> … but not if we put the axes on the same <strong>scale</strong>!</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb214"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;Gr Liv Area&quot;</span>, y <span class="op">=</span> <span class="st">&quot;Bedroom AbvGr&quot;</span>)) </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> <span class="st">&quot;lightgrey&quot;</span>)</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">1707</span>]], color <span class="op">=</span> <span class="st">&quot;red&quot;</span>, size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">160</span>]], color <span class="op">=</span> <span class="st">&quot;blue&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">2336</span>]], color <span class="op">=</span> <span class="st">&quot;green&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic() </span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> scale_x_continuous(limits<span class="op">=</span>(<span class="dv">2900</span>, <span class="dv">3000</span>))</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> scale_y_continuous(limits<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 2926 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-114-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="scaling" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4"><span class="header-section-number">5.4.4</span> Scaling</h3>
<ul>
<li><p>We need to make sure our features are on the same <strong>scale</strong> before we can use <strong>distances</strong> to measure <strong>similarity</strong>.</p></li>
<li><p>Recall: <strong>standardizing</strong> = subtract the mean, divide by the standard deviation.</p></li>
<li><p>In this case, the <strong>mean</strong> doesn’t really matter. (why?)</p></li>
</ul>
</section>
<section id="scaling-1" class="level3" data-number="5.4.5">
<h3 data-number="5.4.5"><span class="header-section-number">5.4.5</span> Scaling</h3>
<div class="cell">
<div class="sourceCode" id="cb216"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;size_scaled&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Gr Liv Area&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;Gr Liv Area&#39;</span>].mean())<span class="op">/</span>df[<span class="st">&#39;Gr Liv Area&#39;</span>].std()</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;bdrm_scaled&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Bedroom AbvGr&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;Bedroom AbvGr&#39;</span>].mean())<span class="op">/</span>df[<span class="st">&#39;Bedroom AbvGr&#39;</span>].std()</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb217"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;size_scaled&quot;</span>, y <span class="op">=</span> <span class="st">&quot;bdrm_scaled&quot;</span>)) </span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> <span class="st">&quot;lightgrey&quot;</span>)</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">1707</span>]], color <span class="op">=</span> <span class="st">&quot;red&quot;</span>, size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">160</span>]], color <span class="op">=</span> <span class="st">&quot;blue&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df.loc[[<span class="dv">2336</span>]], color <span class="op">=</span> <span class="st">&quot;green&quot;</span>, size <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic() </span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-116-7.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="lecture-activity-part-2" class="level3" data-number="5.4.6">
<h3 data-number="5.4.6"><span class="header-section-number">5.4.6</span> (Lecture Activity Part 2)</h3>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_e43e6e72" data-update-every="1" tabindex="0" style="bottom:0;left:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
</section>
<section id="scikit-learn" class="level2" data-number="5.5">
<h2 data-number="5.5"><span class="header-section-number">5.5</span> Scikit-learn</h2>
<section id="scikit-learn-1" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1"><span class="header-section-number">5.5.1</span> Scikit-learn</h3>
<ul>
<li><p><code>scikit-learn</code> is a library for <strong>machine learning</strong> and <strong>modeling</strong></p></li>
<li><p>We will use it a lot in this class!</p></li>
<li><p>For now, we will use it as a shortcut for <em>scaling</em> and for <em>computing distances</em></p></li>
<li><p>The philosophy of <code>sklearn</code> is:</p>
<ul>
<li><strong>specify</strong> your analysis</li>
<li><strong>fit</strong> on the data to prepare the analysis</li>
<li><strong>transform</strong> the data</li>
</ul></li>
</ul>
</section>
<section id="specify" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2"><span class="header-section-number">5.5.2</span> Specify</h3>
<p>No calculations have happened yet!</p>
<div class="cell">
<div class="sourceCode" id="cb219"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>scaler</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>StandardScaler()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label  sk-toggleable__label-arrow ">&nbsp;&nbsp;StandardScaler<a class="sk-estimator-doc-link " rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a><span class="sk-estimator-doc-link ">i<span>Not fitted</span></span></label><div class="sk-toggleable__content "><pre>StandardScaler()</pre></div> </div></div></div></div>
</div>
</div>
</section>
<section id="fit" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3"><span class="header-section-number">5.5.3</span> Fit</h3>
<p>The <code>scaler</code> object “learns” the means and standard deviations.</p>
<p>We still have not altered the data at all!</p>
<div class="cell">
<div class="sourceCode" id="cb220"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>df_orig <span class="op">=</span> df[[<span class="st">&#39;Gr Liv Area&#39;</span>, <span class="st">&#39;Bedroom AbvGr&#39;</span>]]</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>scaler.fit(df_orig)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>StandardScaler()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb221"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>scaler.mean_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([1499.69044369,    2.85426621])</code></pre>
</div>
<div class="sourceCode" id="cb223"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>scaler.scale_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([505.4226158 ,   0.82758988])</code></pre>
</div>
</div>
</section>
<section id="transform" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4"><span class="header-section-number">5.5.4</span> Transform</h3>
<div class="cell">
<div class="sourceCode" id="cb225"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>df_scaled <span class="op">=</span> scaler.transform(df_orig)</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>df_scaled</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[ 0.30926506,  0.17609421],
       [-1.19442705, -1.03223376],
       [-0.33771825,  0.17609421],
       ...,
       [-1.04801492,  0.17609421],
       [-0.21900572, -1.03223376],
       [ 0.9898836 ,  0.17609421]])</code></pre>
</div>
</div>
</section>
<section id="sklearn-numpy-and-pandas" class="level3" data-number="5.5.5">
<h3 data-number="5.5.5"><span class="header-section-number">5.5.5</span> sklearn, numpy, and pandas</h3>
<ul>
<li><p>By default, <code>sklearn</code> functions return <code>numpy</code> objects.</p></li>
<li><p>This is sometimes annoying; e.g. if we want to plot things after scaling.</p></li>
<li><p>Solution: remake it, with the original column names.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb227"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(df_scaled, columns <span class="op">=</span> df_orig.columns)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Gr Liv Area  Bedroom AbvGr
0        0.309265       0.176094
1       -1.194427      -1.032234
2       -0.337718       0.176094
3        1.207523       0.176094
4        0.255844       0.176094
...           ...            ...
2925    -0.982723       0.176094
2926    -1.182556      -1.032234
2927    -1.048015       0.176094
2928    -0.219006      -1.032234
2929     0.989884       0.176094

[2930 rows x 2 columns]</code></pre>
</div>
</div>
</section>
<section id="distances-with-sklearn" class="level3" data-number="5.5.6">
<h3 data-number="5.5.6"><span class="header-section-number">5.5.6</span> Distances with sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb229"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>pairwise_distances(df_scaled[[<span class="dv">1707</span>]], df_scaled)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[3.52929876, 5.45459713, 4.0252646 , ..., 4.61305666, 4.76999349,
        3.06886734]])</code></pre>
</div>
</div>
</section>
<section id="finding-the-most-similar" class="level3" data-number="5.5.7">
<h3 data-number="5.5.7"><span class="header-section-number">5.5.7</span> Finding the most similar</h3>
<div class="cell">
<div class="sourceCode" id="cb231"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> pairwise_distances(df_scaled[[<span class="dv">1707</span>]], df_scaled)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>dists.argsort()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[1707,  160,  909, ...,  158, 2723, 2279]])</code></pre>
</div>
</div>
</section>
<section id="finding-the-most-similar-1" class="level3" data-number="5.5.8">
<h3 data-number="5.5.8"><span class="header-section-number">5.5.8</span> Finding the most similar</h3>
<div class="cell">
<div class="sourceCode" id="cb233"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>best <span class="op">=</span> dists.argsort().flatten()[<span class="dv">1</span>:<span class="dv">10</span>]</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>df_orig.iloc[best]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Gr Liv Area  Bedroom AbvGr
160          2978              5
909          3082              5
1288         2792              5
2350         2784              5
253          3222              5
2592         2640              5
585          2640              5
2027         2526              5
2330         3390              5</code></pre>
</div>
</div>
</section>
<section id="lecture-activity-part-3" class="level3" data-number="5.5.9">
<h3 data-number="5.5.9"><span class="header-section-number">5.5.9</span> (Lecture Activity Part 3)</h3>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_3836339e" data-update-every="1" tabindex="0" style="bottom:0;left:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
</section>
<section id="alternatives" class="level2" data-number="5.6">
<h2 data-number="5.6"><span class="header-section-number">5.6</span> Alternatives</h2>
<section id="other-scaling" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1"><span class="header-section-number">5.6.1</span> Other scaling</h3>
<ul>
<li><p>Standardization <span class="math display">\[x_i \leftarrow \frac{x_i - \bar{X}}{\text{sd}(X)}\]</span></p></li>
<li><p>Min-Max Scaling <span class="math display">\[x_i \leftarrow \frac{x_i - \text{min}(X)}{\text{max}(X) - \text{min}(X)}\]</span></p></li>
</ul>
</section>
<section id="other-distances" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2"><span class="header-section-number">5.6.2</span> Other distances</h3>
<ul>
<li><p>Euclidean (<span class="math inline">\(\ell_2\)</span>)</p>
<p><span class="math display">\[\sqrt{\sum_{j=1}^m (x_j - x&#39;_j)^2}\]</span></p></li>
<li><p>Manhattan (<span class="math inline">\(\ell_1\)</span>)</p>
<p><span class="math display">\[\sum_{j=1}^m |x_j - x&#39;_j|\]</span></p></li>
</ul>
</section>
<section id="lecture-activity-part-4" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3"><span class="header-section-number">5.6.3</span> (Lecture Activity Part 4)</h3>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_4897e656" data-update-every="1" tabindex="0" style="bottom:0;left:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
</section>
<section id="takeaways-5" class="level2" data-number="5.7">
<h2 data-number="5.7"><span class="header-section-number">5.7</span> Takeaways</h2>
<section id="takeaways-6" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1"><span class="header-section-number">5.7.1</span> Takeaways</h3>
<ul>
<li><p>We measure similarity between <strong>observations</strong> by calculating <strong>distances</strong>.</p></li>
<li><p>It is important that all our <strong>features</strong> be on the same <strong>scale</strong> for distances to be meaningful.</p></li>
<li><p>We can use <code>scikit-learn</code> functions to <strong>fit</strong> and <strong>transform</strong> data, and to compute pairwise distances.</p></li>
<li><p>There are many options of ways to <em>scale</em> data; most common is <strong>standardizing</strong></p></li>
<li><p>There are many options of ways to <em>measure distances</em>; most common is <strong>Euclidean distance</strong>.</p></li>
</ul>
</section>
</section>
<section id="dummy-variables-and-column-tranformers" class="level1 lectitle" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Dummy Variables and Column Tranformers</h1>
<p><a href="slides-06-preprocessing.html">Slides</a></p>
</section>
<section id="the-story-this-week" class="level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> The story this week</h2>
<section id="distances-1" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1"><span class="header-section-number">6.1.1</span> Distances</h3>
<ul>
<li><p>We measure similarity between <strong>observations</strong> by calculating <strong>distances</strong>.</p></li>
<li><p><strong>Euclidean distance</strong>: sum of squared differences, then square root</p></li>
<li><p><strong>Manhattan distance</strong>: sum of absolute differences</p></li>
<li><p>In <strong>scikit-learn</strong>, use the <code>pairwise_distances</code> function to get back a <em>2D numpy array</em> of distances.</p></li>
</ul>
</section>
<section id="scaling-2" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2"><span class="header-section-number">6.1.2</span> Scaling</h3>
<ul>
<li><p>It is important that all our <strong>features</strong> be on the same <strong>scale</strong> for distances to be meaningful.</p></li>
<li><p><strong>Standardize:</strong> Subtract the <em>mean</em> (of the column) and divide by the <em>standard deviation</em> (of the column).</p></li>
<li><p><strong>MinMax:</strong> Subtract the <em>minimum</em> value, divide by the <em>range</em>.</p></li>
<li><p>In <code>scikit-learn</code>, use the <code>StandardScaler()</code> or <code>MinMaxScaler()</code> functions.</p></li>
<li><p>Follow the <strong>specify</strong> - <strong>fit</strong> - <strong>transform</strong> code structure.</p></li>
</ul>
</section>
<section id="recall-ames-housing-data" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3"><span class="header-section-number">6.1.3</span> Recall: AMES Housing data</h3>
<div class="cell">
<div class="sourceCode" id="cb235"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_table(<span class="st">&quot;https://datasci112.stanford.edu/data/housing.tsv&quot;</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">&quot;Gr Liv Area&quot;</span>, <span class="st">&quot;Bedroom AbvGr&quot;</span>, <span class="st">&quot;Full Bath&quot;</span>, <span class="st">&quot;Half Bath&quot;</span>, <span class="st">&quot;Bldg Type&quot;</span>, <span class="st">&quot;Neighborhood&quot;</span>]</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>df[features].head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Gr Liv Area  Bedroom AbvGr  Full Bath  Half Bath Bldg Type Neighborhood
0         1656              3          1          0      1Fam        NAmes
1          896              2          1          0      1Fam        NAmes
2         1329              3          1          1      1Fam        NAmes
3         2110              3          2          1      1Fam        NAmes
4         1629              3          2          1      1Fam      Gilbert</code></pre>
</div>
</div>
</section>
</section>
<section id="distances-and-categorical-variables" class="level2" data-number="6.2">
<h2 data-number="6.2"><span class="header-section-number">6.2</span> Distances and Categorical Variables</h2>
<section id="what-about-categorical-variables" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1"><span class="header-section-number">6.2.1</span> What about categorical variables?</h3>
<p>Suppose we want to include the variable <code>Bldg Type</code> in our distance calculation…</p>
<div class="cell">
<div class="sourceCode" id="cb237"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;Bldg Type&quot;</span>].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bldg Type
1Fam      2425
TwnhsE     233
Duplex     109
Twnhs      101
2fmCon      62
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>What is “single family minus townhouse squared”?</p>
</section>
<section id="converting-to-binary" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2"><span class="header-section-number">6.2.2</span> Converting to binary</h3>
<p>Let’s instead think about “Single family, or not”</p>
<div class="cell">
<div class="sourceCode" id="cb239"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;is_single_fam&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;Bldg Type&quot;</span>] <span class="op">==</span> <span class="st">&quot;1Fam&quot;</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;is_single_fam&quot;</span>].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>is_single_fam
True     2425
False     505
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="converting-to-binary-1" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3"><span class="header-section-number">6.2.3</span> Converting to binary</h3>
<p>Recall that <code>True/False</code> is the same as <code>1/0</code> for computers:</p>
<div class="cell">
<div class="sourceCode" id="cb241"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;is_single_fam&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;is_single_fam&quot;</span>].astype(<span class="st">&quot;int&quot;</span>)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&quot;is_single_fam&quot;</span>].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>is_single_fam
1    2425
0     505
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>We call this a <strong>dummy variable</strong> or a <strong>one-hot-encoding</strong>.</p>
</section>
<section id="now-we-can-do-math" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4"><span class="header-section-number">6.2.4</span> Now we can do math!</h3>
<div class="cell">
<div class="sourceCode" id="cb243"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>df_orig <span class="op">=</span> df[[<span class="st">&#39;Gr Liv Area&#39;</span>, <span class="st">&#39;Bedroom AbvGr&#39;</span>, <span class="st">&#39;is_single_fam&#39;</span>]]</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>scaler.fit(df_orig)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>StandardScaler()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb244"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>df_scaled <span class="op">=</span> scaler.transform(df_orig)</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> pairwise_distances(df_scaled[[<span class="dv">1707</span>]], df_scaled)</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>best <span class="op">=</span> dists.argsort().flatten()[<span class="dv">1</span>:<span class="dv">10</span>]</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>df_orig.iloc[best]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Gr Liv Area  Bedroom AbvGr  is_single_fam
160          2978              5              1
909          3082              5              1
1288         2792              5              1
2350         2784              5              1
253          3222              5              1
585          2640              5              1
2027         2526              5              1
2330         3390              5              1
2501         2520              5              1</code></pre>
</div>
</div>
</section>
<section id="quick-look-back" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5"><span class="header-section-number">6.2.5</span> Quick look back</h3>
<section id="where-have-you-seen-some-one-hot-encoded-variables-already" class="level4" data-number="6.2.5.1">
<h4 data-number="6.2.5.1"><span class="header-section-number">6.2.5.1</span> Where have you seen some one-hot-encoded variables already?</h4>
</section>
</section>
<section id="lets-reset-the-dataset-now" class="level3" data-number="6.2.6">
<h3 data-number="6.2.6"><span class="header-section-number">6.2.6</span> Let’s reset the dataset now…</h3>
<div class="cell">
<div class="sourceCode" id="cb246"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_table(<span class="st">&quot;https://datasci112.stanford.edu/data/housing.tsv&quot;</span>)</span></code></pre></div>
</div>
</section>
</section>
<section id="dummifying-variables" class="level2" data-number="6.3">
<h2 data-number="6.3"><span class="header-section-number">6.3</span> Dummifying Variables</h2>
<section id="dummifying-variables-1" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1"><span class="header-section-number">6.3.1</span> Dummifying Variables</h3>
<ul>
<li><p>What if we don’t just want to study <code>is_single_fam</code>, but rather, <em>all</em> categories of the <code>Bldg Type</code> variable?</p></li>
<li><p>In principle, we just make <strong>dummy variables</strong> for <strong>each category</strong>: <code>is_single_fam</code>, <code>is_twnhse</code>, etc.</p></li>
<li><p>Each <strong>category</strong> becomes one <strong>column</strong>, with 0’s and 1’s to show if the <em>observation in that row</em> matches that <em>category</em>.</p></li>
<li><p>This is called <strong>dummifying</strong> or <strong>one-hot-encoding</strong> a <strong>categorical variable</strong></p></li>
<li><p>Luckily, we have shortcuts in both <code>pandas</code> <em>and</em> <code>sklearn</code>…</p></li>
</ul>
</section>
<section id="dummifying-in-pandas" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2"><span class="header-section-number">6.3.2</span> Dummifying in Pandas</h3>
<div class="cell">
<div class="sourceCode" id="cb247"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>pd.get_dummies(df[[<span class="st">&quot;Bldg Type&quot;</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Bldg Type_1Fam  Bldg Type_2fmCon  ...  Bldg Type_Twnhs  Bldg Type_TwnhsE
0               True             False  ...            False             False
1               True             False  ...            False             False
2               True             False  ...            False             False
3               True             False  ...            False             False
4               True             False  ...            False             False
...              ...               ...  ...              ...               ...
2925            True             False  ...            False             False
2926            True             False  ...            False             False
2927            True             False  ...            False             False
2928            True             False  ...            False             False
2929            True             False  ...            False             False

[2930 rows x 5 columns]</code></pre>
</div>
</div>
</section>
<section id="dummifying-in-pandas-1" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3"><span class="header-section-number">6.3.3</span> Dummifying in Pandas</h3>
<p>Some things to notice here…</p>
<ol type="1">
<li><p>What is the <strong>naming convention</strong> for the new columns?</p></li>
<li><p>Does this change the original dataframe <code>df</code>? If not, what would you need to do to add this information back in?</p></li>
<li><p>What happens if you put the whole dataframe into the <code>get_dummies</code> function? What problems might arise from this?</p></li>
</ol>
</section>
<section id="dummifying-in-sklearn" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4"><span class="header-section-number">6.3.4</span> Dummifying in sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb249"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder()</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>encoder.fit(df[[<span class="st">&quot;Bldg Type&quot;</span>]])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>OneHotEncoder()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder()</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb250"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>df_bldg <span class="op">=</span> encoder.transform(df[[<span class="st">&quot;Bldg Type&quot;</span>]])</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>df_bldg</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;2930x5 sparse matrix of type &#39;&lt;class &#39;numpy.float64&#39;&gt;&#39;
    with 2930 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
<section id="dummifying-in-sklearn-1" class="level3" data-number="6.3.5">
<h3 data-number="6.3.5"><span class="header-section-number">6.3.5</span> Dummifying in sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb252"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>df_bldg.todense()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>matrix([[1., 0., 0., 0., 0.],
        [1., 0., 0., 0., 0.],
        [1., 0., 0., 0., 0.],
        ...,
        [1., 0., 0., 0., 0.],
        [1., 0., 0., 0., 0.],
        [1., 0., 0., 0., 0.]])</code></pre>
</div>
</div>
</section>
<section id="dummifying-in-sklearn-2" class="level3" data-number="6.3.6">
<h3 data-number="6.3.6"><span class="header-section-number">6.3.6</span> Dummifying in sklearn</h3>
<p>Things to notice:</p>
<ol type="1">
<li><p>What <strong>object type</strong> was the result?</p></li>
<li><p>Does this change the original dataframe <code>df</code>? If not, what would you need to do to add this information back in?</p></li>
<li><p>What happens if you fit the whole dataframe with the OneHotEncoder? What problems might arise from this?</p></li>
<li><p>What pros and cons do you see for the <code>pandas</code> approach vs the <code>sklearn</code> approach?</p></li>
</ol>
</section>
</section>
<section id="column-transformers" class="level2" data-number="6.4">
<h2 data-number="6.4"><span class="header-section-number">6.4</span> Column Transformers</h2>
<section id="preprocessing" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1"><span class="header-section-number">6.4.1</span> Preprocessing</h3>
<ul>
<li><p>We have now seen two <strong>preprocessing</strong> steps that might need to happen to do an analysis of distances:</p>
<ul>
<li><strong>Scaling</strong> the quantitative variables</li>
<li><strong>Dummifying</strong> the categorical variables</li>
</ul></li>
<li><p><strong>Preprocessing</strong> steps are things you do <em>only to make the following analysis/visualization better</em>.</p></li>
<li><p>This is not the same as <strong>data cleaning</strong>, which are changes you make to <em>fix</em> the data.</p></li>
<li><p>This is not the same as <strong>data wrangling</strong>, which are changes you make to <em>restructure</em> the data; i.e., adding or deleting rows or columns to reflect what you are trying to study.</p></li>
</ul>
</section>
<section id="quick-quiz" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2"><span class="header-section-number">6.4.2</span> Quick quiz</h3>
<p>Identify the following as <em>cleaning</em>, <em>wrangling</em>, or <em>preprocessing</em>:</p>
<ol type="1">
<li><p>Removing the <code>$</code> symbol from a column and converting it to numeric.</p></li>
<li><p>Narrowing your data down to only first class Titanic passengers, because you are not studying the others.</p></li>
<li><p>Converting a <code>Zip Code</code> variable from numeric to categorical using <code>.astype()</code>.</p></li>
<li><p>Creating a new column called <code>n_investment</code> that counts the number of people who invested in a project.</p></li>
<li><p>Log-transforming a column because it is very skewed.</p></li>
</ol>
</section>
<section id="preprocessing-in-sklearn" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3"><span class="header-section-number">6.4.3</span> Preprocessing in <code>sklearn</code></h3>
<ul>
<li><p>Unlike <strong>cleaning</strong> and <strong>wrangling</strong>, the <strong>preprocessing</strong> steps are “temporary” changes to the dataframe.</p></li>
<li><p>It would be nice if we could trigger these changes as part of our analysis, instead of doing them “by hand”.</p></li>
<li><p>This is why the <strong>specify</strong> - <strong>fit</strong> - <strong>transform</strong> process is useful!</p></li>
<li><p>We will first specify <strong>all</strong> our preprocessing steps.</p></li>
<li><p>Then we will <strong>fit</strong> the whole preprocess</p></li>
<li><p>Then we will save the <strong>transform</strong> step for only when we need it.</p></li>
</ul>
</section>
<section id="column-transformers-1" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4"><span class="header-section-number">6.4.4</span> Column Transformers</h3>
<div class="cell">
<div class="sourceCode" id="cb254"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>preproc <span class="op">=</span> make_column_transformer(</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">&quot;Bldg Type&quot;</span>, <span class="st">&quot;Neighborhood&quot;</span>]),</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">&quot;passthrough&quot;</span>)</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>preproc.fit(df[features])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;onehotencoder&#x27;, OneHotEncoder(),
                                 [&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;onehotencoder&#x27;, OneHotEncoder(),
                                 [&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">onehotencoder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">remainder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Gr Liv Area&#x27;, &#x27;Bedroom AbvGr&#x27;, &#x27;Full Bath&#x27;, &#x27;Half Bath&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">passthrough</label><div class="sk-toggleable__content fitted"><pre>passthrough</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb255"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>preproc.transform(df[features])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;2930x37 sparse matrix of type &#39;&lt;class &#39;numpy.float64&#39;&gt;&#39;
    with 15717 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
<section id="column-transformers-2" class="level3" data-number="6.4.5">
<h3 data-number="6.4.5"><span class="header-section-number">6.4.5</span> Column Transformers</h3>
<p>Things to notice…</p>
<ol type="1">
<li><p>What submodule did we import <code>make_column_transformer</code> from?</p></li>
<li><p>What are the <strong>two</strong> arguments to the <code>make_column_transformer</code> function? What <strong>object structures</strong> are they?</p></li>
<li><p>What happens if you <strong>fit</strong> and <strong>transform</strong> on the whole dataset, not just <code>df[features]</code>? Why might this be useful?</p></li>
</ol>
</section>
<section id="column-transformers-3" class="level3" data-number="6.4.6">
<h3 data-number="6.4.6"><span class="header-section-number">6.4.6</span> Column Transformers</h3>
<p>Try the following:</p>
<ol type="1">
<li><p>What happens if you change <code>remainder = "passthrough"</code> to <code>remainder = "drop"</code>?</p></li>
<li><p>What happens if you add the argument <code>sparse_output=False</code> to the <code>OneHotEncoder()</code> function?</p></li>
<li><p>What happens if you add this line before the <em>transform</em> step: <em>(keep the <code>sparse_output=False</code> when you try this)</em></p></li>
</ol>
<pre><code>preproc.set_output(transform = &quot;pandas&quot;)</code></pre>
<ol start="4" type="1">
<li>Look at the <code>preproc</code> object. What does it show you?</li>
</ol>
</section>
<section id="multiple-preprocessing-steps" class="level3" data-number="6.4.7">
<h3 data-number="6.4.7"><span class="header-section-number">6.4.7</span> Multiple preprocessing steps</h3>
<p>Why are <strong>column transformers</strong> so useful?</p>
<p>Well, now we can do <strong>multiple preprocessing steps</strong> at once!</p>
<div class="cell">
<div class="sourceCode" id="cb258"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>preproc <span class="op">=</span> make_column_transformer(</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>        (StandardScaler(), [<span class="st">&quot;Gr Liv Area&quot;</span>]),</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>        (OneHotEncoder(sparse_output<span class="op">=</span><span class="va">False</span>), [<span class="st">&quot;Bldg Type&quot;</span>,</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Neighborhood&quot;</span>]),</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">&quot;passthrough&quot;</span>)</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>preproc.fit(df[features])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;Gr Liv Area&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 [&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;Gr Liv Area&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 [&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Gr Liv Area&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">onehotencoder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">remainder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Bedroom AbvGr&#x27;, &#x27;Full Bath&#x27;, &#x27;Half Bath&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">passthrough</label><div class="sk-toggleable__content fitted"><pre>passthrough</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb259"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>preproc.set_output(transform <span class="op">=</span> <span class="st">&quot;pandas&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-7 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-7 {
  color: var(--sklearn-color-text);
}

#sk-container-id-7 pre {
  padding: 0;
}

#sk-container-id-7 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-7 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-7 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-7 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-7 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-7 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-7 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-7 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-7 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-7 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-7 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-7 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-7 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-7 div.sk-label label.sk-toggleable__label,
#sk-container-id-7 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-7 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-7 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-7 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-7 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-7 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-7 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-7 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-7 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-7 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;Gr Liv Area&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 [&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;Gr Liv Area&#x27;]),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 [&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Gr Liv Area&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">onehotencoder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Bldg Type&#x27;, &#x27;Neighborhood&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">remainder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Bedroom AbvGr&#x27;, &#x27;Full Bath&#x27;, &#x27;Half Bath&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">passthrough</label><div class="sk-toggleable__content fitted"><pre>passthrough</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb260"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>df_transformed <span class="op">=</span> preproc.transform(df[features])</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>df_transformed</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      standardscaler__Gr Liv Area  ...  remainder__Half Bath
0                        0.309265  ...                     0
1                       -1.194427  ...                     0
2                       -0.337718  ...                     1
3                        1.207523  ...                     1
4                        0.255844  ...                     1
...                           ...  ...                   ...
2925                    -0.982723  ...                     0
2926                    -1.182556  ...                     0
2927                    -1.048015  ...                     0
2928                    -0.219006  ...                     0
2929                     0.989884  ...                     1

[2930 rows x 37 columns]</code></pre>
</div>
</div>
</section>
<section id="finding-all-variables" class="level3" data-number="6.4.8">
<h3 data-number="6.4.8"><span class="header-section-number">6.4.8</span> Finding all variables</h3>
<p>What if we just want to say “Please dummify <strong>all</strong> categorical variables?”</p>
<p>Use a <code>selector</code> instead of exact column names.</p>
<div class="cell">
<div class="sourceCode" id="cb262"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_selector</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>preproc <span class="op">=</span> make_column_transformer(</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(),  make_column_selector(dtype_include<span class="op">=</span>np.number)),</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(sparse_output<span class="op">=</span><span class="va">False</span>), make_column_selector(dtype_include<span class="op">=</span><span class="bu">object</span>)),</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">&quot;passthrough&quot;</span>)</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>preproc.fit(df[features])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-8 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-8 {
  color: var(--sklearn-color-text);
}

#sk-container-id-8 pre {
  padding: 0;
}

#sk-container-id-8 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-8 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-8 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-8 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-8 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-8 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-8 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-8 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-8 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-8 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-8 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-8 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-8 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-8 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-8 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-8 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-8 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-8 div.sk-label label.sk-toggleable__label,
#sk-container-id-8 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-8 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-8 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-8 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-8 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-8 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-8 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-8 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-8 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-8 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-8 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-8" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e42f230&gt;),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e565d90&gt;)])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e42f230&gt;),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e565d90&gt;)])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e42f230&gt;</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">onehotencoder</label><div class="sk-toggleable__content fitted"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e565d90&gt;</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">remainder</label><div class="sk-toggleable__content fitted"><pre>[]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">passthrough</label><div class="sk-toggleable__content fitted"><pre>passthrough</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb263"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>preproc.set_output(transform <span class="op">=</span> <span class="st">&quot;pandas&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-9 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-9 {
  color: var(--sklearn-color-text);
}

#sk-container-id-9 pre {
  padding: 0;
}

#sk-container-id-9 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-9 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-9 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-9 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-9 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-9 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-9 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-9 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-9 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-9 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-9 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-9 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-9 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-9 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-9 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-9 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-9 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-9 div.sk-label label.sk-toggleable__label,
#sk-container-id-9 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-9 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-9 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-9 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-9 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-9 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-9 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-9 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-9 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-9 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-9 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-9" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e42f230&gt;),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e565d90&gt;)])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e42f230&gt;),
                                (&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(sparse_output=False),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e565d90&gt;)])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox" ><label for="sk-estimator-id-32" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e42f230&gt;</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox" ><label for="sk-estimator-id-33" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox" ><label for="sk-estimator-id-34" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">onehotencoder</label><div class="sk-toggleable__content fitted"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x30e565d90&gt;</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox" ><label for="sk-estimator-id-35" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox" ><label for="sk-estimator-id-36" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">remainder</label><div class="sk-toggleable__content fitted"><pre>[]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox" ><label for="sk-estimator-id-37" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">passthrough</label><div class="sk-toggleable__content fitted"><pre>passthrough</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb264"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>df_transformed <span class="op">=</span> preproc.transform(df[features])</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>df_transformed</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      standardscaler__Gr Liv Area  ...  onehotencoder__Neighborhood_Veenker
0                        0.309265  ...                                  0.0
1                       -1.194427  ...                                  0.0
2                       -0.337718  ...                                  0.0
3                        1.207523  ...                                  0.0
4                        0.255844  ...                                  0.0
...                           ...  ...                                  ...
2925                    -0.982723  ...                                  0.0
2926                    -1.182556  ...                                  0.0
2927                    -1.048015  ...                                  0.0
2928                    -0.219006  ...                                  0.0
2929                     0.989884  ...                                  0.0

[2930 rows x 37 columns]</code></pre>
</div>
</div>
</section>
<section id="think-about-it" class="level3" data-number="6.4.9">
<h3 data-number="6.4.9"><span class="header-section-number">6.4.9</span> Think about it</h3>
<ul>
<li><p>What are the <em>advantages</em> of using a selector?</p></li>
<li><p>What are the possible <em>disadvantages</em> of using a selector?</p></li>
<li><p>Does the <em>order</em> matter when using selectors? Try switching the steps and see what happens!</p></li>
</ul>
</section>
</section>
<section id="takeaways-7" class="level2" data-number="6.5">
<h2 data-number="6.5"><span class="header-section-number">6.5</span> Takeaways</h2>
<section id="takeaways-8" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1"><span class="header-section-number">6.5.1</span> Takeaways</h3>
<ul>
<li><p>We <strong>dummify</strong> or <strong>one-hot-encode</strong> categorical variables to make them numbers.</p></li>
<li><p>We can do this with <code>pd.get_dummies()</code> or with <code>OneHotEncoder()</code></p></li>
<li><p><strong>Column Transformers</strong> let us apply multiple preprocessing steps all together.</p>
<ul>
<li>Think about <em>which variables</em> you want to apply the steps to</li>
<li>Think about <em>options</em> for the steps, like sparseness</li>
<li>Think about <code>passthrough</code> in your transformer</li>
</ul></li>
</ul>
</section>
</section>
<section id="text-data-and-tf-idf" class="level1 lectitle" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Text Data and TF-IDF</h1>
<p><a href="slides-07-text_data.html">Slides</a></p>
</section>
<section id="the-story-so-far-4" class="level2" data-number="7.1">
<h2 data-number="7.1"><span class="header-section-number">7.1</span> The story so far</h2>
<section id="distances-2" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1"><span class="header-section-number">7.1.1</span> Distances</h3>
<ul>
<li><p>We measure similarity between <strong>observations</strong> by calculating <strong>distances</strong>.</p></li>
<li><p><strong>Euclidean distance</strong>: sum of squared differences, then square root</p></li>
<li><p><strong>Manhattan distance</strong>: sum of absolute differences</p></li>
<li><p>In <strong>scikit-learn</strong>, use the <code>pairwise_distances</code> function to get back a <em>2D numpy array</em> of distances.</p></li>
</ul>
</section>
<section id="scaling-3" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2"><span class="header-section-number">7.1.2</span> Scaling</h3>
<ul>
<li><p>It is important that all our <strong>features</strong> be on the same <strong>scale</strong> for distances to be meaningful.</p></li>
<li><p><strong>Standardize:</strong> Subtract the <em>mean</em> (of the column) and divide by the <em>standard deviation</em> (of the column).</p></li>
<li><p><strong>MinMax:</strong> Subtract the <em>minimum</em> value, divide by the <em>range</em>.</p></li>
<li><p>In <code>scikit-learn</code>, use the <code>StandardScaler()</code> or <code>MinMaxScaler()</code> functions.</p></li>
<li><p>Follow the <strong>specify</strong> - <strong>fit</strong> - <strong>transform</strong> code structure.</p></li>
</ul>
</section>
</section>
<section id="bag-of-words" class="level2" data-number="7.2">
<h2 data-number="7.2"><span class="header-section-number">7.2</span> Bag of Words</h2>
<section id="text-data" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1"><span class="header-section-number">7.2.1</span> Text data</h3>
<p>A textual data set consists of multiple texts. Each text is called a <strong>document</strong>. The collection of texts is called a <strong>corpus</strong>.</p>
<p>Example Corpus:</p>
<ol start="0" type="1">
<li><p><code>"I am Sam\n\nI am Sam\nSam I..."</code></p></li>
<li><p><code>"The sun did not shine.\nIt was..."</code></p></li>
<li><p><code>"Fox\nSocks\nBox\nKnox\n\nKnox..."</code></p></li>
<li><p><code>"Every Who\nDown in Whoville\n..."</code></p></li>
<li><p><code>"UP PUP Pup is up.\nCUP PUP..."</code></p></li>
<li><p><code>"On the fifteenth of May, in the..."</code></p></li>
<li><p><code>"Congratulations!\nToday is your..."</code></p></li>
<li><p><code>"One fish, two fish, red fish..."</code></p></li>
</ol>
</section>
<section id="reading-text-data" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2"><span class="header-section-number">7.2.2</span> Reading Text Data</h3>
<p>Reading in Textual Data</p>
<p>Documents are usually stored in different files.</p>
<div class="cell">
<div class="sourceCode" id="cb266"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>seuss_dir <span class="op">=</span> <span class="st">&quot;http://dlsun.github.io/pods/data/drseuss/&quot;</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>seuss_files <span class="op">=</span> [</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;green_eggs_and_ham.txt&quot;</span>, <span class="st">&quot;cat_in_the_hat.txt&quot;</span>,</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fox_in_socks.txt&quot;</span>, <span class="st">&quot;how_the_grinch_stole_christmas.txt&quot;</span>,</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hop_on_pop.txt&quot;</span>, <span class="st">&quot;horton_hears_a_who.txt&quot;</span>,</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;oh_the_places_youll_go.txt&quot;</span>, <span class="st">&quot;one_fish_two_fish.txt&quot;</span>]</span></code></pre></div>
</div>
<p>We have to read them in one by one.</p>
<div class="cell">
<div class="sourceCode" id="cb267"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> {}</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> seuss_files:</span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(seuss_dir <span class="op">+</span> filename, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>    docs[filename] <span class="op">=</span> response.text</span></code></pre></div>
</div>
</section>
<section id="reading-text-data-1" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3"><span class="header-section-number">7.2.3</span> Reading Text Data</h3>
<div class="cell">
<div class="sourceCode" id="cb268"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>docs.keys()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys([&#39;green_eggs_and_ham.txt&#39;, &#39;cat_in_the_hat.txt&#39;, &#39;fox_in_socks.txt&#39;, &#39;how_the_grinch_stole_christmas.txt&#39;, &#39;hop_on_pop.txt&#39;, &#39;horton_hears_a_who.txt&#39;, &#39;oh_the_places_youll_go.txt&#39;, &#39;one_fish_two_fish.txt&#39;])</code></pre>
</div>
</div>
</section>
<section id="bag-of-words-representation" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4"><span class="header-section-number">7.2.4</span> Bag-of-Words Representation</h3>
<p>In the <strong>bag-of-words</strong> representation in this data, each column represents a word, and the values in the column are the word counts for that document.</p>
<p>First, we need to count the words in each document.</p>
<div class="cell">
<div class="sourceCode" id="cb270"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>Counter(docs[<span class="st">&quot;hop_on_pop.txt&quot;</span>].split())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Counter({&#39;is&#39;: 10, &#39;on&#39;: 10, &#39;We&#39;: 10, &#39;a&#39;: 9, &#39;He&#39;: 6, &#39;PAT&#39;: 6, &#39;Brown&#39;: 6, &#39;in&#39;: 5, &#39;all&#39;: 5, &#39;like&#39;: 5, &#39;Pup&#39;: 4, &#39;ALL&#39;: 4, &#39;RED&#39;: 4, &#39;and&#39;: 4, &#39;to&#39;: 4, &#39;Mr.&#39;: 4, &#39;PUP&#39;: 3, &#39;the&#39;: 3, &#39;can&#39;: 3, &#39;Pat&#39;: 3, &#39;sat&#39;: 3, &#39;What&#39;: 3, &#39;THING&#39;: 3, &#39;WALK&#39;: 3, &#39;of&#39;: 3, &#39;down.&#39;: 3, &#39;went&#39;: 3, &#39;up.&#39;: 2, &#39;CUP&#39;: 2, &#39;MOUSE&#39;: 2, &#39;HOUSE&#39;: 2, &#39;are&#39;: 2, &#39;BALL&#39;: 2, &#39;play&#39;: 2, &#39;wall.&#39;: 2, &#39;day.&#39;: 2, &#39;after&#39;: 2, &#39;SEE&#39;: 2, &#39;BEE&#39;: 2, &#39;see&#39;: 2, &#39;THREE&#39;: 2, &#39;that&#39;: 2, &#39;They&#39;: 2, &#39;call&#39;: 2, &#39;me&#39;: 2, &#39;BED&#39;: 2, &#39;I&#39;: 2, &#39;him&#39;: 2, &#39;NO&#39;: 2, &#39;Dad&#39;: 2, &#39;sad.&#39;: 2, &#39;That&#39;: 2, &#39;You&#39;: 2, &#39;hop&#39;: 2, &#39;Pop.&#39;: 2, &#39;not&#39;: 2, &#39;BROWN&#39;: 2, &#39;IS&#39;: 2, &#39;out&#39;: 2, &#39;came&#39;: 2, &#39;with&#39;: 2, &#39;Black.&#39;: 2, &#39;SNACK&#39;: 2, &#39;Eat&#39;: 2, &#39;tent.&#39;: 2, &#39;HILL&#39;: 2, &#39;WILL&#39;: 2, &#39;Will&#39;: 2, &#39;up&#39;: 2, &#39;My&#39;: 2, &#39;read&#39;: 2, &#39;SAY&#39;: 2, &#39;UP&#39;: 1, &#39;cup.&#39;: 1, &#39;Cup&#39;: 1, &#39;pup.&#39;: 1, &#39;Mouse&#39;: 1, &#39;house.&#39;: 1, &#39;House&#39;: 1, &#39;mouse.&#39;: 1, &#39;TALL&#39;: 1, &#39;tall.&#39;: 1, &#39;SMALL&#39;: 1, &#39;small.&#39;: 1, &#39;ball.&#39;: 1, &#39;WALL&#39;: 1, &#39;Up&#39;: 1, &#39;FALL&#39;: 1, &#39;Fall&#39;: 1, &#39;off&#39;: 1, &#39;DAY&#39;: 1, &#39;PLAY&#39;: 1, &#39;NIGHT&#39;: 1, &#39;FIGHT&#39;: 1, &#39;fight&#39;: 1, &#39;night.HE&#39;: 1, &#39;ME&#39;: 1, &#39;me.&#39;: 1, &#39;HIM&#39;: 1, &#39;JIM&#39;: 1, &#39;Jim&#39;: 1, &#39;him.&#39;: 1, &#39;bee.&#39;: 1, &#39;Now&#39;: 1, &#39;we&#39;: 1, &#39;three.&#39;: 1, &#39;TREE&#39;: 1, &#39;Three&#39;: 1, &#39;fish&#39;: 1, &#39;tree.&#39;: 1, &#39;Fish&#39;: 1, &#39;tree?&#39;: 1, &#39;How&#39;: 1, &#39;be?&#39;: 1, &#39;Red.&#39;: 1, &#39;am&#39;: 1, &#39;bed.&#39;: 1, &#39;NED&#39;: 1, &#39;TED&#39;: 1, &#39;ED&#39;: 1, &#39;they&#39;: 1, &#39;Pat.&#39;: 1, &#39;SAT&#39;: 1, &#39;hat.&#39;: 1, &#39;CAT&#39;: 1, &#39;cat.&#39;: 1, &#39;BAT&#39;: 1, &#39;bat.&#39;: 1, &#39;Don’t&#39;: 1, &#39;sit&#39;: 1, &#39;that.&#39;: 1, &#39;SAD&#39;: 1, &#39;DAD&#39;: 1, &#39;BAD&#39;: 1, &#39;HAD&#39;: 1, &#39;Very,&#39;: 1, &#39;very&#39;: 1, &#39;had&#39;: 1, &#39;bad&#39;: 1, &#39;day&#39;: 1, &#39;had!&#39;: 1, &#39;thing?&#39;: 1, &#39;SING&#39;: 1, &#39;thing&#39;: 1, &#39;sing!&#39;: 1, &#39;SONG&#39;: 1, &#39;LONG&#39;: 1, &#39;A&#39;: 1, &#39;long,&#39;: 1, &#39;long&#39;: 1, &#39;song.&#39;: 1, &#39;Good-by,&#39;: 1, &#39;Thing.&#39;: 1, &#39;sing&#39;: 1, &#39;too&#39;: 1, &#39;long.&#39;: 1, &#39;walk.&#39;: 1, &#39;TALK&#39;: 1, &#39;talk.&#39;: 1, &#39;HOP&#39;: 1, &#39;POP&#39;: 1, &#39;hop.&#39;: 1, &#39;top&#39;: 1, &#39;STOP&#39;: 1, &#39;must&#39;: 1, &#39;Mrs.&#39;: 1, &#39;upside&#39;: 1, &#39;Where&#39;: 1, &#39;Brown?&#39;: 1, &#39;WHERE&#39;: 1, &#39;BROWN?&#39;: 1, &#39;THERE&#39;: 1, &#39;BROWN!&#39;: 1, &#39;town.&#39;: 1, &#39;BACK&#39;: 1, &#39;BLACK&#39;: 1, &#39;back.&#39;: 1, &#39;back&#39;: 1, &#39;snack.&#39;: 1, &#39;snack&#39;: 1, &#39;JUMP&#39;: 1, &#39;BUMP&#39;: 1, &#39;jumped.&#39;: 1, &#39;bumped.&#39;: 1, &#39;FAST&#39;: 1, &#39;PAST&#39;: 1, &#39;past&#39;: 1, &#39;fast.&#39;: 1, &#39;WENT&#39;: 1, &#39;TENT&#39;: 1, &#39;SENT&#39;: 1, &#39;into&#39;: 1, &#39;sent&#39;: 1, &#39;WET&#39;: 1, &#39;GET&#39;: 1, &#39;Two&#39;: 1, &#39;dogs&#39;: 1, &#39;get&#39;: 1, &#39;wet.&#39;: 1, &#39;HELP&#39;: 1, &#39;YELP&#39;: 1, &#39;yelp&#39;: 1, &#39;for&#39;: 1, &#39;help.&#39;: 1, &#39;hill.&#39;: 1, &#39;STILL&#39;: 1, &#39;hill&#39;: 1, &#39;still.&#39;: 1, &#39;FATHER&#39;: 1, &#39;MOTHER&#39;: 1, &#39;SISTER&#39;: 1, &#39;BROTHER&#39;: 1, &#39;one&#39;: 1, &#39;my&#39;: 1, &#39;other&#39;: 1, &#39;brother.&#39;: 1, &#39;brothers&#39;: 1, &#39;little&#39;: 1, &#39;bit.&#39;: 1, &#39;Little&#39;: 1, &#39;words&#39;: 1, &#39;If&#39;: 1, &#39;it.&#39;: 1, &#39;father&#39;: 1, &#39;big&#39;: 1, &#39;words,&#39;: 1, &#39;too.&#39;: 1, &#39;Like&#39;: 1, &#39;CONSTANTINOPLE&#39;: 1, &#39;TIMBUKTU&#39;: 1, &#39;does&#39;: 1, &#39;this&#39;: 1, &#39;say?&#39;: 1, &#39;seehemewe&#39;: 1, &#39;patpuppop&#39;: 1, &#39;hethreetreebee&#39;: 1, &#39;tophopstop&#39;: 1, &#39;Ask&#39;: 1, &#39;tomorrow&#39;: 1, &#39;but&#39;: 1, &#39;today.&#39;: 1})</code></pre>
</div>
</div>
</section>
<section id="bag-of-words-representation-1" class="level3" data-number="7.2.5">
<h3 data-number="7.2.5"><span class="header-section-number">7.2.5</span> Bag-of-Words Representation</h3>
<p>… then, we put these counts into a <code>Series</code> and stack them into a <code>DataFrame</code>.</p>
<p>This is called <strong>bag of words</strong> data.</p>
<div class="cell">
<div class="sourceCode" id="cb272"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>    [pd.Series(Counter(doc.split())) <span class="cf">for</span> doc <span class="kw">in</span> docs.values()],</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>docs.keys())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       I   am  Sam  ...  gone.  Tomorrow  one.
green_eggs_and_ham.txt              71.0  3.0  3.0  ...    NaN       NaN   NaN
cat_in_the_hat.txt                  48.0  NaN  NaN  ...    NaN       NaN   NaN
fox_in_socks.txt                     9.0  NaN  NaN  ...    NaN       NaN   NaN
how_the_grinch_stole_christmas.txt   6.0  NaN  NaN  ...    NaN       NaN   NaN
hop_on_pop.txt                       2.0  1.0  NaN  ...    NaN       NaN   NaN
horton_hears_a_who.txt              18.0  1.0  NaN  ...    NaN       NaN   NaN
oh_the_places_youll_go.txt           2.0  NaN  NaN  ...    NaN       NaN   NaN
one_fish_two_fish.txt               48.0  3.0  NaN  ...    1.0       1.0   1.0

[8 rows x 2562 columns]</code></pre>
</div>
</div>
</section>
<section id="bag-of-words-in-scikit-learn" class="level3" data-number="7.2.6">
<h3 data-number="7.2.6"><span class="header-section-number">7.2.6</span> Bag-of-Words in Scikit-Learn</h3>
<p>Alternatively, we can use <code>CountVectorizer</code> in <code>scikit-learn</code> to produce a bag-of-words matrix.</p>
<div class="cell">
<div class="sourceCode" id="cb274"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> CountVectorizer()</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>vec.fit(docs.values())</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-10 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-10 {
  color: var(--sklearn-color-text);
}

#sk-container-id-10 pre {
  padding: 0;
}

#sk-container-id-10 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-10 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-10 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-10 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-10 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-10 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-10 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-10 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-10 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-10 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-10 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-10 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-10 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-10 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-10 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-10 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-10 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-10 div.sk-label label.sk-toggleable__label,
#sk-container-id-10 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-10 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-10 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-10 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-10 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-10 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-10 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-10 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-10 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-10 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-10 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-10" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox" checked><label for="sk-estimator-id-38" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer()</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb275"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>vec.transform(docs.values())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;8x1344 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
    with 2308 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
<section id="vocabulary" class="level3" data-number="7.2.7">
<h3 data-number="7.2.7"><span class="header-section-number">7.2.7</span> Vocabulary</h3>
<p>The set of words across a corpus is called the <strong>vocabulary</strong>. We can view the vocabulary in a fitted <code>CountVectorizer</code> as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb277"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>vec.vocabulary_[<span class="st">&quot;fish&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>388</code></pre>
</div>
<div class="sourceCode" id="cb279"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>vec.vocabulary_[<span class="st">&quot;pop&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>850</code></pre>
</div>
<div class="sourceCode" id="cb281"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>vec.vocabulary_[<span class="st">&quot;eggs&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>326</code></pre>
</div>
</div>
</section>
<section id="text-normalizing" class="level3" data-number="7.2.8">
<h3 data-number="7.2.8"><span class="header-section-number">7.2.8</span> Text Normalizing</h3>
<p>What’s wrong with the way we counted words originally?</p>
<pre><code>Counter({&#39;UP&#39;: 1, &#39;PUP&#39;: 3, &#39;Pup&#39;: 4, &#39;is&#39;: 10, &#39;up.&#39;: 2, ...})</code></pre>
<ul>
<li><p>It’s usually good to <strong>normalize</strong> for punctuation and capitalization.</p></li>
<li><p>Normalization options are specified when you initialize the <code>CountVectorizer</code>.</p></li>
<li><p>By default, Scikit-Learn strips punctuation and converts all characters to lowercase.</p></li>
</ul>
</section>
<section id="text-normalizing-in-sklearn" class="level3" data-number="7.2.9">
<h3 data-number="7.2.9"><span class="header-section-number">7.2.9</span> Text Normalizing in sklearn</h3>
<ul>
<li>If you don’t want Scikit-Learn to normalize for punctuation and capitalization, you can do the following:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb284"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> CountVectorizer(lowercase<span class="op">=</span><span class="va">False</span>, token_pattern<span class="op">=</span><span class="vs">r&quot;[\S]+&quot;</span>)</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>vec.fit(docs.values())</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-11 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-11 {
  color: var(--sklearn-color-text);
}

#sk-container-id-11 pre {
  padding: 0;
}

#sk-container-id-11 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-11 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-11 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-11 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-11 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-11 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-11 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-11 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-11 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-11 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-11 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-11 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-11 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-11 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-11 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-11 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-11 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-11 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-11 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-11 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-11 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-11 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-11 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-11 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-11 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-11 div.sk-label label.sk-toggleable__label,
#sk-container-id-11 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-11 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-11 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-11 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-11 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-11 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-11 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-11 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-11 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-11 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-11 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-11 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-11 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-11" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer(lowercase=False, token_pattern=&#x27;[\\S]+&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox" checked><label for="sk-estimator-id-39" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer(lowercase=False, token_pattern=&#x27;[\\S]+&#x27;)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb285"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>vec.transform(docs.values())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;8x2562 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
    with 3679 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="n-grams" class="level2" data-number="7.3">
<h2 data-number="7.3"><span class="header-section-number">7.3</span> N-grams</h2>
<section id="the-shortcomings-of-bag-of-words" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1"><span class="header-section-number">7.3.1</span> The Shortcomings of Bag-of-Words</h3>
<p>Bag-of-words is easy to understand and easy to implement.</p>
<p>What are its disadvantages?</p>
<p>Consider the following documents:</p>
<ol type="1">
<li><p>“The dog bit her owner.”</p></li>
<li><p>“Her dog bit the owner.”</p></li>
</ol>
<p>Both documents have the same exact bag-of-words representation, but they mean something quite different!</p>
</section>
<section id="n-grams-1" class="level3 smaller" data-number="7.3.2">
<h3 class="smaller" data-number="7.3.2"><span class="header-section-number">7.3.2</span> N-grams</h3>
<ul>
<li><p>An <strong>n-gram</strong> is a sequence of <span class="math inline">\(n\)</span> words.</p></li>
<li><p>N-grams allow us to capture more of the meaning.</p></li>
<li><p>For example, if we count <strong>bigrams</strong> (2-grams) instead of words, we can distinguish the two documents from before:</p></li>
</ul>
<ol type="1">
<li><p>“The dog bit her owner.”</p></li>
<li><p>“Her dog bit the owner.”</p></li>
</ol>
<p><span class="math display">\[\begin{array}{l|ccccccc}
&amp; \text{the,dog} &amp; \text{her,dog} &amp; \text{dog,bit} &amp; \text{bit,the} &amp; \text{bit,her} &amp; \text{the,owner} &amp; \text{her,owner} \\
\hline
\text{1} &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 1 \\
\text{2} &amp; 0 &amp; 1 &amp; 1 &amp; 1 &amp; 0 &amp; 1 &amp; 0 \\
\end{array}\]</span></p>
</section>
<section id="n-grams-in-scikit-learn" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3"><span class="header-section-number">7.3.3</span> N-grams in Scikit-Learn</h3>
<p>Scikit-Learn can create n-grams.</p>
<p>Pass in <code>ngram_range=</code> to the <code>CountVectorizer</code>.</p>
<p>To get bigrams, we set the range to <code>(2, 2)</code> …</p>
<div class="cell">
<div class="sourceCode" id="cb287"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>vec.fit(docs.values())</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-12 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-12 {
  color: var(--sklearn-color-text);
}

#sk-container-id-12 pre {
  padding: 0;
}

#sk-container-id-12 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-12 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-12 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-12 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-12 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-12 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-12 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-12 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-12 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-12 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-12 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-12 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-12 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-12 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-12 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-12 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-12 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-12 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-12 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-12 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-12 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-12 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-12 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-12 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-12 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-12 div.sk-label label.sk-toggleable__label,
#sk-container-id-12 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-12 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-12 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-12 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-12 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-12 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-12 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-12 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-12 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-12 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-12 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-12 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-12 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-12" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer(ngram_range=(2, 2))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox" checked><label for="sk-estimator-id-40" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer(ngram_range=(2, 2))</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb288"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>vec.transform(docs.values())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;8x5846 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
    with 6459 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
<section id="n-grams-in-scikit-learn-1" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4"><span class="header-section-number">7.3.4</span> N-grams in Scikit-learn</h3>
<p>… or we can also get individual words (unigrams) alongside the bigrams:</p>
<div class="cell">
<div class="sourceCode" id="cb290"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>vec.fit(docs.values())</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-13 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-13 {
  color: var(--sklearn-color-text);
}

#sk-container-id-13 pre {
  padding: 0;
}

#sk-container-id-13 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-13 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-13 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-13 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-13 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-13 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-13 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-13 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-13 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-13 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-13 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-13 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-13 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-13 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-13 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-13 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-13 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-13 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-13 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-13 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-13 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-13 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-13 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-13 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-13 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-13 div.sk-label label.sk-toggleable__label,
#sk-container-id-13 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-13 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-13 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-13 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-13 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-13 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-13 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-13 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-13 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-13 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-13 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-13 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-13 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-13" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer(ngram_range=(1, 2))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-41" type="checkbox" checked><label for="sk-estimator-id-41" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb291"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>vec.transform(docs.values())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;8x7190 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
    with 8767 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="text-data-and-distances" class="level2" data-number="7.4">
<h2 data-number="7.4"><span class="header-section-number">7.4</span> Text Data and Distances</h2>
<section id="similar-documents" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1"><span class="header-section-number">7.4.1</span> Similar documents</h3>
<p>Now, we can use this <strong>bag-of-words</strong> data to measure <strong>similarities</strong> between documents!</p>
<div class="cell">
<div class="sourceCode" id="cb293"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>vec.fit(docs.values())</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-14 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-14 {
  color: var(--sklearn-color-text);
}

#sk-container-id-14 pre {
  padding: 0;
}

#sk-container-id-14 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-14 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-14 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-14 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-14 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-14 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-14 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-14 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-14 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-14 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-14 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-14 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-14 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-14 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-14 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-14 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-14 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-14 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-14 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-14 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-14 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-14 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-14 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-14 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-14 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-14 div.sk-label label.sk-toggleable__label,
#sk-container-id-14 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-14 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-14 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-14 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-14 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-14 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-14 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-14 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-14 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-14 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-14 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-14 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-14 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-14" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer(ngram_range=(1, 2))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-42" type="checkbox" checked><label for="sk-estimator-id-42" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer(ngram_range=(1, 2))</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb294"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> vec.transform(docs.values())</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> pairwise_distances(dat)</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>dists</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[  0.        , 204.84628383, 178.52730884, 219.79535937,
        168.42802617, 228.52570971, 183.5973856 , 178.83511959],
       [204.84628383,   0.        , 189.45711916, 157.15597348,
        186.2793601 , 152.32859219, 175.28262892, 156.12815249],
       [178.52730884, 189.45711916,   0.        , 171.66828478,
         95.21554495, 189.95262567, 141.52031656, 130.11533345],
       [219.79535937, 157.15597348, 171.66828478,   0.        ,
        163.84138671, 138.97481786, 174.56230979, 162.59766296],
       [168.42802617, 186.2793601 ,  95.21554495, 163.84138671,
          0.        , 188.92855793, 133.1990991 , 112.89818422],
       [228.52570971, 152.32859219, 189.95262567, 138.97481786,
        188.92855793,   0.        , 162.83120094, 164.95453919],
       [183.5973856 , 175.28262892, 141.52031656, 174.56230979,
        133.1990991 , 162.83120094,   0.        , 134.98888843],
       [178.83511959, 156.12815249, 130.11533345, 162.59766296,
        112.89818422, 164.95453919, 134.98888843,   0.        ]])</code></pre>
</div>
</div>
</section>
<section id="similar-documents-1" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2"><span class="header-section-number">7.4.2</span> Similar documents</h3>
<div class="cell">
<div class="sourceCode" id="cb296"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>dists[<span class="dv">0</span>].argsort()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([0, 4, 2, 7, 6, 1, 3, 5])</code></pre>
</div>
<div class="sourceCode" id="cb298"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>docs.keys()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys([&#39;green_eggs_and_ham.txt&#39;, &#39;cat_in_the_hat.txt&#39;, &#39;fox_in_socks.txt&#39;, &#39;how_the_grinch_stole_christmas.txt&#39;, &#39;hop_on_pop.txt&#39;, &#39;horton_hears_a_who.txt&#39;, &#39;oh_the_places_youll_go.txt&#39;, &#39;one_fish_two_fish.txt&#39;])</code></pre>
</div>
</div>
<ul>
<li>This is how data scientists do <strong>authorship identification</strong>!</li>
</ul>
</section>
</section>
<section id="activity-3" class="level2" data-number="7.5">
<h2 data-number="7.5"><span class="header-section-number">7.5</span> Activity</h2>
<section id="activity-1-1" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1"><span class="header-section-number">7.5.1</span> Activity 1</h3>
<p>Using bi-grams, unigrams, and tri-grams, which Dr. Seuss document is closest to “One Fish Two Fish”?</p>
</section>
</section>
<section id="motivating-example" class="level2" data-number="7.6">
<h2 data-number="7.6"><span class="header-section-number">7.6</span> Motivating example</h2>
<section id="issues-with-the-distance-approach" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1"><span class="header-section-number">7.6.1</span> Issues with the distance approach</h3>
<p><strong>BUT WAIT!</strong></p>
<ul>
<li><p>Don’t we care more about <em>word choice</em> than <em>total words used</em>?</p></li>
<li><p>Wouldn’t a <em>longer document</em> have <em>more words</em>, and thus be able to “match” other documents?</p></li>
<li><p>Wouldn’t <em>more common words</em> appear in more documents, and thus cause them to “match”?</p></li>
<li><p>Recall: We have many options for <strong>scaling</strong></p></li>
<li><p>Recall: We have many options for <strong>distance metrics</strong>.</p></li>
</ul>
</section>
<section id="example-1" class="level3 smaller" data-number="7.6.2">
<h3 class="smaller" data-number="7.6.2"><span class="header-section-number">7.6.2</span> Example</h3>
<p><strong>Document A:</strong></p>
<blockquote>
<p>“Whoever has hate for his brother is in the darkness and walks in the darkness.”</p>
</blockquote>
<p><strong>Document B:</strong></p>
<blockquote>
<p>“Hello darkness, my old friend, I’ve come to talk with you again.”</p>
</blockquote>
<p><strong>Document C:</strong></p>
<blockquote>
<p>“Returning hate for hate multiplies hate, adding deeper darkness to a night already devoid of stars. Darkness cannot drive out darkness; only light can do that.”</p>
</blockquote>
<p><strong>Document D:</strong></p>
<blockquote>
<p>“Happiness can be found in the darkest of times, if only one remembers to turn on the light.”</p>
</blockquote>
</section>
<section id="example-2" class="level3" data-number="7.6.3">
<h3 data-number="7.6.3"><span class="header-section-number">7.6.3</span> Example</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb300"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> [</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;whoever has hate for his brother is in the darkness and walks in the darkness&quot;</span>,</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hello darkness my old friend&quot;</span>,</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;returning hate for hate multiplies hate adding deeper darkness to a night already devoid of stars darkness cannot drive out darkness only light can do that&quot;</span>,</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;happiness can be found in the darkest of times if only one remembers to turn on the light&quot;</span></span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb301"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> CountVectorizer(token_pattern<span class="op">=</span><span class="vs">r&quot;\w+&quot;</span>)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>vec.fit(documents)</span></code></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-16 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-16 {
  color: var(--sklearn-color-text);
}

#sk-container-id-16 pre {
  padding: 0;
}

#sk-container-id-16 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-16 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-16 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-16 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-16 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-16 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-16 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-16 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-16 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-16 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-16 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-16 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-16 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-16 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-16 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-16 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-16 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-16 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-16 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-16 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-16 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-16 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-16 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-16 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-16 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-16 div.sk-label label.sk-toggleable__label,
#sk-container-id-16 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-16 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-16 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-16 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-16 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-16 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-16 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-16 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-16 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-16 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-16 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-16 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-16 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-16" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer(token_pattern=&#x27;\\w+&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-44" type="checkbox" checked><label for="sk-estimator-id-44" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer(token_pattern=&#x27;\\w+&#x27;)</pre></div> </div></div></div></div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb302"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>bow_matrix <span class="op">=</span> vec.transform(documents)</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>bow_matrix</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;4x45 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
    with 56 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
<section id="example-3" class="level3" data-number="7.6.4">
<h3 data-number="7.6.4"><span class="header-section-number">7.6.4</span> Example</h3>
<div class="cell">
<div class="sourceCode" id="cb304"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>bow_dataframe <span class="op">=</span> pd.DataFrame(bow_matrix.todense(), columns<span class="op">=</span>vec.get_feature_names_out())</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>bow_dataframe[[<span class="st">&quot;darkness&quot;</span>, <span class="st">&quot;light&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   darkness  light
0         2      0
1         1      0
2         3      1
3         0      1</code></pre>
</div>
</div>
</section>
<section id="measuring-similarity" class="level3" data-number="7.6.5">
<h3 data-number="7.6.5"><span class="header-section-number">7.6.5</span> Measuring similarity</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb306"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>pairwise_distances(bow_matrix)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.        , 4.69041576, 6.244998  , 5.38516481],
       [4.69041576, 0.        , 6.08276253, 5.        ],
       [6.244998  , 6.08276253, 0.        , 6.92820323],
       [5.38516481, 5.        , 6.92820323, 0.        ]])</code></pre>
</div>
</div>
</section>
</section>
<section id="cosine-distance" class="level2" data-number="7.7">
<h2 data-number="7.7"><span class="header-section-number">7.7</span> Cosine Distance</h2>
<section id="choosing-your-distance-metric" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1"><span class="header-section-number">7.7.1</span> Choosing your distance metric</h3>
<p>Is <strong>euclidean distance</strong> really the best choice?!</p>
<blockquote>
<p>My name is James Bond, James Bond is my name.</p>
</blockquote>
<blockquote>
<p>My name is James Bond.</p>
</blockquote>
<blockquote>
<p>My name is James.</p>
</blockquote>
<ul>
<li><p>If we count words the second two will be the most similar.</p></li>
<li><p>The first document is longer, so it has “double” counts.</p></li>
<li><p>But, it has the exact same words as the first document!</p></li>
<li><p>Solution: <strong>cosine distance</strong> (on the board)</p></li>
</ul>
</section>
<section id="cosine-distance-1" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2"><span class="header-section-number">7.7.2</span> Cosine Distance</h3>
<p>As a rule, <strong>cosine distance</strong> is a better choice for bag-of-words data!</p>
<div class="cell">
<div class="sourceCode" id="cb308"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_distances</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>cosine_distances(bow_matrix)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.        , 0.80481999, 0.64600384, 0.70722998],
       [0.80481999, 0.        , 0.78235712, 1.        ],
       [0.64600384, 0.78235712, 0.        , 0.81863094],
       [0.70722998, 1.        , 0.81863094, 0.        ]])</code></pre>
</div>
</div>
</section>
</section>
<section id="tf-idf" class="level2" data-number="7.8">
<h2 data-number="7.8"><span class="header-section-number">7.8</span> TF-IDF</h2>
<section id="scaling-terms" class="level3" data-number="7.8.1">
<h3 data-number="7.8.1"><span class="header-section-number">7.8.1</span> Scaling terms</h3>
<p>Which of these seems most important for measuring similarity?</p>
<ul>
<li><p>Document B, C, D all have the word “to”</p></li>
<li><p>Documents A, B, and C all have the word <strong>darkness</strong>.</p></li>
<li><p>Document A and Document C both have the word “hate”</p></li>
<li><p>Document C and Document D both have the word “light”</p></li>
<li><p>We would like to <strong>scale</strong> our <strong>word counts</strong> by the <strong>document length</strong> (TF).</p></li>
<li><p>We would also like to <strong>scale</strong> our <strong>word counts</strong> by the <strong>number of documents they appear in</strong>. (IDF)</p></li>
</ul>
</section>
<section id="term-frequencies-tf" class="level3" data-number="7.8.2">
<h3 data-number="7.8.2"><span class="header-section-number">7.8.2</span> Term Frequencies (TF)</h3>
<ul>
<li><p>If a document is longer, it is more likely to share words.</p></li>
<li><p>Let’s use <em>frequencies</em> instead of <em>counts</em></p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb310"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>bow_totals <span class="op">=</span> bow_dataframe.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>bow_totals</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    15
1     5
2    26
3    18
dtype: int64</code></pre>
</div>
<div class="sourceCode" id="cb312"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>bow_tf <span class="op">=</span> bow_dataframe.divide(bow_totals, axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>bow_tf</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          a    adding   already  ...      turn     walks   whoever
0  0.000000  0.000000  0.000000  ...  0.000000  0.066667  0.066667
1  0.000000  0.000000  0.000000  ...  0.000000  0.000000  0.000000
2  0.038462  0.038462  0.038462  ...  0.000000  0.000000  0.000000
3  0.000000  0.000000  0.000000  ...  0.055556  0.000000  0.000000

[4 rows x 45 columns]</code></pre>
</div>
</div>
</section>
<section id="term-frequencies-tf-1" class="level3" data-number="7.8.3">
<h3 data-number="7.8.3"><span class="header-section-number">7.8.3</span> Term Frequencies (TF)</h3>
<div class="cell">
<div class="sourceCode" id="cb314"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>cosine_distances(bow_tf)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.        , 0.80481999, 0.64600384, 0.70722998],
       [0.80481999, 0.        , 0.78235712, 1.        ],
       [0.64600384, 0.78235712, 0.        , 0.81863094],
       [0.70722998, 1.        , 0.81863094, 0.        ]])</code></pre>
</div>
</div>
</section>
<section id="inverse-document-frequency-idf" class="level3" data-number="7.8.4">
<h3 data-number="7.8.4"><span class="header-section-number">7.8.4</span> Inverse Document Frequency (IDF)</h3>
<ul>
<li><p>In principle, if two documents <strong>share rarer words</strong> they are <strong>more similar</strong>.</p></li>
<li><p>What matters is not <em>overall word frequency</em> but <strong>how many of the documents</strong> have that word.</p></li>
<li><p>Compute document frequency:</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb316"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>has_word <span class="op">=</span> (bow_dataframe <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>has_word[[<span class="st">&quot;darkness&quot;</span>, <span class="st">&quot;light&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   darkness  light
0      True  False
1      True  False
2      True   True
3     False   True</code></pre>
</div>
</div>
</section>
<section id="idf" class="level3" data-number="7.8.5">
<h3 data-number="7.8.5"><span class="header-section-number">7.8.5</span> IDF</h3>
<div class="cell">
<div class="sourceCode" id="cb318"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>bow_df <span class="op">=</span> has_word.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">0</span>)<span class="op">/</span><span class="dv">4</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>bow_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a             0.25
adding        0.25
already       0.25
and           0.25
be            0.25
brother       0.25
can           0.50
cannot        0.25
darkest       0.25
darkness      0.75
deeper        0.25
devoid        0.25
do            0.25
drive         0.25
for           0.50
found         0.25
friend        0.25
happiness     0.25
has           0.25
hate          0.50
hello         0.25
his           0.25
if            0.25
in            0.50
is            0.25
light         0.50
multiplies    0.25
my            0.25
night         0.25
of            0.50
old           0.25
on            0.25
one           0.25
only          0.50
out           0.25
remembers     0.25
returning     0.25
stars         0.25
that          0.25
the           0.50
times         0.25
to            0.50
turn          0.25
walks         0.25
whoever       0.25
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="idf-1" class="level3" data-number="7.8.6">
<h3 data-number="7.8.6"><span class="header-section-number">7.8.6</span> IDF</h3>
<p>Adjust for inverse document frequencies:</p>
<div class="cell">
<div class="sourceCode" id="cb320"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>bow_log_idf <span class="op">=</span> np.log(<span class="dv">1</span><span class="op">/</span>bow_df)</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>bow_tf_idf <span class="op">=</span> bow_tf.multiply(bow_log_idf, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>bow_tf_idf[[<span class="st">&quot;darkness&quot;</span>, <span class="st">&quot;light&quot;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   darkness     light
0  0.038358  0.000000
1  0.057536  0.000000
2  0.033194  0.026660
3  0.000000  0.038508</code></pre>
</div>
</div>
</section>
<section id="tf-idf-1" class="level3" data-number="7.8.7">
<h3 data-number="7.8.7"><span class="header-section-number">7.8.7</span> TF-IDF</h3>
<div class="cell">
<div class="sourceCode" id="cb322"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>cosine_distances(bow_tf_idf).<span class="bu">round</span>(decimals <span class="op">=</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.  , 0.99, 0.9 , 0.86],
       [0.99, 0.  , 0.98, 1.  ],
       [0.9 , 0.98, 0.  , 0.92],
       [0.86, 1.  , 0.92, 0.  ]])</code></pre>
</div>
</div>
</section>
<section id="tf-idf-in-sklearn" class="level3" data-number="7.8.8">
<h3 data-number="7.8.8"><span class="header-section-number">7.8.8</span> TF-IDF in Sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb324"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The options ensure that the numbers match our example above.</span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> TfidfVectorizer(smooth_idf<span class="op">=</span><span class="va">False</span>, norm<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>vec.fit(documents)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-17 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-17 {
  color: var(--sklearn-color-text);
}

#sk-container-id-17 pre {
  padding: 0;
}

#sk-container-id-17 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-17 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-17 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-17 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-17 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-17 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-17 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-17 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-17 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-17 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-17 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-17 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-17 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-17 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-17 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-17 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-17 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-17 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-17 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-17 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-17 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-17 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-17 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-17 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-17 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-17 div.sk-label label.sk-toggleable__label,
#sk-container-id-17 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-17 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-17 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-17 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-17 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-17 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-17 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-17 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-17 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-17 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-17 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-17 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-17 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-17" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>TfidfVectorizer(norm=None, smooth_idf=False)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-45" type="checkbox" checked><label for="sk-estimator-id-45" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;TfidfVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html">?<span>Documentation for TfidfVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>TfidfVectorizer(norm=None, smooth_idf=False)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode" id="cb325"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>tfidf_matrix <span class="op">=</span> vec.transform(documents)</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>cosine_distances(tfidf_matrix)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.        , 0.92261817, 0.78495457, 0.78557322],
       [0.92261817, 0.        , 0.91239706, 1.        ],
       [0.78495457, 0.91239706, 0.        , 0.86513906],
       [0.78557322, 1.        , 0.86513906, 0.        ]])</code></pre>
</div>
</div>
</section>
</section>
<section id="activity-2-1" class="level2" data-number="7.9">
<h2 data-number="7.9"><span class="header-section-number">7.9</span> Activity 2</h2>
<section id="activity-4" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1"><span class="header-section-number">7.9.1</span> Activity</h3>
<p>Using bi-grams, unigrams, and tri-grams, which Dr. Seuss document is closest to “One Fish Two Fish”?</p>
</section>
</section>
<section id="takeaways-9" class="level2" data-number="7.10">
<h2 data-number="7.10"><span class="header-section-number">7.10</span> Takeaways</h2>
<section id="takeaways-10" class="level3" data-number="7.10.1">
<h3 data-number="7.10.1"><span class="header-section-number">7.10.1</span> Takeaways</h3>
<ul>
<li><p>We represent <strong>text data</strong> as a <strong>bag-of-words</strong> or <strong>bag-of-n-grams</strong> matrix.</p></li>
<li><p>Each row is a <strong>document</strong> in the <strong>corpus</strong>.</p></li>
<li><p>We typically use <strong>cosine distance</strong> to measure similarity, because it captures <strong>patterns of word choice</strong></p></li>
<li><p>We apply <strong>TF-IDF</strong> transformations to <strong>scale</strong> the bag-of-words data, so that words that <strong>appear in fewer documents</strong> are <strong>more important</strong></p></li>
</ul>
</section>
</section>
<section id="k-nearest-neighbors" class="level1 lectitle" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> K Nearest Neighbors</h1>
<p><a href="slides-08-knn.html">Slides</a></p>
</section>
<section id="the-story-so-far-5" class="level2" data-number="8.1">
<h2 data-number="8.1"><span class="header-section-number">8.1</span> The story so far</h2>
<section id="steps-for-data-analysis" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1"><span class="header-section-number">8.1.1</span> Steps for data analysis</h3>
<ul>
<li><strong>Read</strong> and then <strong>clean</strong> the data
<ul>
<li>Are there missing values? Will we drop those rows, or replace the missing values with something?</li>
<li>Are there <em>quantitative</em> variables that python thinks are <em>categorical</em>?</li>
<li>Are there <em>categorical</em> variables that python thinks are <em>quantitative</em>?</li>
<li>Are there any <em>anomalies</em> in the data that concern you?</li>
</ul></li>
</ul>
</section>
<section id="steps-for-data-analysis-contd" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2"><span class="header-section-number">8.1.2</span> Steps for data analysis (cont’d)</h3>
<ul>
<li><strong>Explore</strong> the data by <strong>visualizing</strong> and <strong>summarizing</strong>.
<ul>
<li>Different approaches for different combos of <em>quantitative</em> and <em>categorical</em> variables</li>
<li>Think about <em>conditional</em> calculations (split-apply-combine)</li>
</ul></li>
</ul>
</section>
<section id="steps-for-data-analysis-contd-1" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3"><span class="header-section-number">8.1.3</span> Steps for data analysis (cont’d)</h3>
<ul>
<li><p>Identify a <strong>research question</strong> of interest.</p></li>
<li><p>Perform <strong>preprocessing</strong> steps</p>
<ul>
<li>Should we <em>scale</em> the quantitative variables?</li>
<li>Should we <em>one-hot-encode</em> the categorical variables?</li>
<li>Should we <em>log-transform</em> any variables?</li>
</ul></li>
<li><p>Measure similarity between <strong>observations</strong> by calculating <strong>distances</strong>.</p>
<ul>
<li>Which <em>features</em> should be included?</li>
<li>Which <em>distance metric</em> should we use?</li>
</ul></li>
</ul>
</section>
</section>
<section id="predicting-wine-prices" class="level2" data-number="8.2">
<h2 data-number="8.2"><span class="header-section-number">8.2</span> Predicting wine prices</h2>
<section id="data-wine-qualities" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1"><span class="header-section-number">8.2.1</span> Data: Wine qualities</h3>
<div class="cell">
<div class="sourceCode" id="cb327"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://dlsun.github.io/pods/data/bordeaux.csv&quot;</span>)</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year  price  summer  har   sep  win  age
0   1952   37.0    17.1  160  14.3  600   40
1   1953   63.0    16.7   80  17.3  690   39
2   1955   45.0    17.1  130  16.8  502   37
3   1957   22.0    16.1  110  16.2  420   35
4   1958   18.0    16.4  187  19.1  582   34
5   1959   66.0    17.5  187  18.7  485   33
6   1960   14.0    16.4  290  15.8  763   32
7   1961  100.0    17.3   38  20.4  830   31
8   1962   33.0    16.3   52  17.2  697   30
9   1963   17.0    15.7  155  16.2  608   29
10  1964   31.0    17.3   96  18.8  402   28
11  1965   11.0    15.4  267  14.8  602   27
12  1966   47.0    16.5   86  18.4  819   26
13  1967   19.0    16.2  118  16.5  714   25
14  1968   11.0    16.2  292  16.4  610   24
15  1969   12.0    16.5  244  16.6  575   23
16  1970   40.0    16.7   89  18.0  622   22
17  1971   27.0    16.8  112  16.9  551   21
18  1972   10.0    15.0  158  14.6  536   20
19  1973   16.0    17.1  123  17.9  376   19
20  1974   11.0    16.3  184  16.2  574   18
21  1975   30.0    16.9  171  17.2  572   17
22  1976   25.0    17.6  247  16.1  418   16
23  1977   11.0    15.6   87  16.8  821   15
24  1978   27.0    15.8   51  17.4  763   14
25  1979   21.0    16.2  122  17.3  717   13
26  1980   14.0    16.0   74  18.4  578   12
27  1981    NaN    17.0  111  18.0  535   11
28  1982    NaN    17.4  162  18.5  712   10
29  1983    NaN    17.4  119  17.9  845    9
30  1984    NaN    16.5  119  16.0  591    8
31  1985    NaN    16.8   38  18.9  744    7
32  1986    NaN    16.3  171  17.5  563    6
33  1987    NaN    17.0  115  18.9  452    5
34  1988    NaN    17.1   59  16.8  808    4
35  1989    NaN    18.6   82  18.4  443    3
36  1990    NaN    18.7   80  19.3  468    2
37  1991    NaN    17.7  183  20.4  570    1</code></pre>
</div>
</div>
</section>
<section id="data-wine-qualities-1" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2"><span class="header-section-number">8.2.2</span> Data: Wine qualities</h3>
<ul>
<li><p>Our goal is to <strong>predict</strong> what will be the quality (price) of wines in a <strong>future year</strong>.</p></li>
<li><p>Idea: Wines with similar <strong>features</strong> probably have similar <strong>quality</strong>.</p></li>
<li><p><strong>Inputs</strong>: Summer temperature, harvest rainfall, september temperature, winter rainfall, age of wine.</p></li>
<li><p><strong>Output:</strong> Price in 1992.</p></li>
<li><p>“Inputs” = “Features” = “Predictors” = “Independent variables”</p></li>
<li><p>“Output” = “Target” = “Dependent variable”</p></li>
</ul>
</section>
<section id="similar-wines" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3"><span class="header-section-number">8.2.3</span> Similar wines</h3>
<p>Which wines have similar summer temps and winter rainfall to the 1989 vintage?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb329"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;summer&quot;</span>, y <span class="op">=</span> <span class="st">&quot;win&quot;</span>))</span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_text(aes(label <span class="op">=</span> <span class="st">&quot;year&quot;</span>))</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-175-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="predicting-1989" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4"><span class="header-section-number">8.2.4</span> Predicting 1989</h3>
<div class="cell">
<div class="sourceCode" id="cb331"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">&#39;year&#39;</span>] <span class="op">==</span> <span class="dv">1990</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year  price  summer  har   sep  win  age
36  1990    NaN    18.7   80  19.3  468    2</code></pre>
</div>
<div class="sourceCode" id="cb333"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">&#39;year&#39;</span>] <span class="op">==</span> <span class="dv">1976</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year  price  summer  har   sep  win  age
22  1976   25.0    17.6  247  16.1  418   16</code></pre>
</div>
</div>
</section>
<section id="training-and-test-data" class="level3" data-number="8.2.5">
<h3 data-number="8.2.5"><span class="header-section-number">8.2.5</span> Training and test data</h3>
<ul>
<li><p>The data for which we <strong>know the target</strong> is called the <strong>training data</strong>.</p></li>
<li><p>The data for which we <strong>don’t know the target</strong> (and want to predict it) is calledthe <strong>test data</strong>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb335"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>known_prices <span class="op">=</span> df[<span class="st">&#39;year&#39;</span>] <span class="op">&lt;</span> <span class="dv">1981</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>to_predict <span class="op">=</span> df[<span class="st">&#39;year&#39;</span>] <span class="op">==</span> <span class="dv">1989</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df[known_prices].copy()</span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df[to_predict].copy()</span></code></pre></div>
</div>
</section>
<section id="specify-steps" class="level3" data-number="8.2.6">
<h3 data-number="8.2.6"><span class="header-section-number">8.2.6</span> Specify steps</h3>
<p>First we make a column transformer…</p>
<div class="cell">
<div class="sourceCode" id="cb336"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>preproc <span class="op">=</span> make_column_transformer(</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;har&#39;</span>, <span class="st">&#39;sep&#39;</span>, <span class="st">&#39;win&#39;</span>,<span class="st">&#39;age&#39;</span>]),</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</section>
<section id="fit-the-preprocesser" class="level3" data-number="8.2.7">
<h3 data-number="8.2.7"><span class="header-section-number">8.2.7</span> Fit the preprocesser</h3>
<p>Then we <strong>fit</strong> it on the <strong>training data</strong></p>
<div class="cell">
<div class="sourceCode" id="cb337"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>preproc.fit(df_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-19 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-19 {
  color: var(--sklearn-color-text);
}

#sk-container-id-19 pre {
  padding: 0;
}

#sk-container-id-19 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-19 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-19 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-19 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-19 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-19 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-19 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-19 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-19 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-19 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-19 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-19 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-19 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-19 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-19 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-19 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-19 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-19 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-19 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-19 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-19 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-19 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-19 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-19 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-19 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-19 div.sk-label label.sk-toggleable__label,
#sk-container-id-19 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-19 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-19 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-19 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-19 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-19 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-19 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-19 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-19 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-19 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-19 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-19 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-19 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-19" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-47" type="checkbox" ><label for="sk-estimator-id-47" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-48" type="checkbox" ><label for="sk-estimator-id-48" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-49" type="checkbox" ><label for="sk-estimator-id-49" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb338"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>preproc.named_transformers_[<span class="st">&#39;standardscaler&#39;</span>].mean_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ 16.47037037, 144.81481481,  17.04814815, 608.40740741,
        25.18518519])</code></pre>
</div>
<div class="sourceCode" id="cb340"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>preproc.named_transformers_[<span class="st">&#39;standardscaler&#39;</span>].var_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([4.09492455e-01, 5.14089163e+03, 1.89286694e+00, 1.60333525e+04,
       6.54842250e+01])</code></pre>
</div>
</div>
</section>
<section id="prep-the-data" class="level3" data-number="8.2.8">
<h3 data-number="8.2.8"><span class="header-section-number">8.2.8</span> Prep the data</h3>
<p>Then we <strong>tranform</strong> the <strong>training data</strong> AND the <strong>test data</strong>:</p>
<div class="cell">
<div class="sourceCode" id="cb342"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>train_new <span class="op">=</span> preproc.transform(df_train)</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>test_new <span class="op">=</span> preproc.transform(df_test)</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>test_new</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[ 3.32798322, -0.87607817,  0.98258257, -1.30629957, -2.74154079]])</code></pre>
</div>
</div>
</section>
<section id="fitting-vs-transforming" class="level3" data-number="8.2.9">
<h3 data-number="8.2.9"><span class="header-section-number">8.2.9</span> Fitting vs transforming</h3>
<p>What if we had fit on the test data?</p>
<div class="cell">
<div class="sourceCode" id="cb344"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>preproc.fit(df_test)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-20 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-20 {
  color: var(--sklearn-color-text);
}

#sk-container-id-20 pre {
  padding: 0;
}

#sk-container-id-20 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-20 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-20 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-20 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-20 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-20 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-20 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-20 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-20 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-20 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-20 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-20 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-20 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-20 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-20 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-20 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-20 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-20 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-20 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-20 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-20 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-20 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-20 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-20 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-20 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-20 div.sk-label label.sk-toggleable__label,
#sk-container-id-20 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-20 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-20 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-20 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-20 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-20 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-20 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-20 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-20 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-20 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-20 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-20 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-20 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-20" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-50" type="checkbox" ><label for="sk-estimator-id-50" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-51" type="checkbox" ><label for="sk-estimator-id-51" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-52" type="checkbox" ><label for="sk-estimator-id-52" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb345"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>preproc.named_transformers_[<span class="st">&#39;standardscaler&#39;</span>].mean_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ 18.6,  82. ,  18.4, 443. ,   3. ])</code></pre>
</div>
<div class="sourceCode" id="cb347"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>preproc.named_transformers_[<span class="st">&#39;standardscaler&#39;</span>].var_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([0., 0., 0., 0., 0.])</code></pre>
</div>
</div>
</section>
<section id="fitting-vs-transforming-1" class="level3" data-number="8.2.10">
<h3 data-number="8.2.10"><span class="header-section-number">8.2.10</span> Fitting vs transforming</h3>
<p>What if we had fit on the test data?</p>
<div class="cell">
<div class="sourceCode" id="cb349"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>preproc.transform(df_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0., 0., 0., 0., 0.]])</code></pre>
</div>
</div>
</section>
<section id="all-together" class="level3" data-number="8.2.11">
<h3 data-number="8.2.11"><span class="header-section-number">8.2.11</span> All together:</h3>
<div class="cell">
<div class="sourceCode" id="cb351"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>preproc <span class="op">=</span> make_column_transformer(</span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;har&#39;</span>, <span class="st">&#39;sep&#39;</span>, <span class="st">&#39;win&#39;</span>,<span class="st">&#39;age&#39;</span>]),</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>preproc.fit(df_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-21 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-21 {
  color: var(--sklearn-color-text);
}

#sk-container-id-21 pre {
  padding: 0;
}

#sk-container-id-21 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-21 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-21 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-21 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-21 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-21 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-21 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-21 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-21 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-21 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-21 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-21 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-21 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-21 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-21 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-21 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-21 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-21 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-21 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-21 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-21 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-21 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-21 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-21 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-21 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-21 div.sk-label label.sk-toggleable__label,
#sk-container-id-21 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-21 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-21 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-21 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-21 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-21 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-21 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-21 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-21 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-21 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-21 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-21 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-21 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-21" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-53" type="checkbox" ><label for="sk-estimator-id-53" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-54" type="checkbox" ><label for="sk-estimator-id-54" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-55" type="checkbox" ><label for="sk-estimator-id-55" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb352"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a>train_new <span class="op">=</span> preproc.transform(df_train)</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>test_new <span class="op">=</span> preproc.transform(df_test)</span></code></pre></div>
</div>
</section>
<section id="find-the-closest-k" class="level3" data-number="8.2.12">
<h3 data-number="8.2.12"><span class="header-section-number">8.2.12</span> Find the closest <em>k</em></h3>
<div class="cell">
<div class="sourceCode" id="cb353"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>pairwise_distances(test_new, train_new)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[6.16457005, 5.74908409, 5.01651675, 5.8002254 , 5.48664619,
        4.35898872, 6.56017889, 5.28491106, 5.38614546, 6.01267804,
        3.72811494, 6.99167472, 5.26008007, 5.3100901 , 5.76468136,
        4.97806644, 4.05228644, 3.86667994, 6.7345252 , 3.18480532,
        4.69099623, 3.65924   , 3.62660714, 5.86910657, 5.30050409,
        4.60719435, 4.34675994]])</code></pre>
</div>
</div>
</section>
<section id="find-the-closest-k-1" class="level3" data-number="8.2.13">
<h3 data-number="8.2.13"><span class="header-section-number">8.2.13</span> Find the closest <em>k</em></h3>
<div class="cell">
<div class="sourceCode" id="cb355"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> pairwise_distances(test_new, train_new)</span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>dists[<span class="dv">0</span>].argsort()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([19, 22, 21, 10, 17, 16, 26,  5, 25, 20, 15,  2, 12,  7, 24, 13,  8,
        4,  1, 14,  3, 23,  9,  0,  6, 18, 11])</code></pre>
</div>
</div>
</section>
<section id="find-the-closest-k-2" class="level3" data-number="8.2.14">
<h3 data-number="8.2.14"><span class="header-section-number">8.2.14</span> Find the closest <em>k</em></h3>
<div class="cell">
<div class="sourceCode" id="cb357"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>ranked_train <span class="op">=</span> df_train.loc[dists[<span class="dv">0</span>].argsort()]</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>ranked_train</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year  price  summer  har   sep  win  age
19  1973   16.0    17.1  123  17.9  376   19
22  1976   25.0    17.6  247  16.1  418   16
21  1975   30.0    16.9  171  17.2  572   17
10  1964   31.0    17.3   96  18.8  402   28
17  1971   27.0    16.8  112  16.9  551   21
16  1970   40.0    16.7   89  18.0  622   22
26  1980   14.0    16.0   74  18.4  578   12
5   1959   66.0    17.5  187  18.7  485   33
25  1979   21.0    16.2  122  17.3  717   13
20  1974   11.0    16.3  184  16.2  574   18
15  1969   12.0    16.5  244  16.6  575   23
2   1955   45.0    17.1  130  16.8  502   37
12  1966   47.0    16.5   86  18.4  819   26
7   1961  100.0    17.3   38  20.4  830   31
24  1978   27.0    15.8   51  17.4  763   14
13  1967   19.0    16.2  118  16.5  714   25
8   1962   33.0    16.3   52  17.2  697   30
4   1958   18.0    16.4  187  19.1  582   34
1   1953   63.0    16.7   80  17.3  690   39
14  1968   11.0    16.2  292  16.4  610   24
3   1957   22.0    16.1  110  16.2  420   35
23  1977   11.0    15.6   87  16.8  821   15
9   1963   17.0    15.7  155  16.2  608   29
0   1952   37.0    17.1  160  14.3  600   40
6   1960   14.0    16.4  290  15.8  763   32
18  1972   10.0    15.0  158  14.6  536   20
11  1965   11.0    15.4  267  14.8  602   27</code></pre>
</div>
</div>
</section>
<section id="predict-from-the-closest-k" class="level3" data-number="8.2.15">
<h3 data-number="8.2.15"><span class="header-section-number">8.2.15</span> Predict from the closest <em>k</em></h3>
<p>If <span class="math inline">\(k = 1\)</span> …</p>
<div class="cell">
<div class="sourceCode" id="cb359"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>ranked_train <span class="op">=</span> df_train.loc[dists[<span class="dv">0</span>].argsort()]</span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>ranked_train.iloc[<span class="dv">0</span>][<span class="st">&#39;price&#39;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>16.0</code></pre>
</div>
</div>
</section>
<section id="predict-from-the-closest-k-1" class="level3" data-number="8.2.16">
<h3 data-number="8.2.16"><span class="header-section-number">8.2.16</span> Predict from the closest <em>k</em></h3>
<p>If <span class="math inline">\(k = 100\)</span> …</p>
<div class="cell">
<div class="sourceCode" id="cb361"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>ranked_train <span class="op">=</span> df_train.loc[dists[<span class="dv">0</span>].argsort()]</span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>ranked_train.iloc[<span class="dv">0</span>:<span class="dv">99</span>][<span class="st">&#39;price&#39;</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>28.814814814814813</code></pre>
</div>
</div>
</section>
<section id="predict-from-the-closest-k-2" class="level3" data-number="8.2.17">
<h3 data-number="8.2.17"><span class="header-section-number">8.2.17</span> Predict from the closest <em>k</em></h3>
<p>If <span class="math inline">\(k = 5\)</span> …</p>
<div class="cell">
<div class="sourceCode" id="cb363"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>ranked_train <span class="op">=</span> df_train.loc[dists[<span class="dv">0</span>].argsort()]</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>ranked_train.iloc[<span class="dv">0</span>:<span class="dv">4</span>][<span class="st">&#39;price&#39;</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>25.5</code></pre>
</div>
</div>
</section>
</section>
<section id="activity-5" class="level2" data-number="8.3">
<h2 data-number="8.3"><span class="header-section-number">8.3</span> Activity</h2>
<section id="activity-1-2" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1"><span class="header-section-number">8.3.1</span> Activity 1</h3>
<p>Find the predicted 1992 price for <em>all</em> the unknown wines, with</p>
<ul>
<li><p><span class="math inline">\(k = 1\)</span></p></li>
<li><p><span class="math inline">\(k = 5\)</span></p></li>
<li><p><span class="math inline">\(k = 10\)</span></p></li>
</ul>
<p>How close was each prediction to the right answer?</p>
<p><em>(Optional hint: Write a function to help you!)</em></p>
</section>
<section id="activity-2-together" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2"><span class="header-section-number">8.3.2</span> Activity 2 (together)</h3>
<p>Find the predicted 1992 price for all the <em>training data</em>, with</p>
<ul>
<li><p><span class="math inline">\(k = 1\)</span></p></li>
<li><p><span class="math inline">\(k = 5\)</span></p></li>
<li><p><span class="math inline">\(k = 10\)</span></p></li>
</ul>
<p>How close was each prediction to the right answer?</p>
<p><em>(Optional hint: Write a function to help you!)</em></p>
</section>
</section>
<section id="k-nearest-neighbors-1" class="level2" data-number="8.4">
<h2 data-number="8.4"><span class="header-section-number">8.4</span> K-Nearest-Neighbors</h2>
<section id="knn" class="level3 smaller" data-number="8.4.1">
<h3 class="smaller" data-number="8.4.1"><span class="header-section-number">8.4.1</span> KNN</h3>
<p>We have existing observations</p>
<p><span class="math display">\[(X_1, y_1), ... (X_n, y_n)\]</span> Where <span class="math inline">\(X_i\)</span> is a set of features, and <span class="math inline">\(y_i\)</span> is a target value.</p>
<p>Given a new observation <span class="math inline">\(X_{new}\)</span>, how do we predict <span class="math inline">\(y_{new}\)</span>?</p>
<ol type="1">
<li><p>Find the <span class="math inline">\(k\)</span> values in <span class="math inline">\((X_1, ..., X_n)\)</span> that are closest to <span class="math inline">\(X_{new}\)</span></p></li>
<li><p>Take the average of the corresponding <span class="math inline">\(y_i\)</span>’s to our five closest <span class="math inline">\(X_i\)</span>’s.</p></li>
<li><p>Predict <span class="math inline">\(\hat{y}_{new}\)</span> = average of these <span class="math inline">\(y_i\)</span>’s</p></li>
</ol>
</section>
<section id="knn-1" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2"><span class="header-section-number">8.4.2</span> KNN</h3>
<p>To perform <strong>K-Nearest-Neighbors</strong>, we choose the <strong>K</strong> closest observations to our <em>target</em>, and we average their <em>response</em> values.</p>
<p>The Big Questions:</p>
<ul>
<li><p>What is our definition of <strong>closest</strong>?</p></li>
<li><p>What number should we use for <strong>K</strong>?</p></li>
<li><p>How do we evaluate the <strong>success</strong> of this approach?</p></li>
</ul>
</section>
<section id="knn-in-sklearn" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3"><span class="header-section-number">8.4.3</span> KNN in sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb365"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a>  preproc,</span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a>  KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a>pipeline</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-22 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-22 {
  color: var(--sklearn-color-text);
}

#sk-container-id-22 pre {
  padding: 0;
}

#sk-container-id-22 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-22 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-22 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-22 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-22 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-22 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-22 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-22 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-22 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-22 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-22 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-22 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-22 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-22 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-22 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-22 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-22 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-22 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-22 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-22 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-22 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-22 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-22 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-22 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-22 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-22 div.sk-label label.sk-toggleable__label,
#sk-container-id-22 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-22 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-22 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-22 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-22 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-22 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-22 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-22 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-22 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-22 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-22 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-22 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-22 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-22" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-56" type="checkbox" ><label for="sk-estimator-id-56" class="sk-toggleable__label  sk-toggleable__label-arrow ">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link " rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link ">i<span>Not fitted</span></span></label><div class="sk-toggleable__content "><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-57" type="checkbox" ><label for="sk-estimator-id-57" class="sk-toggleable__label  sk-toggleable__label-arrow ">&nbsp;columntransformer: ColumnTransformer<a class="sk-estimator-doc-link " rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for columntransformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content "><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-58" type="checkbox" ><label for="sk-estimator-id-58" class="sk-toggleable__label  sk-toggleable__label-arrow ">standardscaler</label><div class="sk-toggleable__content "><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-59" type="checkbox" ><label for="sk-estimator-id-59" class="sk-toggleable__label  sk-toggleable__label-arrow ">&nbsp;StandardScaler<a class="sk-estimator-doc-link " rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content "><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator  sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-60" type="checkbox" ><label for="sk-estimator-id-60" class="sk-toggleable__label  sk-toggleable__label-arrow ">&nbsp;KNeighborsRegressor<a class="sk-estimator-doc-link " rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a></label><div class="sk-toggleable__content "><pre>KNeighborsRegressor()</pre></div> </div></div></div></div></div></div>
</div>
</div>
</section>
<section id="knn-in-sklearn-1" class="level3" data-number="8.4.4">
<h3 data-number="8.4.4"><span class="header-section-number">8.4.4</span> KNN in sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb366"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>pipeline.fit(y <span class="op">=</span> df_train[<span class="st">&#39;price&#39;</span>], X <span class="op">=</span> df_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-23 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-23 {
  color: var(--sklearn-color-text);
}

#sk-container-id-23 pre {
  padding: 0;
}

#sk-container-id-23 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-23 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-23 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-23 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-23 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-23 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-23 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-23 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-23 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-23 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-23 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-23 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-23 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-23 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-23 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-23 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-23 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-23 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-23 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-23 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-23 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-23 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-23 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-23 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-23 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-23 div.sk-label label.sk-toggleable__label,
#sk-container-id-23 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-23 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-23 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-23 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-23 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-23 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-23 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-23 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-23 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-23 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-23 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-23 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-23 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-23" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-61" type="checkbox" ><label for="sk-estimator-id-61" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-62" type="checkbox" ><label for="sk-estimator-id-62" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;columntransformer: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for columntransformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-63" type="checkbox" ><label for="sk-estimator-id-63" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-64" type="checkbox" ><label for="sk-estimator-id-64" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-65" type="checkbox" ><label for="sk-estimator-id-65" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsRegressor<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsRegressor()</pre></div> </div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb367"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>pipeline.predict(X<span class="op">=</span>df_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([25.8])</code></pre>
</div>
</div>
</section>
<section id="activity-2-2" class="level3" data-number="8.4.5">
<h3 data-number="8.4.5"><span class="header-section-number">8.4.5</span> Activity 2</h3>
<p>Find the predicted 1992 price for <em>all wines</em>, with</p>
<ul>
<li><p><span class="math inline">\(k = 1\)</span></p></li>
<li><p><span class="math inline">\(k = 5\)</span></p></li>
<li><p><span class="math inline">\(k = 10\)</span></p></li>
</ul>
<p>How close was each prediction to the right answer?</p>
</section>
</section>
<section id="modeling-and-machine-learning" class="level1 lectitle" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Modeling and Machine Learning</h1>
<p><a href="slides-09-modeling.html">Slides</a></p>
</section>
<section id="the-story-so-far-6" class="level2" data-number="9.1">
<h2 data-number="9.1"><span class="header-section-number">9.1</span> The story so far</h2>
<section id="steps-for-data-analysis-1" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1"><span class="header-section-number">9.1.1</span> Steps for data analysis</h3>
<ul>
<li><strong>Read</strong> and then <strong>clean</strong> the data
<ul>
<li>Are there missing values? Will we drop those rows, or replace the missing values with something?</li>
<li>Are there <em>quantitative</em> variables that python thinks are <em>categorical</em>?</li>
<li>Are there <em>categorical</em> variables that python thinks are <em>quantitative</em>?</li>
<li>Are there any <em>anomalies</em> in the data that concern you?</li>
</ul></li>
</ul>
</section>
<section id="steps-for-data-analysis-contd-2" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2"><span class="header-section-number">9.1.2</span> Steps for data analysis (cont’d)</h3>
<ul>
<li><strong>Explore</strong> the data by <strong>visualizing</strong> and <strong>summarizing</strong>.
<ul>
<li>Different approaches for different combos of <em>quantitative</em> and <em>categorical</em> variables</li>
<li>Think about <em>conditional</em> calculations (split-apply-combine)</li>
</ul></li>
</ul>
</section>
<section id="steps-for-data-analysis-contd-3" class="level3" data-number="9.1.3">
<h3 data-number="9.1.3"><span class="header-section-number">9.1.3</span> Steps for data analysis (cont’d)</h3>
<ul>
<li><p>Identify a <strong>research question</strong> of interest.</p></li>
<li><p>Perform <strong>preprocessing</strong> steps</p>
<ul>
<li>Should we <em>scale</em> the quantitative variables?</li>
<li>Should we <em>one-hot-encode</em> the categorical variables?</li>
<li>Should we <em>log-transform</em> any variables?</li>
</ul></li>
<li><p>Measure similarity between <strong>observations</strong> by calculating <strong>distances</strong>.</p>
<ul>
<li>Which <em>features</em> should be included?</li>
<li>Which <em>distance metric</em> should we use?</li>
</ul></li>
</ul>
</section>
</section>
<section id="machine-learning-and-statistical-modeling" class="level2" data-number="9.2">
<h2 data-number="9.2"><span class="header-section-number">9.2</span> Machine Learning and Statistical Modeling</h2>
<section id="modeling" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1"><span class="header-section-number">9.2.1</span> Modeling</h3>
<p>Every analysis we will do assumes a structure like:</p>
<div style="font-size: 150%;">
<p>(<strong>output</strong>) = f(<strong>input</strong>) + (noise)</p>
</div>
<p>… or, if you prefer…</p>
<div style="font-size: 150%;">
<p>(<strong>target</strong>) = f(<strong>predictors</strong>) + (noise)</p>
</div>
</section>
<section id="generative-process" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2"><span class="header-section-number">9.2.2</span> Generative process</h3>
<p>In any case: we are trying to reconstruct information in <strong>data</strong>, and we are hindered by <strong>random noise</strong>.</p>
<p>The function <span class="math inline">\(f\)</span> might be very simple…</p>
<p><span class="math display">\[y_i = \mu + \epsilon_i\]</span></p>
<p>“A person’s height is the true average height of people in the world, plus some randomness.”</p>
</section>
<section id="generative-process-1" class="level3" data-number="9.2.3">
<h3 data-number="9.2.3"><span class="header-section-number">9.2.3</span> Generative process</h3>
<p>… or more complex…</p>
<p><span class="math display">\[y_i = 0.5*x_{1i} + 0.5*x_{2i} + \epsilon_i\]</span></p>
<p>“A person’s height is equal to the average of their biological mother’s height and biological father’s height, plus some randomness”</p>
<ul>
<li>Do you think there is “more randomness” in the first function or this one?</li>
</ul>
</section>
<section id="generative-process-2" class="level3" data-number="9.2.4">
<h3 data-number="9.2.4"><span class="header-section-number">9.2.4</span> Generative process</h3>
<p>… or extremely, ridiculously complex…</p>
<p><img src="./images/complex_function.png" class="img-fluid" /></p>
</section>
<section id="generative-process-3" class="level3" data-number="9.2.5">
<h3 data-number="9.2.5"><span class="header-section-number">9.2.5</span> Generative process</h3>
<p>… and it doesn’t have to be a <em>mathematical</em> function at all; just a procedure:</p>
<p><span class="math display">\[y_i = \text{(average of heights of 5 people with most similar weights)} + \epsilon_i\]</span></p>
</section>
<section id="modeling-1" class="level3" data-number="9.2.6">
<h3 data-number="9.2.6"><span class="header-section-number">9.2.6</span> Modeling</h3>
<ul>
<li><p>Our goal is to <strong>reconstruct</strong> or <strong>estimate</strong> or <strong>approximate</strong> the function/process <span class="math inline">\(f\)</span> based on <strong>training data</strong>.</p></li>
<li><p>For example: Instead of the 5 most similar weights <em>in the whole world</em>, we can estimate with the 5 most similar weights <em>in our training set</em>.</p></li>
<li><p>Instead of committing to one <span class="math inline">\(f\)</span> to estimate, we might propose <strong>many</strong> options and see which one “leaves behind” the least randomness.</p></li>
</ul>
</section>
</section>
<section id="data-wine-price-prediction" class="level2" data-number="9.3">
<h2 data-number="9.3"><span class="header-section-number">9.3</span> Data: Wine price prediction</h2>
<section id="setup" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1"><span class="header-section-number">9.3.1</span> Setup</h3>
<div class="cell">
<div class="sourceCode" id="cb369"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://dlsun.github.io/pods/data/bordeaux.csv&quot;</span>,</span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a>                 index_col<span class="op">=</span><span class="st">&quot;year&quot;</span>)</span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df.loc[:<span class="dv">1980</span>].copy()</span>
<span id="cb369-13"><a href="#cb369-13" aria-hidden="true" tabindex="-1"></a>df_unknown <span class="op">=</span> df.loc[<span class="dv">1981</span>:].copy()</span></code></pre></div>
</div>
</section>
<section id="knn-revisited" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2"><span class="header-section-number">9.3.2</span> KNN revisited</h3>
<div class="cell">
<div class="sourceCode" id="cb370"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;har&#39;</span>, <span class="st">&#39;sep&#39;</span>, <span class="st">&#39;win&#39;</span>, <span class="st">&#39;age&#39;</span>]),</span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb370-8"><a href="#cb370-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb370-9"><a href="#cb370-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-10"><a href="#cb370-10" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb370-11"><a href="#cb370-11" aria-hidden="true" tabindex="-1"></a>          ct,</span>
<span id="cb370-12"><a href="#cb370-12" aria-hidden="true" tabindex="-1"></a>          KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">5</span>))</span>
<span id="cb370-13"><a href="#cb370-13" aria-hidden="true" tabindex="-1"></a>pipeline.fit(X<span class="op">=</span>df_train, y<span class="op">=</span>df_train[<span class="st">&#39;price&#39;</span>])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-24 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-24 {
  color: var(--sklearn-color-text);
}

#sk-container-id-24 pre {
  padding: 0;
}

#sk-container-id-24 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-24 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-24 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-24 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-24 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-24 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-24 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-24 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-24 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-24 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-24 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-24 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-24 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-24 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-24 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-24 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-24 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-24 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-24 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-24 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-24 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-24 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-24 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-24 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-24 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-24 div.sk-label label.sk-toggleable__label,
#sk-container-id-24 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-24 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-24 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-24 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-24 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-24 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-24 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-24 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-24 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-24 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-24 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-24 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-24 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-24" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-66" type="checkbox" ><label for="sk-estimator-id-66" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-67" type="checkbox" ><label for="sk-estimator-id-67" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;columntransformer: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for columntransformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-68" type="checkbox" ><label for="sk-estimator-id-68" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-69" type="checkbox" ><label for="sk-estimator-id-69" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-70" type="checkbox" ><label for="sk-estimator-id-70" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsRegressor<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsRegressor()</pre></div> </div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb371"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>pipeline.predict(X<span class="op">=</span>df_unknown)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([25.4, 26.4, 33. , 20.6, 29.8, 20.6, 25.4, 22.6, 25.8, 25.8, 24.2])</code></pre>
</div>
</div>
</section>
<section id="measuring-error" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3"><span class="header-section-number">9.3.3</span> Measuring error</h3>
<p>The most common way to measure “leftover noise” is the <strong>sum of squared error</strong> or equivalently, the <strong>mean squared error</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb373"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a>pred_y_train <span class="op">=</span> pipeline.predict(X<span class="op">=</span>df_train)</span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;real_prices&quot;</span>: df_train[<span class="st">&#39;price&#39;</span>],</span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;predicted_prices&quot;</span>: pred_y_train,</span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb373-6"><a href="#cb373-6" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&quot;error&quot;</span>] <span class="op">=</span> results[<span class="st">&quot;predicted_prices&quot;</span>] <span class="op">-</span> results[<span class="st">&quot;real_prices&quot;</span>]</span>
<span id="cb373-7"><a href="#cb373-7" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&quot;squared error&quot;</span>]<span class="op">=</span> (results[<span class="st">&quot;error&quot;</span>])<span class="op">**</span><span class="dv">2</span></span>
<span id="cb373-8"><a href="#cb373-8" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      real_prices  predicted_prices  error  squared error
year                                                     
1952         37.0              36.2   -0.8           0.64
1953         63.0              41.4  -21.6         466.56
1955         45.0              46.6    1.6           2.56
1957         22.0              28.8    6.8          46.24
1958         18.0              46.4   28.4         806.56
1959         66.0              35.2  -30.8         948.64
1960         14.0              13.0   -1.0           1.00
1961        100.0              56.6  -43.4        1883.56
1962         33.0              40.4    7.4          54.76
1963         17.0              16.0   -1.0           1.00
1964         31.0              37.0    6.0          36.00
1965         11.0              12.2    1.2           1.44
1966         47.0              32.0  -15.0         225.00
1967         19.0              26.0    7.0          49.00
1968         11.0              11.8    0.8           0.64
1969         12.0              18.2    6.2          38.44
1970         40.0              29.8  -10.2         104.04
1971         27.0              24.8   -2.2           4.84
1972         10.0              13.6    3.6          12.96
1973         16.0              28.8   12.8         163.84
1974         11.0              19.8    8.8          77.44
1975         30.0              24.0   -6.0          36.00
1976         25.0              18.8   -6.2          38.44
1977         11.0              25.0   14.0         196.00
1978         27.0              18.4   -8.6          73.96
1979         21.0              18.4   -2.6           6.76
1980         14.0              25.8   11.8         139.24</code></pre>
</div>
</div>
</section>
<section id="measuring-error-1" class="level3" data-number="9.3.4">
<h3 data-number="9.3.4"><span class="header-section-number">9.3.4</span> Measuring error</h3>
<p>The most common way to measure “leftover noise” is the <strong>sum of squared error</strong> or equivalently, the <strong>mean squared error</strong></p>
<div class="cell">
<div class="sourceCode" id="cb375"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>results[<span class="st">&quot;squared error&quot;</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>200.57629629629628</code></pre>
</div>
</div>
</section>
<section id="best-k" class="level3" data-number="9.3.5">
<h3 data-number="9.3.5"><span class="header-section-number">9.3.5</span> Best K</h3>
<p>Now let’s try it for some different values of <span class="math inline">\(k\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb377"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>]:</span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>    ct,</span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(n_neighbors<span class="op">=</span>k))</span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>df_train, y<span class="op">=</span>df_train[<span class="st">&#39;price&#39;</span>])</span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a>  pred_y_train <span class="op">=</span> pipeline.predict(X<span class="op">=</span>df_train)</span>
<span id="cb377-8"><a href="#cb377-8" aria-hidden="true" tabindex="-1"></a>  ((df_train[<span class="st">&#39;price&#39;</span>] <span class="op">-</span> pred_y_train)<span class="op">**</span><span class="dv">2</span>).mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0
123.2304526748971
200.57629629629628
241.37518518518516
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/threadpoolctl.py:1019: RuntimeWarning: libc not found. The ctypes module in Python 3.12 is maybe too old for this OS.
378.9575703703703</code></pre>
</div>
</div>
</section>
<section id="training-error-vs-test-error" class="level3" data-number="9.3.6">
<h3 data-number="9.3.6"><span class="header-section-number">9.3.6</span> Training error vs test error</h3>
<ul>
<li><p>Oh no! Why did we get an error of 0 for <span class="math inline">\(k = 1\)</span>?</p></li>
<li><p>Because the closest wine in the training set is… itself.</p></li>
<li><p>So, our problem is:</p>
<ul>
<li>If we predict on the <strong>new data</strong>, we don’t know the <strong>true prices</strong> and we can’t <strong>evaluate</strong> our models</li>
<li>If we predict on the <strong>training data</strong>, we are “cheating”, because we are using the data to both <strong>train</strong> and <strong>test</strong>.</li>
</ul></li>
<li><p>Solution: Let’s make a pretend <strong>test data</strong> set!</p></li>
</ul>
</section>
<section id="testtraining-split" class="level3" data-number="9.3.7">
<h3 data-number="9.3.7"><span class="header-section-number">9.3.7</span> Test/Training split</h3>
<div class="cell">
<div class="sourceCode" id="cb379"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df.loc[:<span class="dv">1970</span>].copy()</span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df.loc[<span class="dv">1971</span>:<span class="dv">1980</span>].copy()</span></code></pre></div>
</div>
<ul>
<li><p>We will <strong>train</strong> on the years up to 1970</p></li>
<li><p>We will <strong>test</strong> on the years 1971 to 1980</p></li>
<li><p>We will <strong>evaluate</strong> based on model performance on the <strong>test data</strong>.</p></li>
</ul>
</section>
<section id="try-again-best-k" class="level3" data-number="9.3.8">
<h3 data-number="9.3.8"><span class="header-section-number">9.3.8</span> Try again: Best K</h3>
<div class="cell">
<div class="sourceCode" id="cb380"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">15</span>):</span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>    ct,</span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(n_neighbors<span class="op">=</span>k))</span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>df_train, y<span class="op">=</span>df_train[<span class="st">&#39;price&#39;</span>])</span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a>  pred_y_test <span class="op">=</span> pipeline.predict(X<span class="op">=</span>df_test)</span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a>  ((df_test[<span class="st">&#39;price&#39;</span>] <span class="op">-</span> pred_y_test)<span class="op">**</span><span class="dv">2</span>).mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>183.0
139.85
123.78888888888892
159.34375
121.81199999999998
83.28333333333333
86.08163265306123
86.465625
73.12839506172841
72.263
89.03801652892564
133.99791666666667
162.23136094674555
169.534693877551</code></pre>
</div>
</div>
</section>
<section id="tuning" class="level3" data-number="9.3.9">
<h3 data-number="9.3.9"><span class="header-section-number">9.3.9</span> Tuning</h3>
<ul>
<li><p>Here we tried the same <strong>type</strong> of model (KNN) each time.</p></li>
<li><p>But we tried different <strong>models</strong> because we used different values of <span class="math inline">\(k\)</span></p></li>
<li><p>This is called <strong>tuning</strong></p></li>
</ul>
</section>
<section id="activity-6" class="level3" data-number="9.3.10">
<h3 data-number="9.3.10"><span class="header-section-number">9.3.10</span> Activity</h3>
<p>Perform tuning for a KNN model, but with <strong>all possible values of k</strong>.</p>
<p>Do this for three <em>recipes</em> or <em>column transformers</em>:</p>
<ol type="1">
<li><p>Using all predictors.</p></li>
<li><p>Using just winter rainfall and summer temperature.</p></li>
<li><p>Using only age.</p></li>
</ol>
<p>Which of the many model options performed best?</p>
<div class="cell">
<div class="sourceCode" id="cb382"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>ct2 <span class="op">=</span> make_column_transformer(</span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;win&#39;</span>]),</span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>ct3 <span class="op">=</span> make_column_transformer(</span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;age&#39;</span>]),</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb382-10"><a href="#cb382-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">17</span>):</span>
<span id="cb382-11"><a href="#cb382-11" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb382-12"><a href="#cb382-12" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb382-13"><a href="#cb382-13" aria-hidden="true" tabindex="-1"></a>    ct,</span>
<span id="cb382-14"><a href="#cb382-14" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(n_neighbors<span class="op">=</span>k))</span>
<span id="cb382-15"><a href="#cb382-15" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>df_train, y<span class="op">=</span>df_train[<span class="st">&#39;price&#39;</span>])</span>
<span id="cb382-16"><a href="#cb382-16" aria-hidden="true" tabindex="-1"></a>  pred_y_test <span class="op">=</span> pipeline.predict(X<span class="op">=</span>df_test)</span>
<span id="cb382-17"><a href="#cb382-17" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="bu">str</span>(k) <span class="op">+</span> <span class="st">&quot;:&quot;</span> <span class="op">+</span> <span class="bu">str</span>(((df_test[<span class="st">&#39;price&#39;</span>] <span class="op">-</span> pred_y_test)<span class="op">**</span><span class="dv">2</span>).mean()))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1:183.0
2:139.85
3:123.78888888888892
4:159.34375
5:121.81199999999998
6:83.28333333333333
7:86.08163265306123
8:86.465625
9:73.12839506172841
10:72.263
11:89.03801652892564
12:133.99791666666667
13:162.23136094674555
14:169.534693877551
15:206.76533333333336
16:241.360546875</code></pre>
</div>
<div class="sourceCode" id="cb384"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">17</span>):</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a>    ct2,</span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(n_neighbors<span class="op">=</span>k))</span>
<span id="cb384-7"><a href="#cb384-7" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>df_train, y<span class="op">=</span>df_train[<span class="st">&#39;price&#39;</span>])</span>
<span id="cb384-8"><a href="#cb384-8" aria-hidden="true" tabindex="-1"></a>  pred_y_test <span class="op">=</span> pipeline.predict(X<span class="op">=</span>df_test)</span>
<span id="cb384-9"><a href="#cb384-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="bu">str</span>(k) <span class="op">+</span> <span class="st">&quot;:&quot;</span> <span class="op">+</span> <span class="bu">str</span>(((df_test[<span class="st">&#39;price&#39;</span>] <span class="op">-</span> pred_y_test)<span class="op">**</span><span class="dv">2</span>).mean()))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1:72.6
2:119.4
3:194.75555555555562
4:152.2625
5:139.872
6:111.28888888888889
7:84.07959183673469
8:121.9125
9:116.60864197530864
10:131.34500000000003
11:133.9727272727273
12:166.10208333333335
13:174.92840236686388
14:175.6841836734694
15:183.08577777777776
16:241.382421875</code></pre>
</div>
<div class="sourceCode" id="cb386"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">17</span>):</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>    ct3,</span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(n_neighbors<span class="op">=</span>k))</span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>df_train, y<span class="op">=</span>df_train[<span class="st">&#39;price&#39;</span>])</span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a>  pred_y_test <span class="op">=</span> pipeline.predict(X<span class="op">=</span>df_test)</span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="bu">str</span>(k) <span class="op">+</span> <span class="st">&quot;:&quot;</span> <span class="op">+</span> <span class="bu">str</span>(((df_test[<span class="st">&#39;price&#39;</span>] <span class="op">-</span> pred_y_test)<span class="op">**</span><span class="dv">2</span>).mean()))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1:485.8
2:99.4
3:56.4
4:54.85
5:96.72
6:70.24444444444444
7:80.49795918367344
8:71.65
9:81.84197530864199
10:219.57000000000002
11:179.82479338842973
12:255.27361111111105
13:222.9609467455622
14:204.45
15:227.39999999999995
16:281.54765625</code></pre>
</div>
</div>
</section>
<section id="things-to-think-about" class="level3 smaller" data-number="9.3.11">
<h3 class="smaller" data-number="9.3.11"><span class="header-section-number">9.3.11</span> Things to think about</h3>
<ul>
<li><p>What other <strong>types of models</strong> could we have tried?</p></li>
<li><p><em>Linear regression</em>, <em>decision tree</em>, <em>neural network</em>, …</p></li>
<li><p>What other <strong>column transformers</strong> could we have tried?</p></li>
<li><p><em>Different combinations of variables, different standardizing, log transforming…</em></p></li>
<li><p>What if we measure <strong>error</strong> differently?</p></li>
<li><p><em>Mean absolute error</em>, <em>log-error</em>, <em>percent error</em>, …</p></li>
<li><p>What if we had used a <strong>different test set</strong>?</p></li>
<li><p><em>Coming soon: Cross-validation</em></p></li>
<li><p>What if our target variable was <strong>categorical</strong>?</p></li>
</ul>
</section>
</section>
<section id="modeling-general-procedure" class="level2" data-number="9.4">
<h2 data-number="9.4"><span class="header-section-number">9.4</span> Modeling: General Procedure</h2>
<section id="modeling-2" class="level3 smaller" data-number="9.4.1">
<h3 class="smaller" data-number="9.4.1"><span class="header-section-number">9.4.1</span> Modeling</h3>
<p>We apply the process:</p>
<p><u>For each model proposed: </u></p>
<ul>
<li><p>Establish a <strong>pipeline</strong> with <strong>transformers</strong> and a <strong>model</strong>.</p></li>
<li><p><strong>Fit</strong> the pipeline on the <strong>training data</strong> (with known outcome)</p></li>
<li><p><strong>Predict</strong> with the fitted pipeline on <strong>test data</strong> (with known outcome)</p></li>
<li><p><strong>Evaluate</strong> our success; i.e., measure noise “left over”</p></li>
</ul>
<p><u>Then: </u></p>
<ul>
<li><p><strong>Select</strong> the best model</p></li>
<li><p><strong>Fit</strong> on <em>all</em> the data</p></li>
<li><p><strong>Predict</strong> on any future data (with unknown outcome)</p></li>
</ul>
</section>
<section id="big-decisions" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2"><span class="header-section-number">9.4.2</span> Big decisions</h3>
<ul>
<li><p>Which models to try</p></li>
<li><p>Which column transformers to try</p></li>
<li><p>How much to tune</p></li>
<li><p>How to measure “success” of a model</p></li>
</ul>
</section>
</section>
<section id="regression-and-cross-validation" class="level1 lectitle" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Regression and Cross-Validation</h1>
<p><a href="slides-10-cross_val.html">Slides</a></p>
</section>
<section id="the-story-so-far-7" class="level2" data-number="10.1">
<h2 data-number="10.1"><span class="header-section-number">10.1</span> The story so far</h2>
<section id="modeling-3" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1"><span class="header-section-number">10.1.1</span> Modeling</h3>
<p>We assume some process <span class="math inline">\(f\)</span> is <em>generating</em> our target variable:</p>
<div style="font-size: 150%;">
<p>(<strong>target</strong>) = f(<strong>predictors</strong>) + (noise)</p>
</div>
<p>Our goal is to come up with an approximation of <span class="math inline">\(f\)</span>.</p>
</section>
<section id="test-error-vs-training-error" class="level3 smaller" data-number="10.1.2">
<h3 class="smaller" data-number="10.1.2"><span class="header-section-number">10.1.2</span> Test error vs training error</h3>
<ul>
<li><p>We don’t need to know how well our model does on <em>training data</em>.</p></li>
<li><p>We want to know how well it will do on <em>test data</em>.</p></li>
<li><p>In general, test error <span class="math inline">\(&gt;\)</span> training error.</p></li>
</ul>
<blockquote>
<p>Analogy: A professor posts a practice exam before an exam.</p>
</blockquote>
<blockquote>
<ul>
<li>If the actual exam is the same as the practice exam, how many points will students miss? That’s training error.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>If the actual exam is different from the practice exam, how many points will students miss? That’s test error.</li>
</ul>
</blockquote>
<blockquote>
<p>It’s always easier to answer questions that you’ve seen before than questions you haven’t seen.</p>
</blockquote>
</section>
<section id="modeling-procedure" class="level3 smaller" data-number="10.1.3">
<h3 class="smaller" data-number="10.1.3"><span class="header-section-number">10.1.3</span> Modeling Procedure</h3>
<p>We apply the process:</p>
<p><u>For each model proposed: </u></p>
<ul>
<li><p>Establish a <strong>pipeline</strong> with <strong>transformers</strong> and a <strong>model</strong>.</p></li>
<li><p><strong>Fit</strong> the pipeline on the <strong>training data</strong> (with known outcome)</p></li>
<li><p><strong>Predict</strong> with the fitted pipeline on <strong>test data</strong> (with known outcome)</p></li>
<li><p><strong>Evaluate</strong> our success; i.e., measure noise “left over”</p></li>
</ul>
<p><u>Then: </u></p>
<ul>
<li><p><strong>Select</strong> the best model</p></li>
<li><p><strong>Fit</strong> on <em>all</em> the data</p></li>
<li><p><strong>Predict</strong> on any future data (with unknown outcome)</p></li>
</ul>
</section>
</section>
<section id="linear-regression" class="level2" data-number="10.2">
<h2 data-number="10.2"><span class="header-section-number">10.2</span> Linear Regression</h2>
<section id="simple-linear-model" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1"><span class="header-section-number">10.2.1</span> Simple Linear Model</h3>
<p>We assume that the target (<span class="math inline">\(Y\)</span>) is generated from <strong>an equation</strong> of the predictor (<span class="math inline">\(X\)</span>), plus random noise (<span class="math inline">\(\epsilon\)</span>)</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X + \epsilon\]</span></p>
<p>Goal: Use observations <span class="math inline">\((x_1, y_1), ..., (x_n, y_n)\)</span> to estimate <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</p>
</section>
<section id="measures-of-success" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2"><span class="header-section-number">10.2.2</span> Measures of success</h3>
<p>What is the “best” choice of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>?</p>
<ul>
<li><p>The ones that are <strong>statistically most justified</strong>, under certain assumptions about <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>?</p></li>
<li><p>The ones that are “closest to” the observed points?</p>
<ul>
<li><span class="math inline">\(|\hat{y}_i - y_i|\)</span>?</li>
<li><span class="math inline">\((\hat{y}_i - y_i)^2\)</span>?</li>
<li><span class="math inline">\((\hat{y}_i - y_i)^4\)</span>?</li>
</ul></li>
</ul>
</section>
<section id="example-wine-data" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3"><span class="header-section-number">10.2.3</span> Example: Wine data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb388"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://dlsun.github.io/pods/data/bordeaux.csv&quot;</span>,</span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>                 index_col<span class="op">=</span><span class="st">&quot;year&quot;</span>)</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>df_known <span class="op">=</span> df.loc[:<span class="dv">1980</span>].copy()</span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>df_unknown <span class="op">=</span> df.loc[<span class="dv">1981</span>:].copy()</span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a>(ggplot(df_known, aes(x <span class="op">=</span> <span class="st">&quot;age&quot;</span>, y <span class="op">=</span> <span class="st">&quot;price&quot;</span>)) </span>
<span id="cb388-8"><a href="#cb388-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-206-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="candidate-lines" class="level3" data-number="10.2.4">
<h3 data-number="10.2.4"><span class="header-section-number">10.2.4</span> “Candidate” lines</h3>
<p>Condsider five possible regression equations:</p>
<p><span class="math display">\[\text{price} = 25 + 0*\text{age}\]</span> <span class="math display">\[\text{price} = 0 + 10*\text{age}\]</span> <span class="math display">\[\text{price} = 20 + 1*\text{age}\]</span> <span class="math display">\[\text{price} = -40 + 3*\text{age}\]</span></p>
<p>Which one do you think will be “closest” to the points on the scatterplot?</p>
</section>
<section id="candidate-lines-1" class="level3" data-number="10.2.5">
<h3 data-number="10.2.5"><span class="header-section-number">10.2.5</span> “Candidate” lines</h3>
<div class="cell">
<div class="sourceCode" id="cb390"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_known, aes(x <span class="op">=</span> <span class="st">&quot;age&quot;</span>, y <span class="op">=</span> <span class="st">&quot;price&quot;</span>)) </span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point()</span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_abline(intercept <span class="op">=</span> <span class="dv">25</span>, slope <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_abline(intercept <span class="op">=</span> <span class="dv">20</span>, slope <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_abline(intercept <span class="op">=</span> <span class="op">-</span><span class="dv">40</span>, slope <span class="op">=</span> <span class="dv">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-207-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="the-best-slope-and-intercept" class="level3" data-number="10.2.6">
<h3 data-number="10.2.6"><span class="header-section-number">10.2.6</span> The “best” slope and intercept</h3>
<ul>
<li><p>It’s clear that some of these lines are better than others.</p></li>
<li><p>How to choose the best? <strong>Math</strong></p></li>
<li><p>We’ll let the computer do it for us.</p></li>
<li><p><strong>Important:</strong> The slope and intercept are calculated from the <strong>training data</strong> at the <code>.fit()</code> step.</p></li>
</ul>
</section>
<section id="linear-regression-in-sklearn" class="level3" data-number="10.2.7">
<h3 data-number="10.2.7"><span class="header-section-number">10.2.7</span> Linear Regression in <code>sklearn</code></h3>
<div class="cell">
<div class="sourceCode" id="cb392"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>    LinearRegression())</span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>pipeline.fit(X<span class="op">=</span>df_known[[<span class="st">&#39;age&#39;</span>]], y<span class="op">=</span>df_known[<span class="st">&#39;price&#39;</span>])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-25 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-25 {
  color: var(--sklearn-color-text);
}

#sk-container-id-25 pre {
  padding: 0;
}

#sk-container-id-25 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-25 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-25 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-25 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-25 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-25 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-25 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-25 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-25 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-25 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-25 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-25 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-25 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-25 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-25 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-25 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-25 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-25 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-25 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-25 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-25 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-25 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-25 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-25 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-25 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-25 div.sk-label label.sk-toggleable__label,
#sk-container-id-25 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-25 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-25 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-25 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-25 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-25 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-25 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-25 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-25 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-25 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-25 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-25 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-25 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-25" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;linearregression&#x27;, LinearRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-71" type="checkbox" ><label for="sk-estimator-id-71" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;linearregression&#x27;, LinearRegression())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-72" type="checkbox" ><label for="sk-estimator-id-72" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LinearRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div></div></div></div>
</div>
<div class="sourceCode" id="cb393"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a>pipeline.named_steps[<span class="st">&#39;linearregression&#39;</span>].intercept_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.2997193011856538</code></pre>
</div>
<div class="sourceCode" id="cb395"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>pipeline.named_steps[<span class="st">&#39;linearregression&#39;</span>].coef_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([1.15601827])</code></pre>
</div>
</div>
</section>
<section id="fitting-and-predicting" class="level3" data-number="10.2.8">
<h3 data-number="10.2.8"><span class="header-section-number">10.2.8</span> Fitting and predicting</h3>
<p>To <strong>predict</strong> from a linear regression, we just plug in the values to the equation…</p>
<div class="cell">
<div class="sourceCode" id="cb397"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="fl">0.3</span> <span class="op">+</span> <span class="fl">1.16</span><span class="op">*</span>df_unknown[<span class="st">&quot;age&quot;</span>] </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>year
1981    12.46
1982    11.30
1983    10.14
1984     8.98
1985     7.82
1986     6.66
1987     5.50
1988     4.34
1989     3.18
1990     2.02
1991     0.86
Name: age, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="fitting-and-predicting-1" class="level3" data-number="10.2.9">
<h3 data-number="10.2.9"><span class="header-section-number">10.2.9</span> Fitting and predicting</h3>
<p>To <strong>predict</strong> from a linear regression, we just plug in the values to the equation…</p>
<div class="cell">
<div class="sourceCode" id="cb399"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>pipeline.predict(df_unknown[[<span class="st">&#39;age&#39;</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([12.41648163, 11.26046336, 10.1044451 ,  8.94842683,  7.79240856,
        6.6363903 ,  5.48037203,  4.32435376,  3.1683355 ,  2.01231723,
        0.85629897])</code></pre>
</div>
</div>
</section>
<section id="questions-to-ask-yourself" class="level3 smaller" data-number="10.2.10">
<h3 class="smaller" data-number="10.2.10"><span class="header-section-number">10.2.10</span> Questions to ask yourself</h3>
<ul>
<li><p><strong>Q:</strong> Is there only one “best” regression line?</p></li>
<li><p><strong>A:</strong> No, you can justify many choices of slope and intercept! But there is a generally accepted approach called <strong>Least Squares Regression</strong> that we will always use.</p></li>
<li><p><strong>Q:</strong> How do you know which <em>variables</em> to include in the equation?</p></li>
<li><p><strong>A:</strong> Try them all, and see what predicts best.</p></li>
<li><p><strong>Q:</strong> How do you know whether to use <em>linear regression</em> or <em>KNN</em> to predict?</p></li>
<li><p><strong>A:</strong> Try them both, and see what predicts best</p></li>
</ul>
</section>
</section>
<section id="cross-validation" class="level2" data-number="10.3">
<h2 data-number="10.3"><span class="header-section-number">10.3</span> Cross-Validation</h2>
<section id="resampling-methods" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1"><span class="header-section-number">10.3.1</span> Resampling methods</h3>
<ul>
<li><p>We saw that a “fair” way to evaluate models was to <strong>randomly split</strong> into <strong>training</strong> and <strong>test</strong> sets.</p></li>
<li><p>But what if this <strong>randomness</strong> was misleading? <em>(e.g., a major outlier in one of the sets)</em></p></li>
<li><p>What do we usually do in statistics to address randomness? Take <strong>many samples</strong> and compute an <strong>average</strong>!</p></li>
<li><p>A <strong>resampling method</strong> is when we take <em>many</em> random test/training splits and <em>average</em> the resulting metrics.</p></li>
</ul>
</section>
<section id="resampling-method-example" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2"><span class="header-section-number">10.3.2</span> Resampling method example</h3>
<p>Import all our functions:</p>
<div class="cell">
<div class="sourceCode" id="cb401"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span></code></pre></div>
</div>
</section>
<section id="resampling-method-example-1" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3"><span class="header-section-number">10.3.3</span> Resampling method example</h3>
<div class="cell">
<div class="sourceCode" id="cb402"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(df_known, df_known[<span class="st">&#39;price&#39;</span>], test_size <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;har&#39;</span>, <span class="st">&#39;sep&#39;</span>, <span class="st">&#39;win&#39;</span>, <span class="st">&#39;age&#39;</span>]),</span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb402-9"><a href="#cb402-9" aria-hidden="true" tabindex="-1"></a>    ct,</span>
<span id="cb402-10"><a href="#cb402-10" aria-hidden="true" tabindex="-1"></a>    LinearRegression())</span>
<span id="cb402-11"><a href="#cb402-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb402-12"><a href="#cb402-12" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>X_train, y<span class="op">=</span>y_train)</span>
<span id="cb402-13"><a href="#cb402-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-14"><a href="#cb402-14" aria-hidden="true" tabindex="-1"></a>pred_y_test <span class="op">=</span> pipeline.predict(X<span class="op">=</span>X_test)</span>
<span id="cb402-15"><a href="#cb402-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-16"><a href="#cb402-16" aria-hidden="true" tabindex="-1"></a>mean_squared_error(y_test, pred_y_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>57.144979775232066</code></pre>
</div>
</div>
</section>
<section id="resampling-method-example-2" class="level3" data-number="10.3.4">
<h3 data-number="10.3.4"><span class="header-section-number">10.3.4</span> Resampling method example</h3>
<div class="cell">
<div class="sourceCode" id="cb404"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(df_known, df_known[<span class="st">&#39;price&#39;</span>], test_size <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;har&#39;</span>, <span class="st">&#39;sep&#39;</span>, <span class="st">&#39;win&#39;</span>, <span class="st">&#39;age&#39;</span>]),</span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb404-9"><a href="#cb404-9" aria-hidden="true" tabindex="-1"></a>    ct,</span>
<span id="cb404-10"><a href="#cb404-10" aria-hidden="true" tabindex="-1"></a>    LinearRegression())</span>
<span id="cb404-11"><a href="#cb404-11" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> pipeline.fit(X<span class="op">=</span>X_train, y<span class="op">=</span>y_train)</span>
<span id="cb404-12"><a href="#cb404-12" aria-hidden="true" tabindex="-1"></a>pred_y_test <span class="op">=</span> pipeline.predict(X<span class="op">=</span>X_test)</span>
<span id="cb404-13"><a href="#cb404-13" aria-hidden="true" tabindex="-1"></a>mean_squared_error(y_test, pred_y_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>144.88843435527758</code></pre>
</div>
</div>
</section>
<section id="cross-validation-1" class="level3" data-number="10.3.5">
<h3 data-number="10.3.5"><span class="header-section-number">10.3.5</span> Cross-Validation</h3>
<ul>
<li><p>It makes sense to do test/training many times…</p></li>
<li><p>But! Remember the original reason for test/training: we don’t want to use the <strong>same data</strong> in <em>fitting</em> and <em>evaluation</em>.</p></li>
<li><p>Idea: Let’s make sure that each observation only gets to be in the test set <strong>once</strong></p></li>
<li><p><strong>Cross-validation:</strong> Divide the data into 10 random “folds”. Each fold gets a “turn” as the test set.</p></li>
</ul>
</section>
<section id="cross-validation-2" class="level3" data-number="10.3.6">
<h3 data-number="10.3.6"><span class="header-section-number">10.3.6</span> Cross-Validation</h3>
<p><img src="./images/k_fold_pic.png" class="img-fluid" /></p>
</section>
<section id="cross-validation-in-sklearn" class="level3" data-number="10.3.7">
<h3 data-number="10.3.7"><span class="header-section-number">10.3.7</span> Cross-Validation in <code>sklearn</code></h3>
<div class="cell">
<div class="sourceCode" id="cb406"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>cross_val_score(pipeline, X <span class="op">=</span> df_known, y <span class="op">=</span> df_known[<span class="st">&#39;price&#39;</span>], cv <span class="op">=</span> <span class="dv">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([  0.53885509,   0.36267134,   0.6164344 ,  -2.52293886,
         0.75103464,   0.89242533, -49.63018969, -21.17272593,
        -0.16083366,   0.21125165])</code></pre>
</div>
</div>
<ul>
<li><p><code>sklearn</code> chooses a <strong>default metric</strong> for you based on the model.</p></li>
<li><p>In this case: <em>r-squared</em> for Linear Regression; <em>negative root mean square error</em> for KNN.</p></li>
<li><p>(Why negative? So that we want to <em>maximize</em> this score)</p></li>
</ul>
</section>
<section id="cross-validation-in-sklearn-1" class="level3" data-number="10.3.8">
<h3 data-number="10.3.8"><span class="header-section-number">10.3.8</span> Cross-Validation in <code>sklearn</code></h3>
<ul>
<li>What if you want <strong>MSE</strong>?</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb408"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>cv_scores <span class="op">=</span> cross_val_score(pipeline, X <span class="op">=</span> df_known, y <span class="op">=</span> df_known[<span class="st">&#39;price&#39;</span>], cv <span class="op">=</span> <span class="dv">10</span>, scoring <span class="op">=</span> <span class="st">&quot;neg_mean_squared_error&quot;</span>)</span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>cv_scores</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ -54.51757584, -301.38564331, -521.90492178, -247.38859562,
        -59.30908038,  -14.0803285 , -348.78575122, -138.57953707,
        -74.29335417,   -9.66216728])</code></pre>
</div>
</div>
</section>
<section id="cross-validation-faq" class="level3 smaller" data-number="10.3.9">
<h3 class="smaller" data-number="10.3.9"><span class="header-section-number">10.3.9</span> Cross-Validation: FAQ</h3>
<ul>
<li><p><strong>Q:</strong> How many cross validations should we do?</p></li>
<li><p><strong>A:</strong> It doesn’t matter much! Typical choices are 5 or 10.</p></li>
<li><p><strong>A:</strong> Think about the trade-offs: larger <em>training sets</em> = <em>more accurate models</em> but smaller <em>test sets</em> = <em>more uncertainty in evaluation</em></p></li>
<li><p><strong>Q:</strong> What metric should we use?</p></li>
<li><p><strong>A:</strong> This is your choice! What captures your idea of “successful prediction”? (But MSE/RMSE is a good default.)</p></li>
<li><p><strong>Q:</strong> I took statistics before, and I remember some things like “adjusted R-Squared” or “AIC” for model selection. What about those?</p></li>
<li><p><strong>A:</strong> Those are Old School, from a time when computers were not powerful enough to do cross-val. Modern data science uses resampling.</p></li>
</ul>
</section>
</section>
<section id="activity-7" class="level2" data-number="10.4">
<h2 data-number="10.4"><span class="header-section-number">10.4</span> Activity</h2>
<section id="your-turn" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1"><span class="header-section-number">10.4.1</span> Your turn</h3>
<ol type="1">
<li><p>Use <strong>cross-validation</strong> to choose between Linear Regression and KNN with k = 7, for:</p>
<ul>
<li>Using all predictors.</li>
<li>Using just winter rainfall and summer temperature.</li>
<li>Using only age.</li>
</ul></li>
<li><p>Re-run #1, but instead use <strong>mean absolute error</strong>. (You will need to look in the documentation of <code>cross_val_score</code> for this!)</p></li>
</ol>
</section>
</section>
<section id="tuning-with-gridsearchcv" class="level2" data-number="10.5">
<h2 data-number="10.5"><span class="header-section-number">10.5</span> Tuning with <code>GridSearchCV</code></h2>
<section id="tuning-1" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1"><span class="header-section-number">10.5.1</span> Tuning</h3>
<ul>
<li><p>In previous classes, we tried many different values of <span class="math inline">\(k\)</span> for KNN.</p></li>
<li><p>We also mentioned using <strong>absolute distance</strong> instead of <strong>euclidean distance</strong>.</p></li>
<li><p>Now, we would like to use <strong>cross-validation</strong> to decide between these options.</p></li>
<li><p><code>sklearn</code> provides a nice shortcut for this!</p></li>
</ul>
</section>
<section id="gridsearchcv" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2"><span class="header-section-number">10.5.2</span> <code>GridSearchCV</code></h3>
<div class="cell">
<div class="sourceCode" id="cb410"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> make_column_transformer(</span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>  (StandardScaler(), [<span class="st">&#39;summer&#39;</span>, <span class="st">&#39;har&#39;</span>, <span class="st">&#39;sep&#39;</span>, <span class="st">&#39;win&#39;</span>, <span class="st">&#39;age&#39;</span>]),</span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb410-4"><a href="#cb410-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb410-5"><a href="#cb410-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-6"><a href="#cb410-6" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb410-7"><a href="#cb410-7" aria-hidden="true" tabindex="-1"></a>    ct,</span>
<span id="cb410-8"><a href="#cb410-8" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor())</span>
<span id="cb410-9"><a href="#cb410-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb410-10"><a href="#cb410-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb410-11"><a href="#cb410-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-12"><a href="#cb410-12" aria-hidden="true" tabindex="-1"></a>grid_cv <span class="op">=</span> GridSearchCV(</span>
<span id="cb410-13"><a href="#cb410-13" aria-hidden="true" tabindex="-1"></a>    pipeline,</span>
<span id="cb410-14"><a href="#cb410-14" aria-hidden="true" tabindex="-1"></a>    param_grid<span class="op">=</span>{</span>
<span id="cb410-15"><a href="#cb410-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;kneighborsregressor__n_neighbors&quot;</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb410-16"><a href="#cb410-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;kneighborsregressor__metric&quot;</span>: [<span class="st">&quot;euclidean&quot;</span>, <span class="st">&quot;manhattan&quot;</span>],</span>
<span id="cb410-17"><a href="#cb410-17" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb410-18"><a href="#cb410-18" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&quot;neg_mean_squared_error&quot;</span>, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb410-19"><a href="#cb410-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-20"><a href="#cb410-20" aria-hidden="true" tabindex="-1"></a>grid_cv.fit(df_known, df_known[<span class="st">&#39;price&#39;</span>])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-26 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-26 {
  color: var(--sklearn-color-text);
}

#sk-container-id-26 pre {
  padding: 0;
}

#sk-container-id-26 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-26 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-26 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-26 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-26 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-26 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-26 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-26 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-26 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-26 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-26 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-26 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-26 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-26 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-26 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-26 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-26 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-26 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-26 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-26 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-26 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-26 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-26 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-26 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-26 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-26 div.sk-label label.sk-toggleable__label,
#sk-container-id-26 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-26 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-26 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-26 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-26 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-26 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-26 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-26 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-26 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-26 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-26 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-26 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-26 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-26" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;columntransformer&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                                         StandardScaler(),
                                                                         [&#x27;summer&#x27;,
                                                                          &#x27;har&#x27;,
                                                                          &#x27;sep&#x27;,
                                                                          &#x27;win&#x27;,
                                                                          &#x27;age&#x27;])])),
                                       (&#x27;kneighborsregressor&#x27;,
                                        KNeighborsRegressor())]),
             param_grid={&#x27;kneighborsregressor__metric&#x27;: [&#x27;euclidean&#x27;,
                                                         &#x27;manhattan&#x27;],
                         &#x27;kneighborsregressor__n_neighbors&#x27;: range(1, 7)},
             scoring=&#x27;neg_mean_squared_error&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-73" type="checkbox" ><label for="sk-estimator-id-73" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;columntransformer&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                                         StandardScaler(),
                                                                         [&#x27;summer&#x27;,
                                                                          &#x27;har&#x27;,
                                                                          &#x27;sep&#x27;,
                                                                          &#x27;win&#x27;,
                                                                          &#x27;age&#x27;])])),
                                       (&#x27;kneighborsregressor&#x27;,
                                        KNeighborsRegressor())]),
             param_grid={&#x27;kneighborsregressor__metric&#x27;: [&#x27;euclidean&#x27;,
                                                         &#x27;manhattan&#x27;],
                         &#x27;kneighborsregressor__n_neighbors&#x27;: range(1, 7)},
             scoring=&#x27;neg_mean_squared_error&#x27;)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-74" type="checkbox" ><label for="sk-estimator-id-74" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;,
                                                   &#x27;win&#x27;, &#x27;age&#x27;])])),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-75" type="checkbox" ><label for="sk-estimator-id-75" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;columntransformer: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for columntransformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-76" type="checkbox" ><label for="sk-estimator-id-76" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">standardscaler</label><div class="sk-toggleable__content fitted"><pre>[&#x27;summer&#x27;, &#x27;har&#x27;, &#x27;sep&#x27;, &#x27;win&#x27;, &#x27;age&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-77" type="checkbox" ><label for="sk-estimator-id-77" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-78" type="checkbox" ><label for="sk-estimator-id-78" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsRegressor<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsRegressor()</pre></div> </div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<ul>
<li><strong>How many times did a model get <code>.fit()</code> to some data?</strong></li>
</ul>
</section>
<section id="gridsearchcv-1" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3"><span class="header-section-number">10.5.3</span> <code>GridSearchCV</code></h3>
<div class="cell">
<div class="sourceCode" id="cb411"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid_cv.cv_results_)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean_fit_time  std_fit_time  ...  std_test_score  rank_test_score
0        0.001328      0.000145  ...      219.338831               12
1        0.001384      0.000101  ...      209.511631                9
2        0.001398      0.000064  ...      178.819362                6
3        0.001323      0.000047  ...      217.989122               11
4        0.001453      0.000228  ...      212.797774                7
5        0.001297      0.000230  ...      205.240907                3
6        0.001120      0.000011  ...      227.978005               10
7        0.001126      0.000020  ...      175.175403                2
8        0.001104      0.000012  ...      174.981203                5
9        0.001118      0.000026  ...      175.186322                1
10       0.001129      0.000024  ...      200.091917                4
11       0.001135      0.000023  ...      232.710455                8

[12 rows x 15 columns]</code></pre>
</div>
</div>
</section>
<section id="gridsearchcv-2" class="level3" data-number="10.5.4">
<h3 data-number="10.5.4"><span class="header-section-number">10.5.4</span> <code>GridSearchCV</code></h3>
<div class="cell">
<div class="sourceCode" id="cb413"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid_cv.cv_results_)[[<span class="st">&#39;param_kneighborsregressor__metric&#39;</span>, <span class="st">&#39;param_kneighborsregressor__n_neighbors&#39;</span>, <span class="st">&#39;mean_test_score&#39;</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   param_kneighborsregressor__metric  ... mean_test_score
0                          euclidean  ...     -321.833333
1                          euclidean  ...     -292.281667
2                          euclidean  ...     -278.301481
3                          euclidean  ...     -308.950417
4                          euclidean  ...     -279.847733
5                          euclidean  ...     -259.804074
6                          manhattan  ...     -305.793333
7                          manhattan  ...     -254.886667
8                          manhattan  ...     -274.401481
9                          manhattan  ...     -232.973333
10                         manhattan  ...     -267.988800
11                         manhattan  ...     -282.869444

[12 rows x 3 columns]</code></pre>
</div>
</div>
</section>
<section id="gridsearchcv-3" class="level3" data-number="10.5.5">
<h3 data-number="10.5.5"><span class="header-section-number">10.5.5</span> <code>GridSearchCV</code></h3>
<div class="cell">
<div class="sourceCode" id="cb415"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>grid_cv.best_params_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{&#39;kneighborsregressor__metric&#39;: &#39;manhattan&#39;, &#39;kneighborsregressor__n_neighbors&#39;: 4}</code></pre>
</div>
</div>
</section>
<section id="model-evaluation" class="level3" data-number="10.5.6">
<h3 data-number="10.5.6"><span class="header-section-number">10.5.6</span> Model evaluation</h3>
<p>You have now encountered <strong>three types of decisions</strong> for finding your best model:</p>
<ol type="1">
<li><p>Which <em>predictors</em> should we include, and how should we preprocess them? (<strong>feature selection</strong>)</p></li>
<li><p>Should we use <em>Linear Regression</em> or <em>KNN</em> or something else? (<strong>Model selection</strong>)</p></li>
<li><p>Which value of <span class="math inline">\(k\)</span> should we use? (<strong>hyperparameter tuning</strong>)</p></li>
</ol>
</section>
<section id="model-evaluation-1" class="level3" data-number="10.5.7">
<h3 data-number="10.5.7"><span class="header-section-number">10.5.7</span> Model evaluation</h3>
<p>Think of this like a college sports bracket:</p>
<ul>
<li><p>Gather all your <strong>candidate pipelines</strong> (combinations of <em>column transformers</em> and <em>model specifications</em>)</p></li>
<li><p><strong>Tune</strong> each pipeline with cross-validation (regional championships!)</p></li>
<li><p>Determine the <strong>best model type</strong> for each <strong>feature set</strong> (state championships!)</p></li>
<li><p>Determine the <strong>best pipeline</strong> (national championships!)</p></li>
</ul>
</section>
<section id="challenge" class="level3 larger" data-number="10.5.8">
<h3 class="larger" data-number="10.5.8"><span class="header-section-number">10.5.8</span> Challenge!</h3>
<p>Of all these options, what is the <strong>number one best model</strong> for wine price prediction, in your opinion?</p>
</section>
</section>
<section id="classification-with-knn" class="level1 lectitle" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Classification with KNN</h1>
<p><a href="slides-11-classification.html">Slides</a></p>
</section>
<section id="the-story-so-far-8" class="level2" data-number="11.1">
<h2 data-number="11.1"><span class="header-section-number">11.1</span> The story so far</h2>
<section id="choosing-a-best-model" class="level3" data-number="11.1.1">
<h3 data-number="11.1.1"><span class="header-section-number">11.1.1</span> Choosing a Best Model</h3>
<ul>
<li><p>We select a <strong>best model</strong> - aka best <em>prediction procedure</em> - by <strong>cross-validation</strong>.</p></li>
<li><p><strong>Feature selection:</strong> Which <em>predictors</em> should we include, and how should we preprocess them?</p></li>
<li><p><strong>Model selection:</strong> Should we use <em>Linear Regression</em> or <em>KNN</em> or <em>Decision Trees</em> or something else?</p></li>
<li><p><strong>Hyperparameter tuning:</strong> Choosing model-specific settings, like <span class="math inline">\(k\)</span> for KNN.</p></li>
<li><p>Each candidate is a <strong>pipeline</strong>; use <code>GridSearchCV</code> or <code>cross_val_score</code> to score the options</p></li>
</ul>
</section>
</section>
<section id="case-study-breast-tissue-classification" class="level2" data-number="11.2">
<h2 data-number="11.2"><span class="header-section-number">11.2</span> Case Study: Breast Tissue Classification</h2>
<section id="breast-tissue-classification" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1"><span class="header-section-number">11.2.1</span> Breast Tissue Classification</h3>
<p>Electrical signals can be used to detect whether tissue is cancerous.</p>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="./images/breast_diagram.jpeg" class="img-fluid" /></p>
<figcaption>image</figcaption>
</figure>
</div>
</div>
<p>The goal is to determine whether a sample of breast tissue is:</p>
<div class="columns">
<div class="column">
<p><strong>Not cancerous</strong> 1. connective tissue 2. adipose tissue 3. glandular tissue</p>
</div><div class="column">
<p><strong>Cancerous</strong> 4. carcinoma 5. fibro-adenoma 6. mastopathy</p>
</div><section id="reading-in-the-data" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2"><span class="header-section-number">11.2.2</span> Reading in the Data</h3>
<p>We will focus on two features:</p>
<ul>
<li><span class="math inline">\(I_0\)</span>: impedivity at 0 kHz,</li>
<li><span class="math inline">\(PA_{500}\)</span>: phase angle at 500 kHz.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb417"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/BreastTissue.csv&quot;</span>)</span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Case # Class           I0  ...      Max IP          DR            P
0         1   car   524.794072  ...   60.204880  220.737212   556.828334
1         2   car   330.000000  ...   69.717361   99.084964   400.225776
2         3   car   551.879287  ...   77.793297  253.785300   656.769449
3         4   car   380.000000  ...   88.758446  105.198568   493.701814
4         5   car   362.831266  ...   69.389389  103.866552   424.796503
..      ...   ...          ...  ...         ...         ...          ...
101     102   adi  2000.000000  ...  204.090347  478.517223  2088.648870
102     103   adi  2600.000000  ...  418.687286  977.552367  2664.583623
103     104   adi  1600.000000  ...  103.732704  432.129749  1475.371534
104     105   adi  2300.000000  ...  178.691742   49.593290  2480.592151
105     106   adi  2600.000000  ...  154.122604  729.368395  2545.419744

[106 rows x 11 columns]</code></pre>
</div>
</div>
</section><section id="visualizing-the-data" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3"><span class="header-section-number">11.2.3</span> Visualizing the Data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb419"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> <span class="st">&quot;PA500&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;Class&quot;</span>))</span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:3: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-224-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section><section id="k-nearest-neighbors-classification" class="level2" data-number="11.3">
<h2 data-number="11.3"><span class="header-section-number">11.3</span> K-Nearest Neighbors Classification</h2>
<section id="k-nearest-neighbors-2" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1"><span class="header-section-number">11.3.1</span> K-Nearest Neighbors</h3>
<p>What would we predict for someone with an <span class="math inline">\(I_0\)</span> of 400 and a <span class="math inline">\(PA_{500}\)</span> of 0.18?</p>
<div class="cell">
<div class="sourceCode" id="cb421"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]]</span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df[<span class="st">&quot;Class&quot;</span>]</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a>X_unknown <span class="op">=</span> pd.DataFrame({<span class="st">&quot;I0&quot;</span>: [<span class="dv">400</span>], <span class="st">&quot;PA500&quot;</span>: [<span class="fl">.18</span>]})</span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a>X_unknown</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    I0  PA500
0  400   0.18</code></pre>
</div>
</div>
</section>
<section id="k-nearest-neighbors-3" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2"><span class="header-section-number">11.3.2</span> K-Nearest Neighbors</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb423"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>(ggplot()</span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> <span class="st">&quot;PA500&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;Class&quot;</span>))</span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(X_unknown, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> <span class="st">&quot;PA500&quot;</span>), size <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-226-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="k-nearest-neighbors-4" class="level3" data-number="11.3.3">
<h3 data-number="11.3.3"><span class="header-section-number">11.3.3</span> K-Nearest Neighbors</h3>
<p>This process is <em>almost</em> identical to KNN <em>Regression</em>:</p>
<div class="cell">
<div class="sourceCode" id="cb425"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>    StandardScaler(),</span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>    KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">5</span>, metric<span class="op">=</span><span class="st">&quot;euclidean&quot;</span>))</span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> pipeline.fit(X_train, y_train)</span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a>pipeline.predict(X_unknown)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([&#39;car&#39;], dtype=object)</code></pre>
</div>
</div>
</section>
<section id="probabilities" class="level3" data-number="11.3.4">
<h3 data-number="11.3.4"><span class="header-section-number">11.3.4</span> Probabilities</h3>
<p>Which of these two unknown points would we be <strong>more sure</strong> about in our guess?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb427"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a>X_unknown <span class="op">=</span> pd.DataFrame({<span class="st">&quot;I0&quot;</span>: [<span class="dv">400</span>, <span class="dv">2200</span>], <span class="st">&quot;PA500&quot;</span>: [<span class="fl">.18</span>, <span class="fl">0.05</span>]})</span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>(ggplot()</span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(df, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> <span class="st">&quot;PA500&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;Class&quot;</span>))</span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(X_unknown, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> <span class="st">&quot;PA500&quot;</span>), size <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-228-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="probabilities-1" class="level3" data-number="11.3.5">
<h3 data-number="11.3.5"><span class="header-section-number">11.3.5</span> Probabilities</h3>
<p>Instead of returning a single predicted class, we can ask it to return the predicted probabilities for each class.</p>
<div class="cell">
<div class="sourceCode" id="cb429"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>pipeline.predict_proba(X_unknown)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0. , 0.6, 0. , 0.2, 0. , 0.2],
       [1. , 0. , 0. , 0. , 0. , 0. ]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb431"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a>pipeline.classes_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([&#39;adi&#39;, &#39;car&#39;, &#39;con&#39;, &#39;fad&#39;, &#39;gla&#39;, &#39;mas&#39;], dtype=object)</code></pre>
</div>
</div>
<p>How did Scikit-Learn calculate these predicted probabilities?</p>
</section>
<section id="cross-validation-for-classification" class="level3" data-number="11.3.6">
<h3 data-number="11.3.6"><span class="header-section-number">11.3.6</span> Cross-Validation for Classification</h3>
<p>We need a different <strong>scoring method</strong> for classification. A simple one is <strong>accuracy</strong>:</p>
<p><span class="math display">\[\text{accuracy} = \frac{\text{# correct predictions}}{\text{# predictions}}.\]</span></p>
</section>
<section id="cross-validation-for-classification-1" class="level3" data-number="11.3.7">
<h3 data-number="11.3.7"><span class="header-section-number">11.3.7</span> Cross-Validation for Classification</h3>
<div class="cell">
<div class="sourceCode" id="cb433"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(</span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a>    pipeline, X_train, y_train,</span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&quot;accuracy&quot;</span>,</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb433-8"><a href="#cb433-8" aria-hidden="true" tabindex="-1"></a>scores</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([0.63636364, 0.81818182, 0.45454545, 0.54545455, 0.63636364,
       0.54545455, 0.5       , 0.6       , 0.4       , 0.7       ])</code></pre>
</div>
</div>
<pre><code>array([0.63636364, 0.81818182, 0.45454545, 0.54545455, 0.63636364,
       0.54545455, 0.5       , 0.6       , 0.4       , 0.7       ])</code></pre>
</section>
<section id="cross-validation-for-classification-2" class="level3" data-number="11.3.8">
<h3 data-number="11.3.8"><span class="header-section-number">11.3.8</span> Cross-Validation for Classification</h3>
<p>As before, we can get an overall estimate of test accuracy by averaging the cross-validation accuracies:</p>
<div class="sourceCode" id="cb436" data-bgcolor="gray"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a>scores.mean()</span></code></pre></div>
<p>But! Accuracy is not always the best measure of a classification model!</p>
</section>
<section id="confusion-matrix" class="level3" data-number="11.3.9">
<h3 data-number="11.3.9"><span class="header-section-number">11.3.9</span> Confusion matrix</h3>
<div class="cell">
<div class="sourceCode" id="cb437"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> pipeline.fit(X_train, y_train)</span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a>y_train_predicted <span class="op">=</span> pipeline.predict(X_train)</span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a>confusion_matrix(y_train, y_train_predicted)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[20,  0,  2,  0,  0,  0],
       [ 0, 20,  0,  0,  0,  1],
       [ 2,  0, 11,  1,  0,  0],
       [ 0,  0,  0, 13,  1,  1],
       [ 0,  0,  0,  3, 12,  1],
       [ 0,  2,  0,  8,  3,  5]])</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-1" class="level3" data-number="11.3.10">
<h3 data-number="11.3.10"><span class="header-section-number">11.3.10</span> Confusion matrix</h3>
<div class="cell">
<div class="sourceCode" id="cb439"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(confusion_matrix(y_train, y_train_predicted), columns <span class="op">=</span> pipeline.classes_, index <span class="op">=</span> pipeline.classes_)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     adi  car  con  fad  gla  mas
adi   20    0    2    0    0    0
car    0   20    0    0    0    1
con    2    0   11    1    0    0
fad    0    0    0   13    1    1
gla    0    0    0    3   12    1
mas    0    2    0    8    3    5</code></pre>
</div>
</div>
</section>
</section><section id="activity-8" class="level2" data-number="11.4">
<h2 data-number="11.4"><span class="header-section-number">11.4</span> Activity</h2>
<section id="activity-9" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1"><span class="header-section-number">11.4.1</span> Activity</h3>
<p>Use a <strong>grid search</strong> and the <strong>accuracy</strong> score to find the <em>best</em> k-value for this modeling problem.</p>
</section>
</section><section id="classification-metrics" class="level2" data-number="11.5">
<h2 data-number="11.5"><span class="header-section-number">11.5</span> Classification Metrics</h2>
<section id="case-study-credit-card-fraud" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1"><span class="header-section-number">11.5.1</span> Case Study: Credit Card Fraud</h3>
<p>Data set of credit card transactions from Vesta.</p>
<p>Goal: Predict <code>isFraud</code>, where 1 indicates a fraudulent transaction.</p>
<div class="cell">
<div class="sourceCode" id="cb441"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>df_fraud <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/fraud.csv&quot;</span>)</span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>df_fraud</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            card4   card6 P_emaildomain  ...    C13    C14  isFraud
0            visa   debit     gmail.com  ...  637.0  114.0        0
1            visa   debit                ...    3.0    1.0        0
2            visa   debit     yahoo.com  ...    4.0    1.0        1
3            visa   debit   hotmail.com  ...    0.0    0.0        0
4            visa   debit     gmail.com  ...   20.0    1.0        0
...           ...     ...           ...  ...    ...    ...      ...
59049  mastercard   debit     gmail.com  ...    1.0    1.0        0
59050  mastercard  credit     yahoo.com  ...    1.0    1.0        0
59051  mastercard   debit    icloud.com  ...   15.0    2.0        0
59052        visa   debit     gmail.com  ...    1.0    1.0        1
59053  mastercard   debit                ...   84.0   17.0        0

[59054 rows x 19 columns]</code></pre>
</div>
</div>
</section>
<section id="classification-model" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2"><span class="header-section-number">11.5.2</span> Classification Model</h3>
<p>We can use <span class="math inline">\(k\)</span>-nearest neighbors for classification:</p>
<div class="cell">
<div class="sourceCode" id="cb443"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a>    make_column_transformer(</span>
<span id="cb443-8"><a href="#cb443-8" aria-hidden="true" tabindex="-1"></a>        (OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">&quot;ignore&quot;</span>, sparse_output<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb443-9"><a href="#cb443-9" aria-hidden="true" tabindex="-1"></a>         [<span class="st">&quot;card4&quot;</span>, <span class="st">&quot;card6&quot;</span>, <span class="st">&quot;P_emaildomain&quot;</span>]),</span>
<span id="cb443-10"><a href="#cb443-10" aria-hidden="true" tabindex="-1"></a>        remainder<span class="op">=</span><span class="st">&quot;passthrough&quot;</span>),</span>
<span id="cb443-11"><a href="#cb443-11" aria-hidden="true" tabindex="-1"></a>    StandardScaler(),</span>
<span id="cb443-12"><a href="#cb443-12" aria-hidden="true" tabindex="-1"></a>    KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">5</span>))</span></code></pre></div>
</div>
</section>
<section id="training-a-classifier" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3"><span class="header-section-number">11.5.3</span> Training a Classifier</h3>
<div class="cell">
<div class="sourceCode" id="cb444"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> df_fraud.drop(<span class="st">&quot;isFraud&quot;</span>, axis<span class="op">=</span><span class="st">&quot;columns&quot;</span>)</span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_fraud[<span class="st">&quot;isFraud&quot;</span>]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb445"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a>cross_val_score(</span>
<span id="cb445-4"><a href="#cb445-4" aria-hidden="true" tabindex="-1"></a>    pipeline,</span>
<span id="cb445-5"><a href="#cb445-5" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X_train, y<span class="op">=</span>y_train,</span>
<span id="cb445-6"><a href="#cb445-6" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&quot;accuracy&quot;</span>,</span>
<span id="cb445-7"><a href="#cb445-7" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">10</span></span>
<span id="cb445-8"><a href="#cb445-8" aria-hidden="true" tabindex="-1"></a>).mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.9681816479631644</code></pre>
</div>
</div>
<p>How is the accuracy so high?</p>
</section>
<section id="a-closer-look" class="level3" data-number="11.5.4">
<h3 data-number="11.5.4"><span class="header-section-number">11.5.4</span> A Closer Look</h3>
<p>Let’s take a closer look at the labels.</p>
<div class="cell">
<div class="sourceCode" id="cb447"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>y_train.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>isFraud
0    56935
1     2119
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>The vast majority of transactions are normal (0)!</p>
</section>
<section id="imbalanced-data" class="level3" data-number="11.5.5">
<h3 data-number="11.5.5"><span class="header-section-number">11.5.5</span> Imbalanced data</h3>
<p>If we just predicted that every transaction is normal, the accuracy would be <span class="math inline">\(1 - \frac{2119}{59054} = .964\)</span>.</p>
<p>Even though such predictions would be accurate <em>overall</em>, it is inaccurate for fraudulent transactions. A good model is “accurate for every class”.</p>
</section>
</section><section id="precision-and-recall" class="level2" data-number="11.6">
<h2 data-number="11.6"><span class="header-section-number">11.6</span> Precision and Recall</h2>
<ul>
<li><p>We need a score that measures “accuracy for class <span class="math inline">\(c\)</span>”.</p></li>
<li><p>There are at least two reasonable definitions:</p></li>
<li><p><strong>precision</strong>: <span class="math inline">\(P(\text{correct} | \text{predicted class } c)\)</span></p>
<p>Among the observations that were predicted to be in class <span class="math inline">\(c\)</span>, what proportion actually were?</p></li>
<li><p><strong>recall</strong>: <span class="math inline">\(P(\text{correct} | \text{actual class} c)\)</span>.</p>
<p>Among the observations that were actually in class <span class="math inline">\(c\)</span>, what proportion were predicted to be?</p></li>
</ul>
<section id="precision-and-recall-by-hand" class="level3" data-number="11.6.1">
<h3 data-number="11.6.1"><span class="header-section-number">11.6.1</span> Precision and Recall by Hand</h3>
<p>To check our understanding of these definitions, let’s calculate a few precisions and recalls by hand.</p>
<p>First, summarize the results by the <strong>confusion matrix</strong>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb449"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>pipeline.fit(X_train, y_train)</span></code></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-27 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-27 {
  color: var(--sklearn-color-text);
}

#sk-container-id-27 pre {
  padding: 0;
}

#sk-container-id-27 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-27 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-27 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-27 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-27 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-27 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-27 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-27 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-27 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-27 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-27 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-27 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-27 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-27 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-27 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-27 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-27 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-27 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-27 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-27 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-27 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-27 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-27 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-27 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-27 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-27 div.sk-label label.sk-toggleable__label,
#sk-container-id-27 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-27 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-27 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-27 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-27 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-27 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-27 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-27 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-27 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-27 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-27 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-27 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-27 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-27" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                                   transformers=[(&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False),
                                                  [&#x27;card4&#x27;, &#x27;card6&#x27;,
                                                   &#x27;P_emaildomain&#x27;])])),
                (&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kneighborsclassifier&#x27;, KNeighborsClassifier())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-79" type="checkbox" ><label for="sk-estimator-id-79" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                                   transformers=[(&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                                                sparse_output=False),
                                                  [&#x27;card4&#x27;, &#x27;card6&#x27;,
                                                   &#x27;P_emaildomain&#x27;])])),
                (&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kneighborsclassifier&#x27;, KNeighborsClassifier())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-80" type="checkbox" ><label for="sk-estimator-id-80" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;columntransformer: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for columntransformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(remainder=&#x27;passthrough&#x27;,
                  transformers=[(&#x27;onehotencoder&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;,
                                               sparse_output=False),
                                 [&#x27;card4&#x27;, &#x27;card6&#x27;, &#x27;P_emaildomain&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-81" type="checkbox" ><label for="sk-estimator-id-81" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">onehotencoder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;card4&#x27;, &#x27;card6&#x27;, &#x27;P_emaildomain&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-82" type="checkbox" ><label for="sk-estimator-id-82" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-83" type="checkbox" ><label for="sk-estimator-id-83" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">remainder</label><div class="sk-toggleable__content fitted"><pre>[&#x27;TransactionAmt&#x27;, &#x27;C1&#x27;, &#x27;C2&#x27;, &#x27;C3&#x27;, &#x27;C4&#x27;, &#x27;C5&#x27;, &#x27;C6&#x27;, &#x27;C7&#x27;, &#x27;C8&#x27;, &#x27;C9&#x27;, &#x27;C10&#x27;, &#x27;C11&#x27;, &#x27;C12&#x27;, &#x27;C13&#x27;, &#x27;C14&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-84" type="checkbox" ><label for="sk-estimator-id-84" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">passthrough</label><div class="sk-toggleable__content fitted"><pre>passthrough</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-85" type="checkbox" ><label for="sk-estimator-id-85" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-86" type="checkbox" ><label for="sk-estimator-id-86" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier()</pre></div> </div></div></div></div></div></div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb450"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>y_train_ <span class="op">=</span> pipeline.predict(X_train)</span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>confusion_matrix(y_train, y_train_)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>array([[56817,   118],
       [ 1524,   595]])</code></pre>
</div>
</div>
<ul>
<li><p>What is the (training) accuracy?</p></li>
<li><p>What’s the precision for normal transactions?</p></li>
<li><p>What’s the recall for normal transactions?</p></li>
<li><p>What’s the precision for fraudulent transactions?</p></li>
<li><p>What’s the recall for fraudulent transactions?</p></li>
</ul>
</section>
<section id="tradeoff-between-precision-and-recall" class="level3" data-number="11.6.2">
<h3 data-number="11.6.2"><span class="header-section-number">11.6.2</span> Tradeoff between Precision and Recall</h3>
<p>Can you imagine a classifier that always has 100% recall for class <span class="math inline">\(c\)</span>, no matter the data?</p>
<p>In general, if the model classifies more observations as <span class="math inline">\(c\)</span>,</p>
<ul>
<li><p>recall (for class <span class="math inline">\(c\)</span>) <span class="math inline">\(\uparrow\)</span></p></li>
<li><p>precision (for class <span class="math inline">\(c\)</span>) <span class="math inline">\(\downarrow\)</span></p></li>
</ul>
<p>How do we compare two classifiers, if one has higher precision and the other has higher recall?</p>
</section>
<section id="f1-score" class="level3" data-number="11.6.3">
<h3 data-number="11.6.3"><span class="header-section-number">11.6.3</span> F1 Score</h3>
<p>The <strong>F1 score</strong> combines precision and recall into a single score:</p>
<p><span class="math display">\[\text{F1 score} = \text{harmonic mean of precision and recall}\]</span> <span class="math display">\[= \frac{2} {\left( \frac{1}{\text{precision}} + \frac{1}{\text{recall}}\right)}\]</span></p>
<ul>
<li><p>To achieve a high F1 score, both precision and recall have to be high.</p></li>
<li><p>If either is low, then the harmonic mean will be low.</p></li>
</ul>
</section>
<section id="estimating-test-precision-recall-and-f1" class="level3" data-number="11.6.4">
<h3 data-number="11.6.4"><span class="header-section-number">11.6.4</span> Estimating Test Precision, Recall, and F1</h3>
<ul>
<li><p>Remember that each class has its own precision, recall, and F1.</p></li>
<li><p>But Scikit-Learn requires that the <code>scoring=</code> parameter be a single number.</p></li>
<li><p>For this, we can average the score over the classes:</p>
<ul>
<li><code>"precision_macro"</code></li>
<li><code>"recall_macro"</code></li>
<li><code>"f1_macro"</code></li>
</ul></li>
</ul>
</section>
<section id="f1-score-1" class="level3" data-number="11.6.5">
<h3 data-number="11.6.5"><span class="header-section-number">11.6.5</span> F1 Score</h3>
<div class="cell">
<div class="sourceCode" id="cb452"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a>cross_val_score(</span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a>    pipeline,</span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X_train, y<span class="op">=</span>y_train,</span>
<span id="cb452-4"><a href="#cb452-4" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&quot;f1_macro&quot;</span>,</span>
<span id="cb452-5"><a href="#cb452-5" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">10</span></span>
<span id="cb452-6"><a href="#cb452-6" aria-hidden="true" tabindex="-1"></a>).mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.647618677299677</code></pre>
</div>
</div>
</section>
<section id="precision-recall-curve" class="level3" data-number="11.6.6">
<h3 data-number="11.6.6"><span class="header-section-number">11.6.6</span> Precision-Recall Curve</h3>
<p>Another way to illustrate the tradeoff between precision and recall is to graph the <strong>precision-recall curve</strong>.</p>
<p>First, we need the predicted probabilities.</p>
<div class="cell">
<div class="sourceCode" id="cb454"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>y_train_probs_ <span class="op">=</span> pipeline.predict_proba(X_train)</span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>y_train_probs_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[1. , 0. ],
       [1. , 0. ],
       [0.6, 0.4],
       ...,
       [1. , 0. ],
       [0.8, 0.2],
       [1. , 0. ]])</code></pre>
</div>
</div>
</section>
<section id="precision-recall-curve-1" class="level3" data-number="11.6.7">
<h3 data-number="11.6.7"><span class="header-section-number">11.6.7</span> Precision-Recall Curve</h3>
<ul>
<li><p>By default, Scikit-Learn classifies a transaction as fraud if this probability is <span class="math inline">\(&gt; 0.5\)</span>.</p></li>
<li><p>What if we instead used a threshold <span class="math inline">\(t\)</span> other than <span class="math inline">\(0.5\)</span>?</p></li>
<li><p>Depending on which <span class="math inline">\(t\)</span> we pick, we’ll get a different precision and recall. We can graph this tradeoff.</p></li>
</ul>
</section>
<section id="precision-recall-curve-2" class="level3" data-number="11.6.8">
<h3 data-number="11.6.8"><span class="header-section-number">11.6.8</span> Precision-Recall Curve</h3>
<p>Let’s graph the precision-recall curve together in a Colab.</p>
<p><a href="https://colab.research.google.com/drive/1w-4iGAiL3iXqAl3332teOT0gXv1wNxio?usp=sharing">Link</a></p>
</section>
</section><section id="takeaways-11" class="level2" data-number="11.7">
<h2 data-number="11.7"><span class="header-section-number">11.7</span> Takeaways</h2>
<section id="takeaways-12" class="level3" data-number="11.7.1">
<h3 data-number="11.7.1"><span class="header-section-number">11.7.1</span> Takeaways</h3>
<ul>
<li><p>We can do <strong>KNN for Classification</strong> by letting the nearest neighbors “vote”</p></li>
<li><p>The number of votes is a “probability”</p></li>
<li><p>A <strong>classification model</strong> must be evaluated differently than a <strong>regression model</strong>.</p></li>
<li><p>One possible metric is <strong>accuracy</strong>, but this is a bad choice in situations with <strong>imbalanced data</strong>.</p></li>
<li><p><strong>Precision</strong> measures “if we say it’s in Class A, is it really?”</p></li>
<li><p><strong>Recall</strong> measures “if it’s really in Class A, did we find it?”</p></li>
<li><p><strong>F1 Score</strong> is a balance of precision and recall</p></li>
<li><p><strong>Macro F1 Score</strong> averages the F1 scores of all classes</p></li>
</ul>
</section>
</section><section id="logistic-regression" class="level1 lectitle" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Logistic Regression</h1>
<p><a href="slides-12-logistic.html">Slides</a></p>
</section><section id="the-story-so-far-9" class="level2" data-number="12.1">
<h2 data-number="12.1"><span class="header-section-number">12.1</span> The story so far</h2>
<section id="classification" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1"><span class="header-section-number">12.1.1</span> Classification</h3>
<ul>
<li><p>We can do <strong>KNN for Classification</strong> by letting the nearest neighbors “vote”</p></li>
<li><p>The number of votes is a “probability”</p></li>
<li><p>A <strong>classification model</strong> must be evaluated differently than a <strong>regression model</strong>.</p></li>
<li><p>One possible metric is <strong>accuracy</strong>, but this is a bad choice in situations with <strong>imbalanced data</strong>.</p></li>
<li><p><strong>Precision</strong> measures “if we say it’s in Class A, is it really?”</p></li>
<li><p><strong>Recall</strong> measures “if it’s really in Class A, did we find it?”</p></li>
<li><p><strong>F1 Score</strong> is a balance of precision and recall</p></li>
<li><p><strong>Macro F1 Score</strong> averages the F1 scores of all classes</p></li>
</ul>
</section>
</section><section id="revisiting-the-breast-cancer-data" class="level2" data-number="12.2">
<h2 data-number="12.2"><span class="header-section-number">12.2</span> Revisiting the Breast Cancer Data</h2>
<section id="breast-tissue-classification-1" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1"><span class="header-section-number">12.2.1</span> Breast Tissue Classification</h3>
<p>Electrical signals can be used to detect whether tissue is cancerous.</p>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="./images/breast_diagram.jpeg" class="img-fluid" /></p>
<figcaption>image</figcaption>
</figure>
</div>
</div>
<p>The goal is to determine whether a sample of breast tissue is:</p>
<p>::::{.columns} :::{.column} <strong>Not cancerous</strong> 1. connective tissue 2. adipose tissue 3. glandular tissue</p>
</section>
</section>
</div>
<div class="column">
<p><strong>Cancerous</strong> 4. carcinoma 5. fibro-adenoma 6. mastopathy</p>
</div>
</section>
<section id="binary-response-cancer-or-not" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2"><span class="header-section-number">12.2.2</span> Binary response: Cancer or not</h3>
<p>Let’s read the data, and also make a new variable called “Cancerous”.</p>
<div class="cell">
<div class="sourceCode" id="cb456"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://datasci112.stanford.edu/data/BreastTissue.csv&quot;</span>)</span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-4"><a href="#cb456-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Cancerous&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Class&#39;</span>] <span class="op">==</span> <span class="st">&quot;car&quot;</span>) <span class="op">|</span> (df[<span class="st">&#39;Class&#39;</span>] <span class="op">==</span> <span class="st">&quot;fad&quot;</span>) <span class="op">|</span> (df[<span class="st">&#39;Class&#39;</span>] <span class="op">==</span> <span class="st">&quot;mas&quot;</span>)</span>
<span id="cb456-5"><a href="#cb456-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-6"><a href="#cb456-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Case # Class          I0  ...          DR           P  Cancerous
0       1   car  524.794072  ...  220.737212  556.828334       True
1       2   car  330.000000  ...   99.084964  400.225776       True
2       3   car  551.879287  ...  253.785300  656.769449       True
3       4   car  380.000000  ...  105.198568  493.701814       True
4       5   car  362.831266  ...  103.866552  424.796503       True

[5 rows x 12 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="why-not-use-regular-regression" class="level2" data-number="12.3">
<h2 data-number="12.3"><span class="header-section-number">12.3</span> Why not use “regular” regression?</h2>
<p><strong>You should NOT use ordinary regression for a classification problem! This slide section is to show you why it does NOT work.</strong></p>
<section id="counter-example-linear-regression" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1"><span class="header-section-number">12.3.1</span> Counter-Example: Linear Regression</h3>
<p>We know that in computers, <code>True</code> = <code>1</code> and <code>False</code> = <code>0</code>. So, why not convert our response variable, <code>Cancerous</code>, to numbers and fit a regression?</p>
<div class="cell">
<div class="sourceCode" id="cb458"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Cancerous&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Cancerous&#39;</span>].astype(<span class="st">&#39;int&#39;</span>)</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Case # Class          I0  ...          DR           P  Cancerous
0       1   car  524.794072  ...  220.737212  556.828334          1
1       2   car  330.000000  ...   99.084964  400.225776          1
2       3   car  551.879287  ...  253.785300  656.769449          1
3       4   car  380.000000  ...  105.198568  493.701814          1
4       5   car  362.831266  ...  103.866552  424.796503          1

[5 rows x 12 columns]</code></pre>
</div>
</div>
</section>
<section id="example-ols-regression" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2"><span class="header-section-number">12.3.2</span> Example: OLS Regression</h3>
<div class="cell">
<div class="sourceCode" id="cb460"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>  LinearRegression())</span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> pipeline.fit(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]], df[<span class="st">&#39;Cancerous&#39;</span>])</span></code></pre></div>
</div>
</section>
<section id="counter-example-linear-regression-1" class="level3" data-number="12.3.3">
<h3 data-number="12.3.3"><span class="header-section-number">12.3.3</span> Counter-Example: Linear Regression</h3>
<p><strong>Problem 1:</strong> How do we predict <em>categories</em>???</p>
<div class="cell">
<div class="sourceCode" id="cb461"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>pred_cancer <span class="op">=</span> pipeline.predict(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>pred_cancer</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ 0.74019045,  0.89022436,  0.82501565,  0.90210945,  0.82407215,
        0.70880368,  0.73084215,  0.75641256,  0.81285854,  0.84265773,
        1.05274916,  0.83203994,  0.82221736,  0.98879611,  0.84321428,
        1.14439789,  0.87065951,  0.82357191,  0.88721004,  0.86017708,
        0.75973787,  0.56958917,  0.50364921,  0.84044159,  0.66291026,
        0.5291845 ,  0.58770322,  0.58565156,  0.53944124,  0.54086431,
        0.626959  ,  0.60392716,  0.84459104,  0.65514535,  0.83767168,
        0.73230038,  0.82568408,  0.75333313,  0.54012943,  0.54183212,
        0.50716066,  0.70881584,  0.52734464,  0.66456375,  0.73629418,
        0.85237593,  0.84451578,  0.62061155,  0.60509501,  0.47440789,
        0.78797208,  0.74240828,  0.91841366,  0.71160435,  0.63338505,
        0.7122256 ,  0.82410488,  0.55742465,  0.62545421,  0.73912902,
        0.73912902,  0.70136245,  0.78113432,  0.77907358,  0.51597274,
        0.49247652,  0.65694204,  0.72574607,  0.76292245,  0.82501906,
        0.04266066,  0.24283615,  0.30785716,  0.52977377,  0.12835422,
        0.35012437,  0.39042852,  0.34447888,  0.10874534,  0.22844426,
        0.35125209,  0.25457208,  0.12820727,  0.18275452, -0.06826015,
       -0.02235371,  0.05662524, -0.02161184,  0.03275109, -0.03722978,
        0.05434445, -0.11400134,  0.0985149 , -0.01465065,  0.05067869,
        0.04211471,  0.05774736, -0.26666568, -0.13914905, -0.12585178,
       -0.02264956,  0.06060737,  0.04839979,  0.12583274, -0.17299233,
       -0.22474136])</code></pre>
</div>
</div>
</section>
<section id="counter-example-linear-regression-2" class="level3" data-number="12.3.4">
<h3 data-number="12.3.4"><span class="header-section-number">12.3.4</span> Counter-Example: Linear Regression</h3>
<p><strong>Problem 2:</strong> Was the relationship really <em>linear</em>???</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb463"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> <span class="st">&quot;Cancerous&quot;</span>)) </span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point()</span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_smooth(method <span class="op">=</span> <span class="st">&quot;lm&quot;</span>, se <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-249-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="counter-example-linear-regression-3" class="level3" data-number="12.3.5">
<h3 data-number="12.3.5"><span class="header-section-number">12.3.5</span> Counter-Example: Linear Regression</h3>
<p><strong>Problem 3:</strong> Was the error really <em>random</em>???</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb465"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> df[<span class="st">&#39;Cancerous&#39;</span>] <span class="op">-</span> pred_cancer</span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, y <span class="op">=</span> residuals))</span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-250-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="logistic-regression-1" class="level2" data-number="12.4">
<h2 data-number="12.4"><span class="header-section-number">12.4</span> Logistic Regression</h2>
<section id="logistic-regression-2" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1"><span class="header-section-number">12.4.1</span> Logistic Regression</h3>
<ul>
<li><p><strong>Idea:</strong> Instead of predicting 0 or 1, try to predict the <em>probability</em> of cancer.</p></li>
<li><p><strong>Problem:</strong> We don’t observe probabilities before diagnosis; we only know if that person ended up with cancer or not.</p></li>
<li><p><strong>Solution:</strong> (Fancy statistics and math.)</p></li>
<li><p>Why is it called <strong>Logistic Regression</strong>?</p></li>
<li><p>Because the “fancy math” uses a <em>logistic function</em> in it.</p></li>
</ul>
</section>
<section id="logistic-regression-3" class="level3 smaller" data-number="12.4.2">
<h3 class="smaller" data-number="12.4.2"><span class="header-section-number">12.4.2</span> Logistic Regression</h3>
<p>What you need to know:</p>
<ul>
<li><p>It’s used for <strong>binary classification</strong> problems.</p></li>
<li><p>The predicted <strong>values</strong> are the “log-odds” of having cancer, i.e.</p></li>
</ul>
<p><span class="math display">\[\text{log-odds} = \log \left(\frac{p}{1-p}\right)\]</span></p>
<ul>
<li><p>We are more interested in the <strong>predicted probabilities</strong>.</p></li>
<li><p>As with KNN, we predict <strong>categories</strong> by choosing a <strong>threshold</strong></p></li>
<li><p>By default: Probability &gt; 0.5 -&gt; Predict cancerous.</p></li>
</ul>
</section>
<section id="logistic-regression-in-sklearn" class="level3" data-number="12.4.3">
<h3 data-number="12.4.3"><span class="header-section-number">12.4.3</span> Logistic Regression in <code>sklearn</code></h3>
<div class="cell">
<div class="sourceCode" id="cb467"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-4"><a href="#cb467-4" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb467-5"><a href="#cb467-5" aria-hidden="true" tabindex="-1"></a>  LogisticRegression(penalty<span class="op">=</span><span class="va">None</span>))</span>
<span id="cb467-6"><a href="#cb467-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-7"><a href="#cb467-7" aria-hidden="true" tabindex="-1"></a>pipeline.fit(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]], df[<span class="st">&#39;Cancerous&#39;</span>])</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-28 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-28 {
  color: var(--sklearn-color-text);
}

#sk-container-id-28 pre {
  padding: 0;
}

#sk-container-id-28 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-28 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-28 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-28 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-28 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-28 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-28 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-28 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-28 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-28 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-28 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-28 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-28 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-28 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-28 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-28 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-28 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-28 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-28 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-28 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-28 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-28 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-28 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-28 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-28 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-28 div.sk-label label.sk-toggleable__label,
#sk-container-id-28 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-28 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-28 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-28 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-28 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-28 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-28 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-28 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-28 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-28 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-28 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-28 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-28 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-28" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;logisticregression&#x27;, LogisticRegression(penalty=None))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-87" type="checkbox" ><label for="sk-estimator-id-87" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;logisticregression&#x27;, LogisticRegression(penalty=None))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-88" type="checkbox" ><label for="sk-estimator-id-88" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LogisticRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(penalty=None)</pre></div> </div></div></div></div></div></div>
</div>
</div>
</section>
<section id="logistic-regression-in-sklearn-1" class="level3" data-number="12.4.4">
<h3 data-number="12.4.4"><span class="header-section-number">12.4.4</span> Logistic Regression in <code>sklearn</code></h3>
<div class="cell">
<div class="sourceCode" id="cb468"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a>pred_cancer <span class="op">=</span> pipeline.predict(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a>pred_cancer</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1,
       1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0,
       1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])</code></pre>
</div>
</div>
</section>
</section>
<section id="precison-and-recall-revisited" class="level2" data-number="12.5">
<h2 data-number="12.5"><span class="header-section-number">12.5</span> Precison and Recall Revisited</h2>
<section id="confusion-matrix-2" class="level3 smaller" data-number="12.5.1">
<h3 class="smaller" data-number="12.5.1"><span class="header-section-number">12.5.1</span> Confusion matrix</h3>
<div class="cell">
<div class="sourceCode" id="cb470"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(confusion_matrix(df[<span class="st">&#39;Cancerous&#39;</span>], pred_cancer), columns <span class="op">=</span> pipeline.classes_, index <span class="op">=</span> pipeline.classes_)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0   1
0  38  14
1   3  51</code></pre>
</div>
</div>
<ul>
<li><p>Calculate the <em>precision</em> for predicting cancer.</p></li>
<li><p>Calculate the <em>recall</em> for predicting cancer.</p></li>
<li><p>Calculate the <em>precision</em> for predicting non-cancer.</p></li>
<li><p>Calculate the <em>recall</em> for predicting non-cancer.</p></li>
</ul>
</section>
<section id="threshold" class="level3" data-number="12.5.2">
<h3 data-number="12.5.2"><span class="header-section-number">12.5.2</span> Threshold</h3>
<p>What if we had used different cutoffs besides <span class="math inline">\(p &gt; 0.5\)</span>?</p>
<div class="cell">
<div class="sourceCode" id="cb472"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a>prob_cancer <span class="op">=</span> pipeline.predict_proba(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a>prob_cancer.<span class="bu">round</span>(<span class="dv">2</span>)[<span class="dv">1</span>:<span class="dv">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.11, 0.89],
       [0.19, 0.81],
       [0.11, 0.89],
       [0.16, 0.84]])</code></pre>
</div>
</div>
</section>
<section id="higher-threshold" class="level3" data-number="12.5.3">
<h3 data-number="12.5.3"><span class="header-section-number">12.5.3</span> Higher Threshold</h3>
<p>What we used <span class="math inline">\(p &gt; 0.7\)</span>?</p>
<div class="cell">
<div class="sourceCode" id="cb474"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a>prob_cancer <span class="op">=</span> pipeline.predict_proba(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a>pred_cancer_70 <span class="op">=</span> prob_cancer[:,<span class="dv">1</span>] <span class="op">&gt;</span> <span class="fl">.7</span></span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a>pred_cancer_70[<span class="dv">1</span>:<span class="dv">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ True,  True,  True,  True])</code></pre>
</div>
</div>
</section>
<section id="higher-threshold-1" class="level3" data-number="12.5.4">
<h3 data-number="12.5.4"><span class="header-section-number">12.5.4</span> Higher Threshold</h3>
<p>What we used <span class="math inline">\(p &gt; 0.7\)</span>?</p>
<div class="cell">
<div class="sourceCode" id="cb476"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a>conf_mat <span class="op">=</span> confusion_matrix(df[<span class="st">&#39;Cancerous&#39;</span>], pred_cancer_70)</span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(conf_mat, columns <span class="op">=</span> pipeline.classes_, index <span class="op">=</span> pipeline.classes_)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0   1
0  41  11
1  18  36</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb478"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a>precision_1 <span class="op">=</span> conf_mat[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">/</span>conf_mat[:,<span class="dv">1</span>].<span class="bu">sum</span>()</span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>precision_1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7659574468085106</code></pre>
</div>
<div class="sourceCode" id="cb480"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a>recall_1 <span class="op">=</span> conf_mat[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">/</span>conf_mat[<span class="dv">1</span>, :].<span class="bu">sum</span>()</span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>recall_1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.6666666666666666</code></pre>
</div>
</div>
</section>
<section id="lower-threshold" class="level3" data-number="12.5.5">
<h3 data-number="12.5.5"><span class="header-section-number">12.5.5</span> Lower Threshold</h3>
<p>What we used <span class="math inline">\(p &gt; 0.2\)</span>?</p>
<div class="cell">
<div class="sourceCode" id="cb482"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a>prob_cancer <span class="op">=</span> pipeline.predict_proba(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a>pred_cancer_20 <span class="op">=</span> prob_cancer[:,<span class="dv">1</span>] <span class="op">&gt;</span> <span class="fl">.2</span></span>
<span id="cb482-3"><a href="#cb482-3" aria-hidden="true" tabindex="-1"></a>pred_cancer_20[<span class="dv">1</span>:<span class="dv">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([ True,  True,  True,  True])</code></pre>
</div>
</div>
</section>
<section id="lower-threshold-1" class="level3" data-number="12.5.6">
<h3 data-number="12.5.6"><span class="header-section-number">12.5.6</span> Lower Threshold</h3>
<div class="cell">
<div class="sourceCode" id="cb484"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>conf_mat <span class="op">=</span> confusion_matrix(df[<span class="st">&#39;Cancerous&#39;</span>], pred_cancer_20)</span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(conf_mat, columns <span class="op">=</span> pipeline.classes_, index <span class="op">=</span> pipeline.classes_)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0   1
0  33  19
1   0  54</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb486"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a>precision_1 <span class="op">=</span> conf_mat[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">/</span>conf_mat[:,<span class="dv">1</span>].<span class="bu">sum</span>()</span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>precision_1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7397260273972602</code></pre>
</div>
<div class="sourceCode" id="cb488"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a>recall_1 <span class="op">=</span> conf_mat[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">/</span>conf_mat[<span class="dv">1</span>, :].<span class="bu">sum</span>()</span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a>recall_1</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.0</code></pre>
</div>
</div>
</section>
<section id="precision-recall-curve-3" class="level3" data-number="12.5.7">
<h3 data-number="12.5.7"><span class="header-section-number">12.5.7</span> Precision-Recall Curve</h3>
<div class="cell">
<div class="sourceCode" id="cb490"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_recall_curve</span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>precision, recall, thresholds <span class="op">=</span> precision_recall_curve(</span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&#39;Cancerous&#39;</span>], prob_cancer[:, <span class="dv">1</span>])</span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb490-6"><a href="#cb490-6" aria-hidden="true" tabindex="-1"></a>df_pr <span class="op">=</span> pd.DataFrame({</span>
<span id="cb490-7"><a href="#cb490-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;precision&quot;</span>: precision,</span>
<span id="cb490-8"><a href="#cb490-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;recall&quot;</span>: recall</span>
<span id="cb490-9"><a href="#cb490-9" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
</section>
<section id="precision-recall-curve-4" class="level3" data-number="12.5.8">
<h3 data-number="12.5.8"><span class="header-section-number">12.5.8</span> Precision-Recall Curve</h3>
<div class="cell">
<div class="sourceCode" id="cb491"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df_pr, aes(x <span class="op">=</span> <span class="st">&quot;recall&quot;</span>, y <span class="op">=</span> <span class="st">&quot;precision&quot;</span>))</span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-262-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="your-turn-1" class="level2" data-number="12.6">
<h2 data-number="12.6"><span class="header-section-number">12.6</span> Your turn</h2>
<section id="activity-10" class="level3 smaller" data-number="12.6.1">
<h3 class="smaller" data-number="12.6.1"><span class="header-section-number">12.6.1</span> Activity</h3>
<p>Suppose you want to predict Cancer vs. No Cancer from breast tissue using a Logistic Regression. Should you use…</p>
<ul>
<li><p>Just <code>I0</code> and <code>PA500</code>?</p></li>
<li><p>Just <code>DA</code> and <code>DP</code>?</p></li>
<li><p><code>I0</code>, <code>PA500</code>, <code>DA</code>, and <code>DP</code>?</p></li>
<li><p>or all predictors?</p></li>
</ul>
<p>Use <strong>cross-validation</strong> with <strong>F1 Score</strong> to decide!</p>
<p>Then, fit your <strong>final model</strong> and report the <strong>confusion matrix</strong>.</p>
<p><em>Completely optional - you will not be tested on this: change <code>penalty = None</code> to <code>penalty = 'l1'</code> or <code>penalty = 'l2'</code> and tune the <code>alpha</code> parameter for your Logistic Regression models</em></p>
</section>
</section>
<section id="interpreting-logistic-regression" class="level2" data-number="12.7">
<h2 data-number="12.7"><span class="header-section-number">12.7</span> Interpreting Logistic Regression</h2>
<section id="looking-at-coefficients" class="level3" data-number="12.7.1">
<h3 data-number="12.7.1"><span class="header-section-number">12.7.1</span> Looking at coefficients</h3>
<div class="cell">
<div class="sourceCode" id="cb493"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({</span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Coefficients&quot;</span>:pipeline[<span class="st">&#39;logisticregression&#39;</span>].coef_[<span class="dv">0</span>],</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Column&quot;</span>: [<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]</span>
<span id="cb493-4"><a href="#cb493-4" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Coefficients Column
0     -0.003078     I0
1     11.737963  PA500</code></pre>
</div>
</div>
<ul>
<li><p>“For every unit of I0 higher, we predict 0.003 <strong>lower</strong> log-odds of cancer”</p></li>
<li><p>“For every unit of PA500 higher, we predict 11.73 <strong>higher</strong> log-odds of cancer.”</p></li>
</ul>
</section>
<section id="feature-importance" class="level3" data-number="12.7.2">
<h3 data-number="12.7.2"><span class="header-section-number">12.7.2</span> Feature Importance</h3>
<ul>
<li>Does this mean that <code>PA500</code> is <em>more important</em> than <code>I0</code>?</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb495"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;PA500&quot;</span>, group <span class="op">=</span> <span class="st">&quot;Cancerous&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;Cancerous&quot;</span>))</span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density(alpha <span class="op">=</span> <span class="fl">0.5</span>, show_legend<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-264-7.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb497"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>(ggplot(df, aes(x <span class="op">=</span> <span class="st">&quot;I0&quot;</span>, group <span class="op">=</span> <span class="st">&quot;Cancerous&quot;</span>, fill <span class="op">=</span> <span class="st">&quot;Cancerous&quot;</span>))</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density(alpha <span class="op">=</span> <span class="fl">0.5</span>, show_legend<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-265-9.png" class="img-fluid" width="614" /></p>
</div>
</div>
</div>
</div>
</section>
<section id="standardization" class="level3" data-number="12.7.3">
<h3 data-number="12.7.3"><span class="header-section-number">12.7.3</span> Standardization</h3>
<ul>
<li><p>Does this mean that <code>PA500</code> is <em>more important</em> than <code>I0</code>?</p></li>
<li><p><strong>Not necessarily.</strong> They have different <em>units</em> and so the coefficients mean different things.</p></li>
<li><p>“For every <strong>1000</strong> units of I0 higher, we predict <strong>3.0 lower</strong> log-odds of cancer”</p></li>
<li><p>“For every <strong>0.1</strong> unit of PA500 higher, we predict <strong>1.1 higher</strong> log-odds of cancer.”</p></li>
<li><p>What if we had <em>standardized</em> <code>I0</code> and <code>PA500</code>?</p></li>
</ul>
</section>
<section id="standardization-1" class="level3 smaller" data-number="12.7.4">
<h3 class="smaller" data-number="12.7.4"><span class="header-section-number">12.7.4</span> Standardization</h3>
<div class="cell">
<div class="sourceCode" id="cb499"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>pipeline2 <span class="op">=</span> make_pipeline(</span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true" tabindex="-1"></a>  StandardScaler(),</span>
<span id="cb499-5"><a href="#cb499-5" aria-hidden="true" tabindex="-1"></a>  LogisticRegression(penalty<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb499-6"><a href="#cb499-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb499-7"><a href="#cb499-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-8"><a href="#cb499-8" aria-hidden="true" tabindex="-1"></a>pipeline2 <span class="op">=</span> pipeline2.fit(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]], df[<span class="st">&#39;Cancerous&#39;</span>])</span>
<span id="cb499-9"><a href="#cb499-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-10"><a href="#cb499-10" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({</span>
<span id="cb499-11"><a href="#cb499-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Coefficients&quot;</span>:pipeline2[<span class="st">&#39;logisticregression&#39;</span>].coef_[<span class="dv">0</span>],</span>
<span id="cb499-12"><a href="#cb499-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Column&quot;</span>: [<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]</span>
<span id="cb499-13"><a href="#cb499-13" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Coefficients Column
0     -2.309090     I0
1      0.801477  PA500</code></pre>
</div>
</div>
<ul>
<li><p>“For every <strong>standard deviation above the mean</strong> someone’s <code>I0</code> is, we predict <strong>2.3 lower</strong> log-odds of cancer”</p></li>
<li><p>“For every <strong>standard deviation above the mean</strong> someone’s <code>PA500</code> is, we predict <strong>0.80 higher</strong> log-odds of cancer.”</p></li>
<li><p>Therefore, <code>I0</code> is more important!</p></li>
</ul>
</section>
<section id="standardization-do-you-need-it" class="level3" data-number="12.7.5">
<h3 data-number="12.7.5"><span class="header-section-number">12.7.5</span> Standardization: Do you need it?</h3>
<p>But - did this approach change our predictions at all?</p>
<div class="cell">
<div class="sourceCode" id="cb501"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>old_probs <span class="op">=</span> pipeline.predict_proba(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>new_probs <span class="op">=</span> pipeline2.predict_proba(df[[<span class="st">&quot;I0&quot;</span>, <span class="st">&quot;PA500&quot;</span>]])</span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({</span>
<span id="cb501-5"><a href="#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;without_stdize&quot;</span>: old_probs[:,<span class="dv">1</span>], </span>
<span id="cb501-6"><a href="#cb501-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;with_stdize&quot;</span>: new_probs[:,<span class="dv">1</span>]</span>
<span id="cb501-7"><a href="#cb501-7" aria-hidden="true" tabindex="-1"></a>  }).head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   without_stdize  with_stdize
0        0.736188     0.736226
1        0.889803     0.889822
2        0.813277     0.813319
3        0.890781     0.890804
4        0.842957     0.842978</code></pre>
</div>
</div>
</section>
<section id="standardization-do-you-need-it-1" class="level3 smaller" data-number="12.7.6">
<h3 class="smaller" data-number="12.7.6"><span class="header-section-number">12.7.6</span> Standardization: Do you need it?</h3>
<ul>
<li><p>Standardizing will <strong>not change the predictions</strong> for Linear or Logistic Regression!</p></li>
<li><p>This is because the <strong>coefficients</strong> are chosen relative to the <strong>units</strong> of the predictors. (Unlike in KNN!)</p></li>
<li><p>Advantage of <em>not</em> standardizing: More interpretable coefficients</p></li>
<li><p>“For each unit of…” instead of “For each sd above the mean…”</p></li>
<li><p>Advantage of <em>standardizing</em>: Compare relative importance of predictors</p></li>
<li><p><strong>It’s up to you!</strong></p></li>
<li><p><em>(Don’t use cross-validation to decide - you’ll get the same metrics for both!)</em></p></li>
</ul>
</section>
</section>
<section id="your-turn-2" class="level2" data-number="12.8">
<h2 data-number="12.8"><span class="header-section-number">12.8</span> Your turn</h2>
<section id="activity-11" class="level3" data-number="12.8.1">
<h3 data-number="12.8.1"><span class="header-section-number">12.8.1</span> Activity</h3>
<p>For your Logistic Regression using <strong>all</strong> predictors, which two were most important?</p>
<p>How would you interpret the coefficients?</p>
</section>
</section>
<section id="takeaways-13" class="level2" data-number="12.9">
<h2 data-number="12.9"><span class="header-section-number">12.9</span> Takeaways</h2>
<section id="takeaways-14" class="level3" data-number="12.9.1">
<h3 data-number="12.9.1"><span class="header-section-number">12.9.1</span> Takeaways</h3>
<ul>
<li><p>To fit a <strong>regression model</strong> (i.e., coefficients times predictors) to a <strong>categorical response</strong>, we use <strong>Logistic Regression</strong>.</p></li>
<li><p>Coefficients are interpreted as “One unit increase in predictor is associated with a [something] increase in the log-odds of Category 1”</p></li>
<li><p>We still use <strong>cross-validated metrics</strong> to decide between KNN and Logistic regression, and between different feature sets.</p></li>
<li><p>We still report <strong>confusion matrices</strong> and sometimes <strong>precision-recall curves</strong> of our final model.</p></li>
</ul>
</section>
</section>
<section id="clustering-with-k-means" class="level1 lectitle" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Clustering with K-Means</h1>
<p><a href="slides-13-kmeans.html">Slides</a></p>
</section>
<section id="the-story-so-far-10" class="level2" data-number="13.1">
<h2 data-number="13.1"><span class="header-section-number">13.1</span> The story so far</h2>
<section id="predictive-modeling" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1"><span class="header-section-number">13.1.1</span> Predictive modeling</h3>
<ul>
<li><p>In <strong>predictive modeling</strong>, a.k.a. <strong>supervised machine learning</strong>, we have a <strong>target variable</strong> we want to predict.</p></li>
<li><p>We expect to have observations where we know the <em>predictors</em> but not the <em>target</em>.</p></li>
<li><p>Our goal is to choose a <strong>modeling procedure</strong> to guess targets from predictors.</p></li>
<li><p>We use <strong>cross-validation</strong> to estimate the <strong>test error</strong> of various procedure options.</p></li>
<li><p>We might compare different:</p>
<ul>
<li>feature sets</li>
<li>preprocessing choices</li>
<li>model specifications/algorithms</li>
<li>tuning parameters</li>
</ul></li>
</ul>
</section>
</section>
<section id="unsupervised-learning" class="level2" data-number="13.2">
<h2 data-number="13.2"><span class="header-section-number">13.2</span> Unsupervised Learning</h2>
<section id="unsupervised-learning-1" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1"><span class="header-section-number">13.2.1</span> Unsupervised Learning</h3>
<ul>
<li><p>In <strong>unsupervised</strong> situations, we do not have a target variable <span class="math inline">\(y\)</span></p></li>
<li><p>We <em>do</em> still have <strong>features</strong> that we observe.</p></li>
<li><p>Our goal: Automatically find <em>interesting structure</em> in the features.</p></li>
<li><p>(Think of children playing with Legos. They might be <em>supervised</em> by parents who help them follow instructions, or they might be left alone to build whatever they want!)</p></li>
</ul>
</section>
<section id="clustering" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2"><span class="header-section-number">13.2.2</span> Clustering</h3>
<ul>
<li><p>Nearly all unsupervised learning algorithms can be called <strong>clustering</strong>.</p></li>
<li><p>The goal is to use the <strong>observed features</strong> (columns) to sort the <strong>observations</strong> (rows) into similar <strong>clusters</strong> (groups).</p></li>
<li><p>For example: Suppose I take all of your grades in the gradebook as <em>features</em> and then use these to find <em>clusters</em> of students. These clusters might represent…</p>
<ul>
<li>people who studied together</li>
<li>people who are in the same section</li>
<li>people who have the same major or background</li>
<li>… or none of the above!</li>
</ul></li>
</ul>
</section>
<section id="uses-of-clustering" class="level3" data-number="13.2.3">
<h3 data-number="13.2.3"><span class="header-section-number">13.2.3</span> Uses of clustering</h3>
<ul>
<li><p><strong>Ecology:</strong> An ecologist wants to group organisms into types to define different species. <em>(rows = organisms; features = habitat, size, etc.)</em></p></li>
<li><p><strong>Biology:</strong> A geneticist wants to know which groups of genes tend to be activated at the same time. <em>(rows = genes; features = activation at certain times)</em></p></li>
<li><p><strong>Market Segmentation:</strong> A business wants to group their customers into types. <em>(rows = customers, features = age, location, etc.)</em></p></li>
<li><p><strong>Language:</strong> A linguist might want to identify different uses of ambiguous words like “set” or “run”. <em>(rows = words; features = other words they are used with)</em></p></li>
<li><p><strong>Documents:</strong> A historian might want to find groups of articles that are on similar topics. <em>(rows = articles; features = tf-idf transformed n-grams)</em></p></li>
</ul>
</section>
</section>
<section id="k-means" class="level2" data-number="13.3">
<h2 data-number="13.3"><span class="header-section-number">13.3</span> K-Means</h2>
<section id="the-k-means-algorithm" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1"><span class="header-section-number">13.3.1</span> The K-Means Algorithm</h3>
<ul>
<li><p><strong>Idea:</strong> Two observations are <em>similar</em> if they are <em>close</em> in distance.</p></li>
<li><p>(Just like with K-Nearest-Neighbors!)</p></li>
<li><p>We should look for groups of observations that are close to the same <strong>centroid</strong>.</p></li>
</ul>
</section>
<section id="the-k-means-algorithm-1" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2"><span class="header-section-number">13.3.2</span> The K-Means Algorithm</h3>
<p><a href="https://www.naftaliharris.com/blog/visualizing-k-means-clustering/">Demo</a></p>
<p>Procedure (3-means):</p>
<ol type="1">
<li><p>Choose 3 random observations to be the <strong>initial centroids</strong>.</p></li>
<li><p>For each observation, determine which is the <strong>closest centroid</strong>.</p></li>
<li><p>Create 3 <strong>clusters</strong> by closest centroid.</p></li>
<li><p>Find the <strong>new centroid</strong> of each cluster.</p></li>
<li><p>Repeat until the clusters don’t change.</p></li>
</ol>
</section>
<section id="example-penguins-data" class="level3" data-number="13.3.3">
<h3 data-number="13.3.3"><span class="header-section-number">13.3.3</span> Example: Penguins data</h3>
<div class="cell">
<div class="sourceCode" id="cb503"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb503-3"><a href="#cb503-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-4"><a href="#cb503-4" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">&quot;https://dlsun.github.io/stats112/data/&quot;</span></span>
<span id="cb503-5"><a href="#cb503-5" aria-hidden="true" tabindex="-1"></a>df_penguins <span class="op">=</span> pd.read_csv(data_dir <span class="op">+</span> <span class="st">&quot;penguins.csv&quot;</span>).dropna()</span>
<span id="cb503-6"><a href="#cb503-6" aria-hidden="true" tabindex="-1"></a>df_penguins</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       species     island  bill_length_mm  ...  body_mass_g     sex  year
0       Adelie  Torgersen            39.1  ...       3750.0    male  2007
1       Adelie  Torgersen            39.5  ...       3800.0  female  2007
2       Adelie  Torgersen            40.3  ...       3250.0  female  2007
4       Adelie  Torgersen            36.7  ...       3450.0  female  2007
5       Adelie  Torgersen            39.3  ...       3650.0    male  2007
..         ...        ...             ...  ...          ...     ...   ...
339  Chinstrap      Dream            55.8  ...       4000.0    male  2009
340  Chinstrap      Dream            43.5  ...       3400.0  female  2009
341  Chinstrap      Dream            49.6  ...       3775.0    male  2009
342  Chinstrap      Dream            50.8  ...       4100.0    male  2009
343  Chinstrap      Dream            50.2  ...       3775.0  female  2009

[333 rows x 8 columns]</code></pre>
</div>
</div>
</section>
<section id="example-penguins-data-1" class="level3" data-number="13.3.4">
<h3 data-number="13.3.4"><span class="header-section-number">13.3.4</span> Example: Penguins data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb505"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>(ggplot(df_penguins, aes(x <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, y <span class="op">=</span> <span class="st">&quot;flipper_length_mm&quot;</span>))</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-273-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="step-0-standardize-the-data" class="level3" data-number="13.3.5">
<h3 data-number="13.3.5"><span class="header-section-number">13.3.5</span> Step 0: Standardize the data</h3>
<p><strong>Why is this important?</strong></p>
<div class="cell">
<div class="sourceCode" id="cb507"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler().set_output(transform <span class="op">=</span> <span class="st">&quot;pandas&quot;</span>)</span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true" tabindex="-1"></a>df_scaled <span class="op">=</span> scaler.fit_transform(df_penguins[[<span class="st">&quot;bill_length_mm&quot;</span>, <span class="st">&quot;flipper_length_mm&quot;</span>]]).dropna()</span>
<span id="cb507-4"><a href="#cb507-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-5"><a href="#cb507-5" aria-hidden="true" tabindex="-1"></a>df_scaled.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bill_length_mm  flipper_length_mm
0       -0.896042          -1.426752
1       -0.822788          -1.069474
2       -0.676280          -0.426373
4       -1.335566          -0.569284
5       -0.859415          -0.783651</code></pre>
</div>
</div>
</section>
<section id="step-1-choose-3-random-points-to-be-centroids" class="level3" data-number="13.3.6">
<h3 data-number="13.3.6"><span class="header-section-number">13.3.6</span> Step 1: Choose 3 random points to be centroids</h3>
<div class="cell">
<div class="sourceCode" id="cb509"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> df_scaled.sample(<span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1234</span>)</span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true" tabindex="-1"></a>centroids.index <span class="op">=</span> [<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;green&quot;</span>]</span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-4"><a href="#cb509-4" aria-hidden="true" tabindex="-1"></a>centroids</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        bill_length_mm  flipper_length_mm
orange        1.100130           1.217106
purple        1.503027          -0.283462
green         0.257709          -0.926562</code></pre>
</div>
</div>
</section>
<section id="step-1-choose-3-random-points-to-be-centroids-1" class="level3" data-number="13.3.7">
<h3 data-number="13.3.7"><span class="header-section-number">13.3.7</span> Step 1: Choose 3 random points to be centroids</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb511"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a>(ggplot(df_scaled, aes(x <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, y <span class="op">=</span> <span class="st">&quot;flipper_length_mm&quot;</span>))</span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point()</span>
<span id="cb511-4"><a href="#cb511-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(centroids, color <span class="op">=</span> centroids.index, size <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb511-5"><a href="#cb511-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-276-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="step-2-assign-each-point-to-nearest-centroid" class="level3" data-number="13.3.8">
<h3 data-number="13.3.8"><span class="header-section-number">13.3.8</span> Step 2: Assign each point to nearest centroid</h3>
<div class="cell">
<div class="sourceCode" id="cb513"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> pairwise_distances(df_scaled, centroids)</span>
<span id="cb513-4"><a href="#cb513-4" aria-hidden="true" tabindex="-1"></a>dists[<span class="dv">1</span>:<span class="dv">5</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[2.98765095, 2.45504189, 1.08990689],
       [2.42005271, 2.18398796, 1.05949247],
       [3.02056375, 2.85294705, 1.63284194],
       [2.80050792, 2.41481315, 1.12622791]])</code></pre>
</div>
</div>
</section>
<section id="step-2-assign-each-point-to-nearest-centroid-1" class="level3" data-number="13.3.9">
<h3 data-number="13.3.9"><span class="header-section-number">13.3.9</span> Step 2: Assign each point to nearest centroid</h3>
<div class="cell">
<div class="sourceCode" id="cb515"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a>closest_centroid <span class="op">=</span> dists.argsort()[:,<span class="dv">0</span>]</span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a>closest_centroid</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 2, 1, 1, 2, 1, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 1, 1, 2, 1, 2,
       2, 2, 1, 2, 1, 1, 1, 2, 1, 2, 1, 2, 1, 1, 1, 2, 0, 2, 1, 0, 2, 1,
       2, 1, 1, 1, 0, 1, 1, 1, 1, 2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 2, 1, 2,
       1, 0, 1])</code></pre>
</div>
</div>
</section>
<section id="step-2-assign-each-point-to-nearest-centroid-2" class="level3" data-number="13.3.10">
<h3 data-number="13.3.10"><span class="header-section-number">13.3.10</span> Step 2: Assign each point to nearest centroid</h3>
<div class="cell">
<div class="sourceCode" id="cb517"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a>df_scaled.index <span class="op">=</span> centroids.index[closest_centroid]</span>
<span id="cb517-2"><a href="#cb517-2" aria-hidden="true" tabindex="-1"></a>df_scaled.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       bill_length_mm  flipper_length_mm
green       -0.896042          -1.426752
green       -0.822788          -1.069474
green       -0.676280          -0.426373
green       -1.335566          -0.569284
green       -0.859415          -0.783651</code></pre>
</div>
</div>
</section>
<section id="step-2-assign-each-point-to-nearest-centroid-3" class="level3" data-number="13.3.11">
<h3 data-number="13.3.11"><span class="header-section-number">13.3.11</span> Step 2: Assign each point to nearest centroid</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb519"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a>(ggplot(df_scaled, aes(x <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, y <span class="op">=</span> <span class="st">&quot;flipper_length_mm&quot;</span>))</span>
<span id="cb519-3"><a href="#cb519-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> df_scaled.index)</span>
<span id="cb519-4"><a href="#cb519-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(centroids, color <span class="op">=</span> centroids.index, size <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb519-5"><a href="#cb519-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-280-5.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="step-3-find-new-centroids" class="level3" data-number="13.3.12">
<h3 data-number="13.3.12"><span class="header-section-number">13.3.12</span> Step 3: Find new centroids</h3>
<div class="cell">
<div class="sourceCode" id="cb521"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> df_scaled.groupby(df_scaled.index).mean()</span>
<span id="cb521-2"><a href="#cb521-2" aria-hidden="true" tabindex="-1"></a>centroids</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        bill_length_mm  flipper_length_mm
green        -0.758955          -0.770434
orange        0.671414           1.156193
purple        1.299651          -0.204485</code></pre>
</div>
</div>
</section>
<section id="step-3-find-new-centroids-1" class="level3" data-number="13.3.13">
<h3 data-number="13.3.13"><span class="header-section-number">13.3.13</span> Step 3: Find new centroids</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb523"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb523-2"><a href="#cb523-2" aria-hidden="true" tabindex="-1"></a>(ggplot(df_scaled, aes(x <span class="op">=</span> <span class="st">&quot;bill_length_mm&quot;</span>, y <span class="op">=</span> <span class="st">&quot;flipper_length_mm&quot;</span>))</span>
<span id="cb523-3"><a href="#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(color <span class="op">=</span> df_scaled.index)</span>
<span id="cb523-4"><a href="#cb523-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_point(centroids, color <span class="op">=</span> centroids.index, size <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb523-5"><a href="#cb523-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-282-7.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="step-4-repeat-over-and-over" class="level3" data-number="13.3.14">
<h3 data-number="13.3.14"><span class="header-section-number">13.3.14</span> Step 4: Repeat over and over!</h3>
<div class="cell">
<div class="sourceCode" id="cb525"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">3</span>):</span>
<span id="cb525-2"><a href="#cb525-2" aria-hidden="true" tabindex="-1"></a>  dists <span class="op">=</span> pairwise_distances(df_scaled, centroids)</span>
<span id="cb525-3"><a href="#cb525-3" aria-hidden="true" tabindex="-1"></a>  df_scaled.index <span class="op">=</span> centroids.index[closest_centroid]</span>
<span id="cb525-4"><a href="#cb525-4" aria-hidden="true" tabindex="-1"></a>  centroids <span class="op">=</span> df_scaled.groupby(df_scaled.index).mean()</span>
<span id="cb525-5"><a href="#cb525-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(centroids)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        bill_length_mm  flipper_length_mm
green         0.671414           1.156193
orange        1.299651          -0.204485
purple       -0.758955          -0.770434
        bill_length_mm  flipper_length_mm
green         0.671414           1.156193
orange        1.299651          -0.204485
purple       -0.758955          -0.770434</code></pre>
</div>
</div>
</section>
<section id="k-means-in-sklearn" class="level3" data-number="13.3.15">
<h3 data-number="13.3.15"><span class="header-section-number">13.3.15</span> K-means in sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb527"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb527-2"><a href="#cb527-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb527-3"><a href="#cb527-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb527-4"><a href="#cb527-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb527-5"><a href="#cb527-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1234</span>)</span>
<span id="cb527-6"><a href="#cb527-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb527-7"><a href="#cb527-7" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb527-8"><a href="#cb527-8" aria-hidden="true" tabindex="-1"></a>    StandardScaler(),</span>
<span id="cb527-9"><a href="#cb527-9" aria-hidden="true" tabindex="-1"></a>    model</span>
<span id="cb527-10"><a href="#cb527-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb527-11"><a href="#cb527-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb527-12"><a href="#cb527-12" aria-hidden="true" tabindex="-1"></a>pipeline.fit(df_penguins[[<span class="st">&quot;bill_length_mm&quot;</span>, <span class="st">&quot;flipper_length_mm&quot;</span>]].dropna())</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-29 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-29 {
  color: var(--sklearn-color-text);
}

#sk-container-id-29 pre {
  padding: 0;
}

#sk-container-id-29 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-29 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-29 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-29 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-29 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-29 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-29 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-29 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-29 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-29 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-29 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-29 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-29 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-29 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-29 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-29 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-29 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-29 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-29 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-29 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-29 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-29 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-29 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-29 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-29 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-29 div.sk-label label.sk-toggleable__label,
#sk-container-id-29 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-29 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-29 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-29 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-29 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-29 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-29 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-29 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-29 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-29 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-29 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-29 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-29 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-29" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kmeans&#x27;, KMeans(n_clusters=3, random_state=1234))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-89" type="checkbox" ><label for="sk-estimator-id-89" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kmeans&#x27;, KMeans(n_clusters=3, random_state=1234))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-90" type="checkbox" ><label for="sk-estimator-id-90" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-91" type="checkbox" ><label for="sk-estimator-id-91" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KMeans<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.cluster.KMeans.html">?<span>Documentation for KMeans</span></a></label><div class="sk-toggleable__content fitted"><pre>KMeans(n_clusters=3, random_state=1234)</pre></div> </div></div></div></div></div></div>
</div>
</div>
</section>
<section id="k-means-in-sklearn-1" class="level3" data-number="13.3.16">
<h3 data-number="13.3.16"><span class="header-section-number">13.3.16</span> K-means in sklearn</h3>
<div class="cell">
<div class="sourceCode" id="cb528"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> model.cluster_centers_</span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> model.labels_</span>
<span id="cb528-3"><a href="#cb528-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-4"><a href="#cb528-4" aria-hidden="true" tabindex="-1"></a>clusters</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2,
       2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2,
       0, 2, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0,
       0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 1, 0], dtype=int32)</code></pre>
</div>
</div>
</section>
<section id="interpreting-k-means" class="level3" data-number="13.3.17">
<h3 data-number="13.3.17"><span class="header-section-number">13.3.17</span> Interpreting K-Means</h3>
<p>The key takeaway here is the <strong>cluster centers</strong>:</p>
<div class="cell">
<div class="sourceCode" id="cb530"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a>centroids</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[ 0.9235766 , -0.37501448],
       [ 0.66403058,  1.15087842],
       [-0.96427851, -0.80518575]])</code></pre>
</div>
</div>
<ul>
<li><p>Cluster 1 has long bill, shortish flipper</p></li>
<li><p>Cluster 2 has longish bill, long flipper</p></li>
<li><p>Cluster 3 has short bill, short flipper</p></li>
</ul>
</section>
<section id="interpreting-k-means-1" class="level3" data-number="13.3.18">
<h3 data-number="13.3.18"><span class="header-section-number">13.3.18</span> Interpreting K-Means</h3>
<p>We also might check if these clusters match any labels that we already know:</p>
<div class="cell">
<div class="sourceCode" id="cb532"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;cluster&quot;</span>: clusters,</span>
<span id="cb532-3"><a href="#cb532-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;species&quot;</span>: df_penguins[<span class="st">&#39;species&#39;</span>]</span>
<span id="cb532-4"><a href="#cb532-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb532-5"><a href="#cb532-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-6"><a href="#cb532-6" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     cluster    species
0          2     Adelie
1          2     Adelie
2          2     Adelie
4          2     Adelie
5          2     Adelie
..       ...        ...
339        0  Chinstrap
340        0  Chinstrap
341        0  Chinstrap
342        1  Chinstrap
343        0  Chinstrap

[333 rows x 2 columns]</code></pre>
</div>
</div>
</section>
<section id="interpreting-k-means-2" class="level3" data-number="13.3.19">
<h3 data-number="13.3.19"><span class="header-section-number">13.3.19</span> Interpreting K-Means</h3>
<p>We also might check if these clusters match any labels that we already know:</p>
<div class="cell">
<div class="sourceCode" id="cb534"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a>results.value_counts([<span class="st">&quot;cluster&quot;</span>, <span class="st">&quot;species&quot;</span>]).unstack()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>species  Adelie  Chinstrap  Gentoo
cluster                           
0           4.0       59.0     1.0
1           1.0        4.0   118.0
2         141.0        5.0     NaN</code></pre>
</div>
</div>
</section>
</section>
<section id="your-turn-3" class="level2" data-number="13.4">
<h2 data-number="13.4"><span class="header-section-number">13.4</span> Your Turn</h2>
<section id="activity-12" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1"><span class="header-section-number">13.4.1</span> Activity</h3>
<ul>
<li><p>Fit a 3-means model using <em>all</em> the numeric predictors in the penguins data.</p></li>
<li><p>Describe each cluster</p></li>
<li><p>Do these clusters match up to the species?</p></li>
<li><p>Then fit a 6-means model</p></li>
<li><p>Do those clusters match up to species and island?</p></li>
</ul>
</section>
</section>
<section id="takeaways-15" class="level2" data-number="13.5">
<h2 data-number="13.5"><span class="header-section-number">13.5</span> Takeaways</h2>
<section id="takeaways-16" class="level3" data-number="13.5.1">
<h3 data-number="13.5.1"><span class="header-section-number">13.5.1</span> Takeaways</h3>
<ul>
<li><p><strong>unsupervised learning</strong> is a way to find <em>structure</em> in data</p></li>
<li><p><strong>k-means</strong> is the most common <strong>clustering method</strong></p></li>
<li><p>We <strong>have to choose K ahead of time</strong></p></li>
<li><p>(This is a big problem! Why can’t we tune?)</p></li>
</ul>
</section>
</section>
<section id="merging-data" class="level1 lectitle" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Merging Data</h1>
<p><a href="slides-14-merge.html">Slides</a></p>
</section>
<section id="the-story-so-far-11" class="level2" data-number="14.1">
<h2 data-number="14.1"><span class="header-section-number">14.1</span> The story so far</h2>
<section id="data-analysis-the-whole-game" class="level3" data-number="14.1.1">
<h3 data-number="14.1.1"><span class="header-section-number">14.1.1</span> Data analysis: the whole game</h3>
<ul>
<li><p><strong>Acquire</strong> data and <strong>clean</strong> it by fixing variable types, dropping or replacing missing data, and looking for other issues.</p></li>
<li><p><strong>Explore</strong> the dataset by making summaries and plots of <em>one variable</em>.</p></li>
<li><p>Establish <strong>research questions</strong> to answer with this data.</p></li>
<li><p>Create <strong>visualizations</strong> of <em>two or more variables</em> that address simple questions.</p></li>
<li><p>Fit <strong>predictive models</strong> to address more complex questions, and/or to prepare for prediction on future data.</p></li>
<li><p>Fit <strong>unsupervised models</strong> to answer open-ended questions.</p></li>
</ul>
</section>
</section>
<section id="joining-on-a-key" class="level2" data-number="14.2">
<h2 data-number="14.2"><span class="header-section-number">14.2</span> Joining on a Key</h2>
<section id="example-planes-and-flights" class="level3" data-number="14.2.1">
<h3 data-number="14.2.1"><span class="header-section-number">14.2.1</span> Example: Planes and flights</h3>
<ul>
<li><p>Sometimes, information is spread across multiple data sets.</p></li>
<li><p>For example, suppose we want to know which manufacturer’s planes made the most flights in November 2013.</p></li>
<li><p>One data set contains information about flights in Nov. 2013…</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb536"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">&quot;https://datasci112.stanford.edu/data/nycflights13/&quot;</span></span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>df_flights <span class="op">=</span> pd.read_csv(<span class="ss">f&quot;</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">/flights11.csv&quot;</span>)</span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>df_flights.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year  month  day  dep_time  ...  distance  hour  minute  tailnum
0  2013     11    1    2108.0  ...      1167    20      56   N10156
1  2013     11    1    1154.0  ...       541    12       0   N102UW
2  2013     11    1     854.0  ...       946     8      29   N10575
3  2013     11    1    1643.0  ...       594    15       5   N10575
4  2013     11    1     603.0  ...       282     6       0   N11109

[5 rows x 18 columns]</code></pre>
</div>
</div>
</section>
<section id="example-planes-and-flights-1" class="level3" data-number="14.2.2">
<h3 data-number="14.2.2"><span class="header-section-number">14.2.2</span> Example: Planes and Flights</h3>
<p>…while another contains information about planes.</p>
<div class="cell">
<div class="sourceCode" id="cb538"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a>df_planes <span class="op">=</span> pd.read_csv(<span class="ss">f&quot;</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">/planes.csv&quot;</span>)</span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a>df_planes.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tailnum    year                     type  ... seats speed     engine
0  N10156  2004.0  Fixed wing multi engine  ...    55   NaN  Turbo-fan
1  N102UW  1998.0  Fixed wing multi engine  ...   182   NaN  Turbo-fan
2  N103US  1999.0  Fixed wing multi engine  ...   182   NaN  Turbo-fan
3  N104UW  1999.0  Fixed wing multi engine  ...   182   NaN  Turbo-fan
4  N10575  2002.0  Fixed wing multi engine  ...    55   NaN  Turbo-fan

[5 rows x 9 columns]</code></pre>
</div>
</div>
<p>In order to answer the question of which manufacturer made the most flights, we have to join these two data sets together.</p>
</section>
<section id="keys" class="level3" data-number="14.2.3">
<h3 data-number="14.2.3"><span class="header-section-number">14.2.3</span> Keys</h3>
<ul>
<li><p>A <strong>primary key</strong> is a column (or a set of columns) that uniquely identifies observations in a data frame.</p></li>
<li><p>The <strong>primary key</strong> is the column(s) you would think of as the <strong>index</strong>.</p></li>
<li><p>A <strong>foreign key</strong> is a column (or a set of columns) that points to the primary key of another data frame.</p></li>
<li><p>Planes are uniquely identified by their <em>tail number</em> (<code>tailnum</code>).</p></li>
</ul>
</section>
<section id="joining-on-a-key-1" class="level3" data-number="14.2.4">
<h3 data-number="14.2.4"><span class="header-section-number">14.2.4</span> Joining on a Key</h3>
<p>Each value of the <strong>primary key</strong> should only appear once, but it could appear many times in a <strong>foreign key</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb540"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a>df_flights[<span class="st">&#39;tailnum&#39;</span>].value_counts().head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tailnum
N353JB    48
N955UW    47
N184JB    47
N375JB    42
N281JB    42
Name: count, dtype: int64</code></pre>
</div>
<div class="sourceCode" id="cb542"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>df_planes[<span class="st">&#39;tailnum&#39;</span>].value_counts().head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tailnum
N10156    1
N709EV    1
N706JB    1
N706SW    1
N706TW    1
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="joining-on-a-key-2" class="level3" data-number="14.2.5">
<h3 data-number="14.2.5"><span class="header-section-number">14.2.5</span> Joining on a Key</h3>
<p>The Pandas function <code>.merge()</code> can be used to join two <code>DataFrame</code>s on a key.</p>
<div class="cell">
<div class="sourceCode" id="cb544"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a>df_joined <span class="op">=</span> df_flights.merge(df_planes, on<span class="op">=</span><span class="st">&quot;tailnum&quot;</span>)</span>
<span id="cb544-2"><a href="#cb544-2" aria-hidden="true" tabindex="-1"></a>df_joined.head()   </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year_x  month  day  dep_time  ...  engines  seats  speed     engine
0    2013     11    1    2108.0  ...        2     55    NaN  Turbo-fan
1    2013     11    1    1154.0  ...        2    182    NaN  Turbo-fan
2    2013     11    1     854.0  ...        2     55    NaN  Turbo-fan
3    2013     11    1    1643.0  ...        2     55    NaN  Turbo-fan
4    2013     11    1     603.0  ...        2     55    NaN  Turbo-fan

[5 rows x 26 columns]</code></pre>
</div>
</div>
</section>
<section id="overlapping-column-names" class="level3" data-number="14.2.6">
<h3 data-number="14.2.6"><span class="header-section-number">14.2.6</span> Overlapping Column Names</h3>
<ul>
<li><p>Joining two data frames results in a <em>wider</em> data frame, with more columns.</p></li>
<li><p>By default, Pandas adds the suffixes <code>_x</code> and <code>_y</code> to overlapping column names, but this can be customized.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb546"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a>df_joined <span class="op">=</span> df_flights.merge(df_planes, on<span class="op">=</span><span class="st">&quot;tailnum&quot;</span>,</span>
<span id="cb546-2"><a href="#cb546-2" aria-hidden="true" tabindex="-1"></a>                             suffixes<span class="op">=</span>(<span class="st">&quot;_flight&quot;</span>, <span class="st">&quot;_plane&quot;</span>))</span>
<span id="cb546-3"><a href="#cb546-3" aria-hidden="true" tabindex="-1"></a>df_joined.columns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index([&#39;year_flight&#39;, &#39;month&#39;, &#39;day&#39;, &#39;dep_time&#39;, &#39;sched_dep_time&#39;,
       &#39;dep_delay&#39;, &#39;arr_time&#39;, &#39;sched_arr_time&#39;, &#39;arr_delay&#39;, &#39;carrier&#39;,
       &#39;flight&#39;, &#39;origin&#39;, &#39;dest&#39;, &#39;air_time&#39;, &#39;distance&#39;, &#39;hour&#39;, &#39;minute&#39;,
       &#39;tailnum&#39;, &#39;year_plane&#39;, &#39;type&#39;, &#39;manufacturer&#39;, &#39;model&#39;, &#39;engines&#39;,
       &#39;seats&#39;, &#39;speed&#39;, &#39;engine&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
</section>
<section id="analyzing-the-joined-data" class="level3" data-number="14.2.7">
<h3 data-number="14.2.7"><span class="header-section-number">14.2.7</span> Analyzing the Joined Data</h3>
<p>Now that we have joined the two data sets, we can answer the question: which manufacturer’s planes made the most flights?</p>
<div class="cell">
<div class="sourceCode" id="cb548"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a>df_joined[<span class="st">&quot;manufacturer&quot;</span>].value_counts()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>manufacturer
BOEING                           6557
EMBRAER                          5175
AIRBUS                           3954
AIRBUS INDUSTRIE                 3456
BOMBARDIER INC                   2632
MCDONNELL DOUGLAS AIRCRAFT CO     811
MCDONNELL DOUGLAS                 330
CANADAIR                          122
MCDONNELL DOUGLAS CORPORATION     121
CESSNA                             36
CIRRUS DESIGN CORP                 21
ROBINSON HELICOPTER CO             19
BARKER JACK L                      15
PIPER                               9
FRIEDEMANN JON                      8
SIKORSKY                            6
BELL                                5
DEHAVILLAND                         4
AGUSTA SPA                          3
AMERICAN AIRCRAFT INC               3
DOUGLAS                             2
LAMBERT RICHARD                     2
KILDALL GARY                        2
LEARJET INC                         2
MARZ BARRY                          1
AVIAT AIRCRAFT INC                  1
PAIR MIKE E                         1
LEBLANC GLENN T                     1
STEWART MACO                        1
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="joining-on-multiple-keys" class="level2" data-number="14.3">
<h2 data-number="14.3"><span class="header-section-number">14.3</span> Joining on Multiple Keys</h2>
<section id="example-weather-and-flights" class="level3" data-number="14.3.1">
<h3 data-number="14.3.1"><span class="header-section-number">14.3.1</span> Example: Weather and Flights</h3>
<ul>
<li><p>Research question: What weather factors cause flight delays?</p></li>
<li><p>Here is a data set containing hourly weather data at each airport in 2013.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb550"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a>df_weather <span class="op">=</span> pd.read_csv(<span class="ss">f&quot;</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">/weather.csv&quot;</span>)</span>
<span id="cb550-2"><a href="#cb550-2" aria-hidden="true" tabindex="-1"></a>df_weather.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  airport  year  month  day  ...  wind_gust  precip  pressure  visib
0     EWR  2013      1    1  ...        NaN     0.0    1012.0   10.0
1     EWR  2013      1    1  ...        NaN     0.0    1012.3   10.0
2     EWR  2013      1    1  ...        NaN     0.0    1012.5   10.0
3     EWR  2013      1    1  ...        NaN     0.0    1012.2   10.0
4     EWR  2013      1    1  ...        NaN     0.0    1011.9   10.0

[5 rows x 14 columns]</code></pre>
</div>
</div>
<p><strong>What is the primary key of this data set?</strong></p>
</section>
<section id="a-key-with-multiple-columns" class="level3" data-number="14.3.2">
<h3 data-number="14.3.2"><span class="header-section-number">14.3.2</span> A Key with Multiple Columns</h3>
<p>Let’s start by looking at flights out of JFK only, for simplicity.</p>
<p>We need to join to the weather data on year, month, day, and hour.</p>
<div class="cell">
<div class="sourceCode" id="cb552"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a>df_flights_jfk <span class="op">=</span> df_flights[df_flights[<span class="st">&quot;origin&quot;</span>] <span class="op">==</span> <span class="st">&quot;JFK&quot;</span>]</span>
<span id="cb552-2"><a href="#cb552-2" aria-hidden="true" tabindex="-1"></a>df_weather_jfk <span class="op">=</span> df_weather[df_weather[<span class="st">&quot;airport&quot;</span>] <span class="op">==</span> <span class="st">&quot;JFK&quot;</span>]</span>
<span id="cb552-3"><a href="#cb552-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-4"><a href="#cb552-4" aria-hidden="true" tabindex="-1"></a>df_jfk <span class="op">=</span> df_flights_jfk.merge(df_weather_jfk, on<span class="op">=</span>(<span class="st">&quot;year&quot;</span>,<span class="st">&quot;month&quot;</span>,<span class="st">&quot;day&quot;</span>,<span class="st">&quot;hour&quot;</span>))</span>
<span id="cb552-5"><a href="#cb552-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-6"><a href="#cb552-6" aria-hidden="true" tabindex="-1"></a>df_jfk.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year  month  day  dep_time  ...  wind_gust  precip  pressure  visib
0  2013     11    1    1154.0  ...        NaN    0.00    1002.8   10.0
1  2013     11    1    2055.0  ...        NaN    0.00    1005.0   10.0
2  2013     11    1    1814.0  ...        NaN    0.00    1003.9   10.0
3  2013     11    1    1014.0  ...        NaN    0.07       NaN   10.0
4  2013     11    1    1852.0  ...        NaN    0.00    1003.9   10.0

[5 rows x 28 columns]</code></pre>
</div>
</div>
</section>
<section id="lets-see-how-rain-affects-departure-delays." class="level3" data-number="14.3.3">
<h3 data-number="14.3.3"><span class="header-section-number">14.3.3</span> Let’s see how rain affects departure delays.</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb554"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-3"><a href="#cb554-3" aria-hidden="true" tabindex="-1"></a>(ggplot(df_jfk, aes(x<span class="op">=</span><span class="st">&quot;precip&quot;</span>, y<span class="op">=</span><span class="st">&quot;dep_delay&quot;</span>)) <span class="op">+</span></span>
<span id="cb554-4"><a href="#cb554-4" aria-hidden="true" tabindex="-1"></a>geom_point(alpha<span class="op">=</span><span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb554-5"><a href="#cb554-5" aria-hidden="true" tabindex="-1"></a>theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/plotnine/layer.py:364: PlotnineWarning: geom_point : Removed 12 rows containing missing values.
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-300-1.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
<section id="joining-on-keys-with-different-names" class="level3" data-number="14.3.4">
<h3 data-number="14.3.4"><span class="header-section-number">14.3.4</span> Joining on Keys with Different Names</h3>
<ul>
<li><p>Sometimes, the join keys have different names in the two data sets.</p></li>
<li><p>This frequently happens if the data sets come from different sources.</p></li>
<li><p>For example, if we want to join the (entire) flights data to the weather data, we would need to include the <em>airport</em> in the key.</p></li>
<li><p>But the airport is called <code>origin</code> in <code>df_flights</code> and <code>airport</code> in <code>df_weather</code>.</p></li>
<li><p>The <code>.merge()</code> function provides <code>left_on=</code> and <code>right_on=</code> arguments for specifying different column names in the <strong>left</strong> (first) and <strong>right</strong> (second) data frames.</p></li>
</ul>
</section>
<section id="joining-on-keys-with-different-names-1" class="level3" data-number="14.3.5">
<h3 data-number="14.3.5"><span class="header-section-number">14.3.5</span> Joining on Keys with Different Names</h3>
<div class="cell">
<div class="sourceCode" id="cb556"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a>df_flights_weather <span class="op">=</span> df_flights.merge(</span>
<span id="cb556-2"><a href="#cb556-2" aria-hidden="true" tabindex="-1"></a>    df_weather,</span>
<span id="cb556-3"><a href="#cb556-3" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;hour&quot;</span>),</span>
<span id="cb556-4"><a href="#cb556-4" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span>(<span class="st">&quot;airport&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;hour&quot;</span>))</span></code></pre></div>
</div>
</section>
<section id="rain-and-delays-by-airport" class="level3" data-number="14.3.6">
<h3 data-number="14.3.6"><span class="header-section-number">14.3.6</span> Rain and delays by airport</h3>
<p>Now we can visualize how rain impacts delays at each airport:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode" id="cb557"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a>df_rain <span class="op">=</span> df_flights_weather.groupby([<span class="st">&quot;airport&quot;</span>, <span class="st">&quot;precip&quot;</span>])[<span class="st">&quot;dep_delay&quot;</span>].mean().to_frame().reset_index()</span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb557-3"><a href="#cb557-3" aria-hidden="true" tabindex="-1"></a>(ggplot(df_rain, aes(x<span class="op">=</span><span class="st">&#39;precip&#39;</span>, y<span class="op">=</span><span class="st">&#39;dep_delay&#39;</span>, color <span class="op">=</span> <span class="st">&#39;airport&#39;</span>)) <span class="op">+</span></span>
<span id="cb557-4"><a href="#cb557-4" aria-hidden="true" tabindex="-1"></a>geom_point() <span class="op">+</span></span>
<span id="cb557-5"><a href="#cb557-5" aria-hidden="true" tabindex="-1"></a>geom_line() <span class="op">+</span></span>
<span id="cb557-6"><a href="#cb557-6" aria-hidden="true" tabindex="-1"></a>theme_classic())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:2: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-302-3.png" class="img-fluid" width="614" /></p>
</div>
</div>
</section>
</section>
<section id="joins-with-missing-keys" class="level2" data-number="14.4">
<h2 data-number="14.4"><span class="header-section-number">14.4</span> Joins with missing keys</h2>
<section id="example-baby-names" class="level3" data-number="14.4.1">
<h3 data-number="14.4.1"><span class="header-section-number">14.4.1</span> Example: Baby names</h3>
<p>The data below contains counts of names for babies born in 1920 and 2020:</p>
<div class="cell">
<div class="sourceCode" id="cb559"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">&quot;http://dlsun.github.io/pods/data/names/&quot;</span></span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a>df_1920 <span class="op">=</span> pd.read_csv(data_dir <span class="op">+</span> <span class="st">&quot;yob1920.txt&quot;</span>, header<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb559-5"><a href="#cb559-5" aria-hidden="true" tabindex="-1"></a>                      names<span class="op">=</span>[<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Count&quot;</span>])</span>
<span id="cb559-6"><a href="#cb559-6" aria-hidden="true" tabindex="-1"></a>df_2020 <span class="op">=</span> pd.read_csv(data_dir <span class="op">+</span> <span class="st">&quot;yob2020.txt&quot;</span>, header<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb559-7"><a href="#cb559-7" aria-hidden="true" tabindex="-1"></a>                      names<span class="op">=</span>[<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Count&quot;</span>])</span>
<span id="cb559-8"><a href="#cb559-8" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb559-9"><a href="#cb559-9" aria-hidden="true" tabindex="-1"></a>df_1920.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Name Sex  Count
0      Mary   F  70975
1   Dorothy   F  36645
2     Helen   F  35098
3  Margaret   F  27997
4      Ruth   F  26100</code></pre>
</div>
<div class="sourceCode" id="cb561"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a>df_2020.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Name Sex  Count
0     Olivia   F  17641
1       Emma   F  15656
2        Ava   F  13160
3  Charlotte   F  13065
4     Sophia   F  13036</code></pre>
</div>
</div>
</section>
<section id="joins" class="level3" data-number="14.4.2">
<h3 data-number="14.4.2"><span class="header-section-number">14.4.2</span> Joins</h3>
<p>We can merge these two datasets on a primary key…</p>
<div class="cell">
<div class="sourceCode" id="cb563"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>df_joined <span class="op">=</span> df_1920.merge(df_2020, on<span class="op">=</span>[<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Sex&quot;</span>], suffixes<span class="op">=</span>(<span class="st">&quot;_1920&quot;</span>, <span class="st">&quot;_2020&quot;</span>))</span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>df_joined.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Name Sex  Count_1920  Count_2020
0      Mary   F       70975        2210
1   Dorothy   F       36645         562
2     Helen   F       35098         721
3  Margaret   F       27997        2190
4      Ruth   F       26100        1323</code></pre>
</div>
</div>
</section>
<section id="missing-keys" class="level3" data-number="14.4.3">
<h3 data-number="14.4.3"><span class="header-section-number">14.4.3</span> Missing Keys?</h3>
<p>… but what happened to some of the names?</p>
<div class="cell">
<div class="sourceCode" id="cb565"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a>df_joined[df_joined[<span class="st">&quot;Name&quot;</span>] <span class="op">==</span> <span class="st">&quot;Maya&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: [Name, Sex, Count_1920, Count_2020]
Index: []</code></pre>
</div>
</div>
</section>
<section id="missing-keys-1" class="level3" data-number="14.4.4">
<h3 data-number="14.4.4"><span class="header-section-number">14.4.4</span> Missing keys</h3>
<ul>
<li>Why isn’t Maya in the joined data?</li>
</ul>
<p>It is there in the 2020 data…</p>
<div class="cell">
<div class="sourceCode" id="cb567"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a>df_2020[df_2020[<span class="st">&quot;Name&quot;</span>] <span class="op">==</span> <span class="st">&quot;Maya&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Name Sex  Count
60     Maya   F   3724
28914  Maya   M      6</code></pre>
</div>
</div>
<p>…but not in the 1920 data.</p>
<div class="cell">
<div class="sourceCode" id="cb569"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a>df_1920[df_1920[<span class="st">&quot;Name&quot;</span>] <span class="op">==</span> <span class="st">&quot;Maya&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Empty DataFrame
Columns: [Name, Sex, Count]
Index: []</code></pre>
</div>
</div>
</section>
<section id="missing-keys-2" class="level3" data-number="14.4.5">
<h3 data-number="14.4.5"><span class="header-section-number">14.4.5</span> Missing keys</h3>
<ul>
<li><p>How does the <code>merge()</code> function determine which keys get kept?</p></li>
<li><p>By default, in order to appear in the joined data, a key must be present in <em>both</em> tables.</p></li>
</ul>
</section>
</section>
<section id="other-types-of-joins" class="level2" data-number="14.5">
<h2 data-number="14.5"><span class="header-section-number">14.5</span> Other Types of Joins</h2>
<section id="types-of-joins" class="level3" data-number="14.5.1">
<h3 data-number="14.5.1"><span class="header-section-number">14.5.1</span> Types of Joins</h3>
<ul>
<li><p>How can we customize the behavior of joins for missing keys?</p></li>
<li><p>By default, Pandas does an <strong>inner join</strong>, which only keeps keys that are present in <em>both</em> tables.</p></li>
<li><p>An <strong>outer join</strong> keeps any key that is present in either table.</p></li>
<li><p>A <strong>left join</strong> keeps all keys in the left table, even if they are not in the right table. But any keys that are only in the right table are dropped.</p></li>
<li><p>A <strong>right join</strong> keeps all keys in the right table, even if they are not in the left table. But any keys that are only in the left table are dropped.</p></li>
</ul>
</section>
<section id="types-of-joins-1" class="level3" data-number="14.5.2">
<h3 data-number="14.5.2"><span class="header-section-number">14.5.2</span> Types of joins</h3>
<p>We can customize the type of join using the <code>how=</code> parameter of <code>.merge()</code>. By default, <code>how="inner"</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb571"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a>df_joined_outer <span class="op">=</span> df_1920.merge(df_2020, on<span class="op">=</span>[<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Sex&quot;</span>],</span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a>                                how<span class="op">=</span><span class="st">&quot;outer&quot;</span>)</span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a>df_joined_outer[df_joined_outer[<span class="st">&quot;Name&quot;</span>] <span class="op">==</span> <span class="st">&quot;Maya&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Name Sex  Count_x  Count_y
24999  Maya   F      NaN   3724.0
25000  Maya   M      NaN      6.0</code></pre>
</div>
</div>
</section>
<section id="types-of-joins-2" class="level3" data-number="14.5.3">
<h3 data-number="14.5.3"><span class="header-section-number">14.5.3</span> Types of Joins</h3>
<ul>
<li><p>Note the missing values for other columns, like Count, for 1920!</p></li>
<li><p>What other type of join would have produced this output in the Maya row?</p></li>
</ul>
</section>
<section id="types-of-joins-3" class="level3" data-number="14.5.4">
<h3 data-number="14.5.4"><span class="header-section-number">14.5.4</span> Types of Joins</h3>
<ul>
<li><p>Note the missing values for other columns, like Count, for 1920!</p></li>
<li><p>What other type of join would have produced this output in the Maya row?</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb573"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a>df_joined_right <span class="op">=</span> df_1920.merge(df_2020, on<span class="op">=</span>[<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Sex&quot;</span>],</span>
<span id="cb573-2"><a href="#cb573-2" aria-hidden="true" tabindex="-1"></a>                                how<span class="op">=</span><span class="st">&quot;right&quot;</span>)</span>
<span id="cb573-3"><a href="#cb573-3" aria-hidden="true" tabindex="-1"></a>df_joined_right[df_joined_right[<span class="st">&quot;Name&quot;</span>] <span class="op">==</span> <span class="st">&quot;Maya&quot;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Name Sex  Count_x  Count_y
60     Maya   F      NaN     3724
28914  Maya   M      NaN        6</code></pre>
</div>
</div>
</section>
</section>
<section id="types-of-joins-4" class="level2" data-number="14.6">
<h2 data-number="14.6"><span class="header-section-number">14.6</span> Types of Joins</h2>
<p><img src="./images/joins.png" class="img-fluid" /></p>
<section id="quick-quiz-1" class="level3" data-number="14.6.1">
<h3 data-number="14.6.1"><span class="header-section-number">14.6.1</span> Quick Quiz</h3>
<p>Which type of join would be best suited for each case?</p>
<ol type="1">
<li><p>We want to determine the names that have increased in popularity the most between 1920 and 2020.</p></li>
<li><p>We want to graph the popularity of names over time.</p></li>
<li><p>We want to determine the names that have decreased in popularity the most between 1920 and 2020.</p></li>
</ol>
</section>
</section>
<section id="many-to-many-joins" class="level2" data-number="14.7">
<h2 data-number="14.7"><span class="header-section-number">14.7</span> Many-to-Many Joins</h2>
<section id="many-to-many-relationships" class="level3 smaller" data-number="14.7.1">
<h3 class="smaller" data-number="14.7.1"><span class="header-section-number">14.7.1</span> Many-to-Many Relationships</h3>
<ul>
<li><p>So far, the keys we’ve joined on have been the primary key of (at least) one table.</p></li>
<li><p>If we join to the primary key of another table, then the relationship is <strong>one-to-one</strong> (since primary keys uniquely identify rows).</p></li>
<li><p>If we join to the foreign key of another table, then the relationship is <strong>one-to-many</strong>.</p></li>
<li><p>What if we join on a key that is not a primary key?</p></li>
<li><p>That is, what if the key does not uniquely identify rows in either table so that each value of the key might appear multiple times?</p></li>
<li><p>This relaionship is called <strong>many-to-many</strong>.</p></li>
</ul>
</section>
<section id="many-to-many-example" class="level3" data-number="14.7.2">
<h3 data-number="14.7.2"><span class="header-section-number">14.7.2</span> Many-to-Many Example</h3>
<p>What if we only joined on the name?</p>
<div class="cell">
<div class="sourceCode" id="cb575"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a>df_1920.merge(df_2020, on<span class="op">=</span><span class="st">&quot;Name&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Name Sex_x  Count_x Sex_y  Count_y
0         Mary     F    70975     F     2210
1         Mary     F    70975     M        5
2      Dorothy     F    36645     F      562
3        Helen     F    35098     F      721
4     Margaret     F    27997     F     2190
...        ...   ...      ...   ...      ...
6158    Xavier     M        5     M     3876
6159      York     M        5     F        6
6160      York     M        5     M       14
6161      Zeke     M        5     M      382
6162      Zera     M        5     F       11

[6163 rows x 5 columns]</code></pre>
</div>
</div>
</section>
<section id="preventing-bugs" class="level3" data-number="14.7.3">
<h3 data-number="14.7.3"><span class="header-section-number">14.7.3</span> Preventing Bugs</h3>
<ul>
<li><p>Most of the time, many-to-many joins are a bug, caused by a misunderstanding about the primary key.</p></li>
<li><p>Pandas allows us to specify the relationship we are expecting. It will fail with an error if the relationship is a different kind.</p></li>
<li><p>For example, suppose we thought that “name” was the primary key of the baby name tables.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb577"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a>df_1920.merge(df_2020, on<span class="op">=</span><span class="st">&quot;Name&quot;</span>,</span>
<span id="cb577-2"><a href="#cb577-2" aria-hidden="true" tabindex="-1"></a>              validate<span class="op">=</span><span class="st">&quot;one_to_one&quot;</span>)</span></code></pre></div>
</div>
<pre><code>MergeError: Merge keys are not unique in either left or right dataset; not a one-to-one merge</code></pre>
<p>Errors are (sometimes) your friend. They can prevent you from making even bigger mistakes!</p>
</section>
</section>
<section id="filtering-joins" class="level2" data-number="14.8">
<h2 data-number="14.8"><span class="header-section-number">14.8</span> Filtering Joins</h2>
<section id="filtering-joins-1" class="level3 smaller" data-number="14.8.1">
<h3 class="smaller" data-number="14.8.1"><span class="header-section-number">14.8.1</span> Filtering Joins</h3>
<ul>
<li><p>Inner, outer, left, and right are known as <strong>mutating joins</strong>, because they create new combined datasets.</p></li>
<li><p>There are two other types of joins that we use for <strong>filtering</strong> to get rid of some rows:</p></li>
<li><p>A <strong>semi-join</strong> tells us which keys in the <em>left</em> <strong>are</strong> present in the <em>right</em>.</p></li>
<li><p>An <strong>anti-join</strong> tells us which keys in the left <strong>are not</strong> present in the right.</p></li>
<li><p>In Pandas, we can’t do these using <code>.merge()</code></p></li>
</ul>
</section>
<section id="filtering-joins-2" class="level3" data-number="14.8.2">
<h3 data-number="14.8.2"><span class="header-section-number">14.8.2</span> Filtering joins</h3>
<p>Which names existed in 1920 but don’t in 2020?</p>
<div class="cell">
<div class="sourceCode" id="cb579"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a>in_both <span class="op">=</span> df_1920[<span class="st">&#39;Name&#39;</span>].isin(df_2020[<span class="st">&#39;Name&#39;</span>])</span>
<span id="cb579-2"><a href="#cb579-2" aria-hidden="true" tabindex="-1"></a>df_1920.loc[<span class="op">~</span>in_both, <span class="st">&#39;Name&#39;</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>67          Myrtle
245            Sue
257         Nannie
284         Virgie
300      Bernadine
           ...    
10748         Ynes
10750     Zaragoza
10751        Zearl
10752     Zeferino
10755      Zygmont
Name: Name, Length: 5638, dtype: object</code></pre>
</div>
</div>
</section>
<section id="your-turn-4" class="level3" data-number="14.8.3">
<h3 data-number="14.8.3"><span class="header-section-number">14.8.3</span> Your turn</h3>
<ul>
<li><p>Did your name exist in 2020 but not 1920?</p></li>
<li><p>If so, how has the popularity changed?</p></li>
</ul>
</section>
</section>
<section id="takeaways-17" class="level2" data-number="14.9">
<h2 data-number="14.9"><span class="header-section-number">14.9</span> Takeaways</h2>
<section id="takeaways-18" class="level3" data-number="14.9.1">
<h3 data-number="14.9.1"><span class="header-section-number">14.9.1</span> Takeaways</h3>
<ul>
<li><p>A <strong>primary key</strong> is one or more columns that uniquely indentify the rows.</p></li>
<li><p>We can <strong>join</strong> (a.k.a. <strong>merge</strong>) datasets if they share a primary key, or if one has a <strong>foreign key</strong>.</p></li>
<li><p>The default of <code>.merge()</code> is an <em>inner join</em>: only keys in both datasets are kept.</p></li>
<li><p>We can instead specify a <em>left join</em>, <em>right join</em>, or <em>outer join</em>; think about which rows we want to keep.</p></li>
<li><p><strong>Filterting joins</strong> like <em>anti-join</em> and <em>semi-join</em> can help you answer questions about the data.</p></li>
<li><p>Use <code>.isin()</code> to see which keys in one dataset exist in the other.</p></li>
</ul>
</section>
</section>
<section id="hierarchical-data-and-apis" class="level1 lectitle" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Hierarchical Data and APIs</h1>
<p><a href="slides-15-hierarchical.html">Slides</a></p>
</section>
<section id="the-story-so-far-12" class="level2" data-number="15.1">
<h2 data-number="15.1"><span class="header-section-number">15.1</span> The story so far</h2>
<section id="tabular-data-and-indiceskeys" class="level3" data-number="15.1.1">
<h3 data-number="15.1.1"><span class="header-section-number">15.1.1</span> Tabular data and indices/keys</h3>
<ul>
<li><p>Thus far, we have only dealt with <strong>tabular data</strong> that can be represented with <strong>rows</strong> and <strong>columns</strong>.</p></li>
<li><p>It is important to determine what <strong>each row represents</strong> because…</p>
<ul>
<li>You want to make sure you understand your data</li>
<li>You might want to set an <strong>index</strong></li>
<li>You might want to find a <strong>key</strong> to merge on</li>
</ul></li>
<li><p>So far, we have read data in from <code>.csv</code> files or <code>.txt</code> files.</p></li>
</ul>
</section>
</section>
<section id="json-data" class="level2" data-number="15.2">
<h2 data-number="15.2"><span class="header-section-number">15.2</span> JSON data</h2>
<section id="json-data-1" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1"><span class="header-section-number">15.2.1</span> JSON data</h3>
<ul>
<li><p>The most common non-tabular data file type is called <strong>JSON</strong> (<em>JavaScript Object Notation</em>)</p></li>
<li><p>Information is stored in <em>nested dictionaries</em>.</p></li>
<li><p>This type of data is called <strong>hierarchical</strong>, because it has multiple levels</p></li>
<li><p>It can be helpful to picture the data like a <strong>tree</strong></p></li>
<li><p>You can think of this a bit like folders on your computer</p></li>
</ul>
</section>
<section id="example-4" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2"><span class="header-section-number">15.2.2</span> Example</h3>
<pre><code>{&quot;teaching&quot;:
  {&quot;colleges&quot;: [
      {
        &quot;name&quot;: &quot;Stanford&quot;,
        &quot;location&quot;: &quot;Palo Alto&quot;,
        &quot;classes&quot;: [
        {
          &quot;name&quot;: &quot;Principles of Data Science&quot;,
          &quot;number&quot;: &quot;DataSci 112&quot;,
          &quot;enrollment&quot;: 90,
          &quot;quarter&quot;: &quot;Spring 2024&quot;,
          &quot;students&quot;: [
            {
              &quot;name&quot;: &quot;Regina George&quot;,
              &quot;id&quot;: 12345
            },
            {
              &quot;name&quot;: &quot;Cady Heron&quot;,
              &quot;id&quot;: 38292
            },
            (... more students in 112)
          ]
        }, (end of 112 entry)
        {
          &quot;name&quot;: &quot;Introduction to Statistical Learning&quot;,
          &quot;number&quot;: &quot;Stat 216V&quot;,
          &quot;enrollment&quot;: 40,
          &quot;quarter&quot;: &quot;Summer 2024&quot;,
          &quot;students&quot;: [
            {
              &quot;name&quot;: &quot;Tommy Oliver&quot;,
              &quot;id&quot;: 99999
            },
            {
              &quot;name&quot;: &quot;Trini Kwan&quot;,
              &quot;id&quot;: 88888
            },
            (... more students in 216V)
          ]
        } end of 112 entry
        (... more classes)
        ]
      }, (end of Stanford info)
      {
        ... (Cal Poly info)
      }
    ], (end of &quot;colleges&quot; list)
    &quot;high schools&quot;: [
      (... high school info)
    ]
  } (end of &quot;teaching&quot;)
} (end of file)</code></pre>
</section>
<section id="quick-quiz-2" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3"><span class="header-section-number">15.2.3</span> Quick quiz</h3>
<ul>
<li><p>What would be the <strong>primary key</strong> at the <em>colleges</em> level?</p></li>
<li><p>What would be the <strong>primary key</strong> at the <em>classes</em> level?</p></li>
<li><p>What would be the <strong>primary key</strong> at the <em>students</em> level?</p></li>
</ul>
</section>
<section id="json-things-to-notice" class="level3" data-number="15.2.4">
<h3 data-number="15.2.4"><span class="header-section-number">15.2.4</span> JSON: Things to notice</h3>
<ul>
<li><p>This looks exactly like a <em>dictionary</em> in python, so it is easy to read in as data.</p></li>
<li><p>When we have <em>nested</em> structure, we have a <em>list</em> of <em>dictionaries</em>, e.g. <code>{"students": [{"name": "Regina George", ...}, {"name":"Cady Heron", ...}, ...]}</code></p></li>
<li><p>There can be <em>keys</em> with the same name at different <em>levels</em></p></li>
</ul>
</section>
<section id="check-out-some-real-data" class="level3" data-number="15.2.5">
<h3 data-number="15.2.5"><span class="header-section-number">15.2.5</span> Check out some real data</h3>
<p><a href="https://colab.research.google.com/drive/12LyAEhX4uoZWlumtLsmI3n354cR-2Boi?usp=sharing">Colab link</a></p>
</section>
</section>
<section id="xml" class="level2" data-number="15.3">
<h2 data-number="15.3"><span class="header-section-number">15.3</span> XML</h2>
<section id="xml-1" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1"><span class="header-section-number">15.3.1</span> XML</h3>
<ul>
<li><p>Another type of hierarchical data is <strong>XML</strong> (<em>eXtensible markup language</em>)</p></li>
<li><p>It is the same concept as <strong>JSON</strong>, but a bit less commonly used.</p></li>
<li><p>Instead of <em>dictionaries</em>, data is recorded with <em>tags</em>.</p></li>
</ul>
</section>
<section id="xml-example" class="level3" data-number="15.3.2">
<h3 data-number="15.3.2"><span class="header-section-number">15.3.2</span> XML Example</h3>
<pre><code>&lt;teaching&gt;
  &lt;colleges&gt;
    &lt;college&gt;
      &lt;name&gt;Stanford&lt;/name&gt;
      &lt;location&gt;Palo Alto&lt;/location&gt;
      &lt;classes&gt;
        &lt;class&gt;
          &lt;name&gt;Principles of Data Science&lt;/name&gt;
          &lt;number&gt;DataSci 112&lt;/number&gt;
          &lt;enrollment&gt;90&lt;/enrollment&gt;
           &lt;quarter&gt;Spring 2024&lt;/quarter&gt;
           &lt;students&gt;
            &lt;student&gt;
               &lt;name&gt;Regina George&lt;/name&gt;
               &lt;id&gt;12345&lt;/id&gt;
            &lt;/student&gt;
             &lt;student&gt;
               &lt;name&gt;Cady Heron&lt;/name&gt;
              &lt;id&gt;38292&lt;/name&gt;
            &lt;/student&gt;
             (... more students in 112)
          &lt;/students&gt;
        &lt;/class&gt;
        (... more classes)
       &lt;/classes&gt;
     &lt;/college&gt;
     &lt;college&gt;
       ... (Cal Poly info)
     &lt;/college&gt;
   &lt;/colleges&gt;
   &lt;highschools&gt;
     (... high school info)
   &lt;/highschools&gt;
&lt;/teaching&gt;</code></pre>
</section>
<section id="xml-things-to-notice" class="level3" data-number="15.3.3">
<h3 data-number="15.3.3"><span class="header-section-number">15.3.3</span> XML: things to notice</h3>
<ul>
<li><p>It is easy to see where each <em>level</em> starts and ends</p></li>
<li><p>When we have a <em>nested</em> data structure, we have plural/singular, e.g. <code>&lt;students&gt; &lt;student&gt; ... &lt;/student&gt; &lt;student&gt; ... &lt;/student&gt; &lt;/students&gt;</code></p></li>
<li><p>This <em>tagging</em> structure looks kind of like <strong>HTML</strong>, which is how websites are constructed</p></li>
</ul>
</section>
<section id="check-out-some-real-data-1" class="level3" data-number="15.3.4">
<h3 data-number="15.3.4"><span class="header-section-number">15.3.4</span> Check out some real data</h3>
<p><a href="https://colab.research.google.com/drive/12LyAEhX4uoZWlumtLsmI3n354cR-2Boi?usp=sharing">Colab link</a></p>
</section>
<section id="xml-vs.-json" class="level3" data-number="15.3.5">
<h3 data-number="15.3.5"><span class="header-section-number">15.3.5</span> XML vs. JSON</h3>
<ul>
<li><p>XML matches <em>website</em> code; JSON matches <em>python</em> (and other languages) code.</p></li>
<li><p>XML makes it easy to see start and finish; JSON is more compact.</p></li>
<li><p>There is no objective reason one is better than the other.</p></li>
<li><p>Both are <strong>just text files</strong> made with specific structure!</p></li>
</ul>
</section>
</section>
<section id="relational-data" class="level2" data-number="15.4">
<h2 data-number="15.4"><span class="header-section-number">15.4</span> Relational Data</h2>
<section id="relational-data-1" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1"><span class="header-section-number">15.4.1</span> Relational Data</h3>
<ul>
<li><p>You will sometimes see <em>hierarchical data</em> stored as many <strong>tabular datasets</strong> in a <strong>relational database</strong>.</p></li>
<li><p>(This is the main use of things like <strong>SQL</strong>)</p></li>
<li><p>The important thing is <strong>key matching</strong></p></li>
<li><p>Example:</p>
<ul>
<li>Dataset 1: List of colleges</li>
<li>Dataset 2: List of courses, and “college” column as <em>foreign key</em></li>
<li>Dataset 3: List of students, and “course” column as <em>foreign key</em></li>
</ul></li>
</ul>
</section>
</section>
<section id="apis" class="level2" data-number="15.5">
<h2 data-number="15.5"><span class="header-section-number">15.5</span> APIS</h2>
<section id="apis-1" class="level3 smaller" data-number="15.5.1">
<h3 class="smaller" data-number="15.5.1"><span class="header-section-number">15.5.1</span> APIs</h3>
<ul>
<li><p>The main reason we need to know how to handle <em>relational data</em> is because this is how data is commonly shared online.</p></li>
<li><p>Some organizations/websites provide an <strong>API</strong> (<em>Application Programming Interface</em>) where you can “easily” access data.</p></li>
<li><p>Typically, this data is shared as JSON or XML.</p></li>
<li><p>APIs have multiple <strong>endpoints</strong>: subsections of the site where you can access particular <em>levels</em> or <em>categories</em> of data.</p></li>
<li><p><a href="https://docs.magicthegathering.io/">Example: Magic the Gathering</a></p></li>
<li><p>The hard part of APIs is figuring out which URL to go to for a particular dataset. Then you’re just snagging a JSON or XML as text!</p></li>
<li><p>(You’ll practice this in Section.)</p></li>
</ul>
</section>
</section>
<section id="takeaways-19" class="level2" data-number="15.6">
<h2 data-number="15.6"><span class="header-section-number">15.6</span> Takeaways</h2>
<section id="takeaways-20" class="level3 smaller" data-number="15.6.1">
<h3 class="smaller" data-number="15.6.1"><span class="header-section-number">15.6.1</span> Takeaways</h3>
<ul>
<li><p>Data might be stored in <strong>hierarchical</strong> form rather than <strong>tabular</strong> form.</p></li>
<li><p>The structure of text files for this data is typically either <strong>JSON</strong> or <strong>XML</strong>.</p></li>
<li><p>It is important to think about <strong>levels</strong> of the data (i.e. layers of the tree) and what their <strong>keys</strong> are</p></li>
<li><p>We can use the <code>.json</code> and <code>json_normalize</code> functions to turn JSON levels in to tabular data</p></li>
<li><p>We can use <code>.find</code> or <code>.findall</code> or <code>.parent</code> or <code>.child</code> to search/navigate the tree in XML data. (Then we have to build our tabular datasets from scratch.)</p></li>
<li><p>The collection of tabular datasets from each level might be stored in a <strong>relational database</strong></p></li>
<li><p>The place where you will usually see hierarchical data is when querying <strong>APIs</strong>.</p></li>
</ul>
</section>
</section>
<section id="webscraping" class="level1 lectitle" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Webscraping</h1>
<p><a href="slides-16-webscraping.html">Slides</a></p>
</section>
<section id="html" class="level2" data-number="16.1">
<h2 data-number="16.1"><span class="header-section-number">16.1</span> HTML</h2>
<section id="hypertext-markup-language-html" class="level3 smaller" data-number="16.1.1">
<h3 class="smaller" data-number="16.1.1"><span class="header-section-number">16.1.1</span> HyperText Markup Language (HTML)</h3>
<ul>
<li><p>HTML is the standard language for describing the layout of webpages.</p></li>
<li><p>It is like XML, with special “tags” for hyperlinks, tables, images, etc.</p></li>
<li><p>You don’t need to be an HTML expert to scrape webpages, but you do need to know a few basics.</p></li>
<li><p>You can view the HTML of a website by:</p>
<ul>
<li>Putting <code>view-source:</code> in front of the url</li>
<li>Right-click and choose “View Page Source”</li>
</ul></li>
<li><p>You can explore HTML “interactively” by</p>
<ul>
<li>Right-click and “inspect”</li>
<li>Ctrl/Cmd+Shift+I</li>
</ul></li>
</ul>
</section>
<section id="hyperlinks" class="level3" data-number="16.1.2">
<h3 data-number="16.1.2"><span class="header-section-number">16.1.2</span> Hyperlinks</h3>
<p>The <code>&lt;a&gt;</code> <strong>tag</strong> indicates a (hyper)link.</p>
<ul>
<li><p>The <code>href=</code> <strong>attribute</strong> contains the URL.</p></li>
<li><p>The displayed text is within the <code>&lt;a&gt;</code> tag.</p></li>
<li><p><a href="www.kelly-bodwin.com">This is a link</a></p></li>
</ul>
</section>
<section id="tables" class="level3" data-number="16.1.3">
<h3 data-number="16.1.3"><span class="header-section-number">16.1.3</span> Tables</h3>
<p>The <code>&lt;table&gt;</code> tag indicates a table.</p>
<ul>
<li><p>The <code>&lt;tr&gt;</code> tag indicates a row.</p></li>
<li><p>The <code>&lt;th&gt;</code> and <code>&lt;td&gt;</code> tags indicate a cell within a row.</p></li>
<li><p>Don’t forget that each tag also has a <em>closing tag</em> (<code>&lt;/table&gt;</code>) at the end!</p></li>
</ul>
</section>
<section id="tables-1" class="level3" data-number="16.1.4">
<h3 data-number="16.1.4"><span class="header-section-number">16.1.4</span> Tables</h3>
<div class="columns">
<div class="column" style="width:50%;">
<pre><code>&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Rank&lt;/th&gt;
    &lt;th&gt;Player&lt;/th&gt;
    &lt;th&gt;Saves&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt;Mariano Rivera&lt;/td&gt;
    &lt;td&gt;652&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;2&lt;/td&gt;
    &lt;td&gt;Trevor Hoffman&lt;/td&gt;
    &lt;td&gt;601&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;</code></pre>
</div><div class="column" style="width:50%;">

<table>
<tr>
<th>
Rank
</th>
<th>
Player
</th>
<th>
Saves
</th>
</tr>
<tr>
<td>
1
</td>
<td>
Mariano Rivera
</td>
<td>
652
</td>
</tr>
<tr>
<td>
2
</td>
<td>
Trevor Hoffman
</td>
<td>
601
</td>
</tr>

</table>
</div>
</div>
</section>
</section>
<section id="web-scraping" class="level2" data-number="16.2">
<h2 data-number="16.2"><span class="header-section-number">16.2</span> Web Scraping</h2>
<section id="web-scraping-1" class="level3 smaller" data-number="16.2.1">
<h3 class="smaller" data-number="16.2.1"><span class="header-section-number">16.2.1</span> Web Scraping</h3>
<ul>
<li><p><strong>Web scraping</strong> is the process of getting information from a website to a dataset, without an API.</p></li>
<li><p>We “simply” search through the raw HTML text, using tags to guides us to what we want.</p></li>
<li><p>(What if what you want isn’t nicely in tags? Regular expressions.)</p></li>
<li><p>The <code>python</code> function used to make searching HTML is easier is <code>BeautifulSoup</code></p></li>
<li><p>The challenging parts of webscraping are</p>
<ul>
<li>Identifying the <strong>tag structure</strong> or other <em>consistent structure</em> that contains your data.</li>
<li>Looping through to find the data items and put them in the right place in a dataset</li>
</ul></li>
</ul>
</section>
<section id="lets-try-it" class="level3" data-number="16.2.2">
<h3 data-number="16.2.2"><span class="header-section-number">16.2.2</span> Let’s try it!</h3>
<p>Let’s use what we’ve just learned to scrape some data!</p>
<p><a href="https://colab.research.google.com/drive/1neQvH5uqoX1j74rgCbperbi-HV3uLd8N?usp=sharing">Colab link</a></p>
</section>
</section>
<section id="web-scraping-and-genai" class="level2" data-number="16.3">
<h2 data-number="16.3"><span class="header-section-number">16.3</span> Web Scraping and GenAI</h2>
<section id="using-genai" class="level3" data-number="16.3.1">
<h3 data-number="16.3.1"><span class="header-section-number">16.3.1</span> Using GenAI</h3>
<ul>
<li><p>GenAI tools can help you “fish” through messy HTML</p></li>
<li><p>As the AI to <strong>write code</strong> for you (which you then test and edit, of course!), not to <strong>scrape the data</strong> for you.</p></li>
<li><p>Why?</p>
<ul>
<li>It’s not great at scraping from multiple pages</li>
<li>Hallucinations!</li>
</ul></li>
<li><p>(Example)</p></li>
</ul>
</section>
</section>
<section id="ethics-of-web-scraping" class="level2" data-number="16.4">
<h2 data-number="16.4"><span class="header-section-number">16.4</span> Ethics of Web Scraping</h2>
<section id="ethical-considerations" class="level3" data-number="16.4.1">
<h3 data-number="16.4.1"><span class="header-section-number">16.4.1</span> Ethical Considerations</h3>
<ul>
<li><p>Website owners have to pay a small amount each time you visit a webpage.</p></li>
<li><p>This is usually offset by advertising.</p></li>
<li><p>But when you do web scraping:</p>
<ul>
<li>it is easy to rack up a huge number of webpage visits,</li>
<li>and you don’t see any ads to offset this cost.</li>
</ul></li>
<li><p>Heavy scraping can hit the website so much or so frequently that it crashes!</p></li>
</ul>
</section>
<section id="robots.txt" class="level3" data-number="16.4.2">
<h3 data-number="16.4.2"><span class="header-section-number">16.4.2</span> robots.txt</h3>
<ul>
<li><p>Most websites have a <code>robots.txt</code> file in the home directory that indicate which bots are allowed to scrape and which pages they can scrape.</p></li>
<li><p>Here are a few examples:</p>
<ul>
<li><p><a href="http://www.espn.com/robots.txt" class="uri">http://www.espn.com/robots.txt</a></p></li>
<li><p><a href="http://www.nytimes.com/robots.txt" class="uri">http://www.nytimes.com/robots.txt</a></p></li>
</ul></li>
<li><p>However, <code>robots.txt</code> is informational only. It doesn’t <em>prevent</em> bots from scraping a webpage.</p></li>
</ul>
</section>
<section id="preventing-web-scraping" class="level3" data-number="16.4.3">
<h3 data-number="16.4.3"><span class="header-section-number">16.4.3</span> Preventing Web Scraping</h3>
<ul>
<li>Some websites take more drastic measures to prevent web scraping…</li>
</ul>
<p><img src="./images/scraping.png" class="img-fluid" alt="image" /> ## Takeaways</p>
</section>
<section id="takeaways-21" class="level3" data-number="16.4.4">
<h3 data-number="16.4.4"><span class="header-section-number">16.4.4</span> Takeaways</h3>
<ul>
<li><p>Web pages are made with <strong>HTML</strong>, and we can use that structure to <strong>scrape</strong> data automatically</p></li>
<li><p>Best case scenario: Your data lives in a <code>&lt;table&gt;</code></p></li>
<li><p>Next best case: There is some other consistent tag structure</p></li>
<li><p>(Worst case: Need to use regular expressions)</p></li>
<li><p><strong>Always</strong> check <code>robots.txt</code> before scraping a site!</p></li>
<li><p><strong>Always</strong> build a small pause into your loop for scraping.</p></li>
<li><p>GenAI can help you with the “fiddly” part of identifying HTML structure. (But <strong>always</strong> check and test its results!)</p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->

</body>

</html>